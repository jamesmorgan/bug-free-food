'use strict';

(function () {

    var requires = [
        // 3rd Party
        'ngRoute',
        'firebase',
        // Internals
        'app.controllers',
        'app.services',
        'app.filters',
        'app.directives',
        'app.models',
        'app.routes',
        'app.interceptors',
        'app.notify'
    ];

    angular.module('app', requires);

})();
'use strict';

(function () {

    angular.module('app.controllers', [
        'app.controllers.home',
        'app.controllers.menus',
        'app.controllers.orders',
        'app.controllers.restaurant',
        'app.controllers.wizard',
        'app.controllers.navigation'
    ]);

})();
'use strict';

(function () {

    angular.module('app.directives', []);

})();
'use strict';

(function () {

    angular.module('app.filters', []);

})();
'use strict';

(function () {

    angular.module('app.interceptors', []);

})();
'use strict';

(function () {
    angular.module('app.models', []);

})();
'use strict';

(function () {

    angular.module('app.notify', ['cgNotify']);

    angular.module('app.notify').run(["notify", function (notify) {
        notify.config({
            duration: 2000,
            templateUrl: '/www-build/views/templates/angular-notify.html'
        });
    }]);

})();
'use strict';

(function () {
    angular.module('app.services', []);
})();
'use strict';

(function () {

    angular.module('app.controllers.home', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.menus', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.navigation', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.orders', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.restaurant', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.wizard', []);

})();
'use strict';

(function () {

    /**
     * Basic app version constant
     */
    angular.module('app').constant('version', '0.0.1');

})();
'use strict';
(function () {

    /**
     * @ngInject
     */
    var Routes = ["$routeProvider", "$locationProvider", function ($routeProvider, $locationProvider) {

        $routeProvider.when('/', {
            templateUrl: '/www-build/views/partials/home/index.html',
            controller: 'HomeCtrl as hc'
        });

        /**
         * Orders Management
         */
        $routeProvider.when('/orders/list', {
            templateUrl: '/www-build/views/partials/orders/orders.html',
            controller: 'OrdersCtrl as vm'
        });

        /**
         * Menus Management
         */
        $routeProvider.when('/menus/list', {
            templateUrl: '/www-build/views/partials/menus/menus.html',
            controller: 'ListMenusCtrl as lmc'
        });
        $routeProvider.when('/menus/create', {
            templateUrl: '/www-build/views/partials/menus/create.html',
            controller: 'CreateMenuCtrl as cmc'
        });

        /**
         * Restaurant Management
         */
        $routeProvider.when('/restaurants/list', {
            templateUrl: '/www-build/views/partials/restaurant/restaurant.html',
            controller: 'ListRestaurantCtrl as lrc'
        });
        $routeProvider.when('/restaurants/create', {
            templateUrl: '/www-build/views/partials/restaurant/create.html',
            controller: 'CreateRestaurantCtrl as crc'
        });

        $routeProvider.when('/wizard/new-order', {
            templateUrl: '/www-build/views/partials/wizard/new-order.html',
            controller: 'WizardCtrl as vm'
        });

        /**
         * Fallback
         */
        $routeProvider.otherwise({
            redirectTo: '/'
        });

        // Disable html 5 mode due to IE9 compatibility requirement!
        $locationProvider.html5Mode(false);

    }];
    Routes.$inject = ["$routeProvider", "$locationProvider"];

    angular
        .module('app.routes', [])
        .config(Routes);


})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function AppCtrl($log, $rootScope, NotifyService) {

        // ViewModel
        var vm = this;

        $rootScope.$on("$routeChangeError", function (event, current, previous, rejection) {
            var message = 'Failed to change route [' + (rejection.data.error ? rejection.data.error : rejection.data) + ']';
            $log.error(message);
            NotifyService.danger(message);
        });

    }
    AppCtrl.$inject = ["$log", "$rootScope", "NotifyService"];

    angular
        .module('app.controllers')
        .controller('AppCtrl', AppCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    angular.module('app.interceptors').factory('loggingInterceptor', ["$q", "$log", function ($q, $log) {

        function isPartial(url) {
            return url.indexOf('partials') === -1;
        }

        return {
            'request': function (config) {
                if (isPartial(config.url)) {
                    $log.debug('Http Request [' + config.method + '][' + config.url + ']');
                }
                return config;
            },

            'requestError': function (config) {
                $log.error('Http Request Error [' + config.method + '][' + config.url + ']');
                return config;
            },

            'response': function (response) {
                if (isPartial(response.config.url)) {
                    $log.debug('Http Response Success: Status [' + response.status + '] to [' + response.config.method + '][' + response.config.url + ']');
                }
                return response;
            },

            'responseError': function (rejection) {
                $log.error('Http Response Error: Status [' + rejection.status + '] to [' + rejection.config.method + '][' + rejection.config.url + '] data [' + (rejection.data.error ? rejection.data.error : rejection.data) + ']');
                return $q.reject(rejection);
            }
        };
    }]);

    angular.module('app.interceptors').config(['$httpProvider', function ($httpProvider) {
        $httpProvider.interceptors.push('loggingInterceptor');
    }]);

})();
'use strict';

(function () {
    /**
     * @ngInject
     */
    var UserModel = function () {

        return {
            /**
             * The user
             */
            user: null
        };
    };

    angular.module('app.models').factory('UserModel', UserModel);
})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    var NotifyService = ["notify", function (notify) {

        /**
         * Show a notification with style DANGER
         *
         * @param message the message to display
         */
        this.danger = function (message) {
            notify({message: message, classes: 'alert-danger'});
        };

        /**
         * Show a notification with style WARNING
         *
         * @param message the message to display
         */
        this.warning = function (message) {
            notify({message: message, classes: 'alert-warning'});
        };

        /**
         * Show a notification with style SUCCESS
         *
         * @param message the message to display
         */
        this.success = function (message) {
            notify({message: message, classes: 'alert-success'});
        };

        /**
         * Show a notification with style INFO
         *
         * @param message the message to display
         */
        this.info = function (message) {
            notify({message: message, classes: 'alert-info'});
        };
    }];
    NotifyService.$inject = ["notify"];

    angular
        .module('app.notify')
        .service('NotifyService', NotifyService);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    var DateService = function () {

        /**
         * The Date NOW
         *
         * @returns Date
         */
        this.now = function () {
            return new Date();
        };

        /**
         * The Date NOW in seconds
         *
         * @returns number
         */
        this.getTime = function () {
            return this.now().getTime();
        };
    };

    angular
        .module('app.services')
        .service('DateService', DateService);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function HomeCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/");
        // create an AngularFire reference to the data
        var sync = $firebase(ref);
        // download the data into a local object
        vm.data = sync.$asObject();

    }
    HomeCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.home')
        .controller('HomeCtrl', HomeCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function CreateMenuCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        // restaurantsRef
        var restaurantsRef = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var restaurantsSync = $firebase(restaurantsRef);

        vm.restaurants = restaurantsSync.$asArray();
        console.log(vm.restaurants);

        // menuRef
        var menuRef = new Firebase("https://bug-free-food.firebaseio.com/menus");
        var menuSync = $firebase(menuRef);

        vm.menus = menuSync.$asArray();
        console.log(vm.menus);

        vm.selectedRestaurant = {};
        vm.newMenu = {
            name: '',
            foods: [
                {
                    name: '', price: 0
                }
            ],
            createdDate: Date.now()
        };

        this.createMenu = function () {
            console.log('Adding new menu [%s]', angular.toJson(vm.newMenu));
            console.log(vm.selectedRestaurant);

            if (!vm.selectedRestaurant.menus) {
                vm.selectedRestaurant.menus = [];
            }
            vm.selectedRestaurant.menus.push(vm.newMenu);

            vm.restaurants.$save(vm.selectedRestaurant);
            console.log(vm.restaurants);

            vm.newMenu = {
                name: '',
                foods: [
                    {
                        name: '', price: 0
                    }
                ],
                createdDate: Date.now()
            };
        };

        this.removeFood = function (food, index) {
            vm.newMenu.foods.splice(index, 1);
        };

        this.addFood = function () {
            vm.newMenu.foods.push({
                name: '', price: 0
            });
        };

//        Small Chicken Naan	£3.80
//        Small Chicken Chapatti	£3.80
//        Chicken Lamb Mix Naan	£6.00
//        Chicken Lamb Mix Chapatti	£6.00
//        Large Chicken Naan	£6.00
//        Large Chicken Chapatti	£6.00
//        Large Lamb Naan	£6.00
//        Large Lamb Chapatti	£6.00
//        Chicken Seekh Mix Naan	£6.00
//        Chicken Seekh Mix Chapatti	£6.00
//        Small Seekh Naan	£2.90
//        Small Seekh Chapatti	£2.90
//        Large Seekh Naan	£3.70
//        Large Seekh Chapatti	£3.70
//        Small Chips	£1.30
//        Large Chips	£2.00
//        Chicken Donner	£3.50


    }
    CreateMenuCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.menus')
        .controller('CreateMenuCtrl', CreateMenuCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function ListMenusCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var sync = $firebase(ref);

        vm.restaurants = sync.$asArray();

        console.log(vm.restaurants);

        this.removeMenuAtIndex = function (resturant, index) {
            resturant.menus.splice(index, 1);
            vm.restaurants.$save(resturant);
        };
    }
    ListMenusCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.menus')
        .controller('ListMenusCtrl', ListMenusCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function TopNavCtrl($log, NotifyService, $firebaseSimpleLogin, Firebase, UserModel) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com");

        vm.userModel = UserModel;

        var authClient = $firebaseSimpleLogin(ref);
        console.log(authClient);

        // TODO move to resolve!
        this.init = function () {
            authClient.$getCurrentUser().then(handleSuccessfulLogin);
        };

        this.login = function () {
            $log.debug('Login - github');
            authClient.$login('github', { rememberMe: true, scope: 'user'})
                .then(handleSuccessfulLogin, popError);
        };

        this.logout = function () {
            $log.debug('Logout');
            console.log(authClient);
            authClient.$logout();
            UserModel.user = null;
            NotifyService.success('user is logged out');
        };

        function handleSuccessfulLogin(user) {
            if (user) {
                UserModel.user = user;
                $log.debug("User ID: " + user.uid + ", Provider: " + user.provider);
                NotifyService.success("User ID: " + user.uid + ", Provider: " + user.provider);
            }
        }

        function popError(error) {
            $log.error(error);
            NotifyService.danger(error);
        }
    }
    TopNavCtrl.$inject = ["$log", "NotifyService", "$firebaseSimpleLogin", "Firebase", "UserModel"];

    angular
        .module('app.controllers.navigation')
        .controller('TopNavCtrl', TopNavCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function OrdersCtrl($log, NotifyService, Firebase, $firebase, UserModel) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/orders");
        var sync = $firebase(ref);

        vm.userModel = UserModel;

        vm.orders = sync.$asArray();

        resetForm();

        // Users
        vm.availableUsers = ['James Morgan', 'Andy Gray', 'Simon Souter', 'Alex Lashford'];

        // Available page configuration
        vm.availableRestaurants = [
            {
                name: 'Abduls Levenshulme',
                openingTimes: '...',
                foods: [
                    {name: 'Small Chicken Naan', price: 380},
                    {name: 'Small Chicken Chapatti', price: 300},
                    {name: 'Chicken Lamb Mix Naan', price: 600},
                    {name: 'Chicken Lamb Mix Chapatti', price: 600},
                    {name: 'Large Chicken Naan', price: 600},
                    {name: 'Large Chicken Chapatti', price: 600},
                    {name: 'Large Lamb Naan', price: 600},
                    {name: 'Large Lamb Chapatti', price: 600},
                    {name: 'Chicken Seekh Mix Naan', price: 600},
                    {name: 'Small Seekh Naan', price: 290},
                    {name: 'Small Seekh Chapatti', price: 290},
                    {name: 'Large Seekh Naan', price: 370},
                    {name: 'Large Seekh Chapatti', price: 370},
                    {name: 'Small Chips', price: 130},
                    {name: 'Large Chips', price: 200},
                    {name: 'Chicken Donner', price: 350}
                ]
            }
        ];

        this.createOrder = function () {

            // Set the user
            vm.newOrder.createdBy = UserModel.user;

            vm.orders.$add(angular.copy(vm.newOrder))
                .then(function () {
                    NotifyService.success('Successfully added order');
                }, function () {
                    NotifyService.danger('Unable to save order');
                });
            resetForm();
        };

        this.removeOrder = function (order) {
            vm.orders.$remove(order)
                .then(function () {
                    NotifyService.success('Successfully removed order');
                }, function () {
                    NotifyService.danger('Unable to remove order');
                });
        };

        function resetForm() {
            vm.newOrder = {
                createdBy: UserModel.user,
                name: '',
                restaurant: '',
                content: [
                    {}
                ],
                createdDate: Date.now()
            };
        }
    }
    OrdersCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase", "UserModel"];

    angular
        .module('app.controllers.orders')
        .controller('OrdersCtrl', OrdersCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function CreateRestaurantCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var sync = $firebase(ref);

        vm.resturants = sync.$asArray();
        console.log(vm.resturants);

        vm.newRestaurant = {
            name: '',
            createdDate: Date.now(),
            menus: []
        };

        this.addRestaurant = function () {
            $log.debug('Adding new restaurants [%s]', vm.newRestaurant);

            vm.resturants.$add(angular.copy(vm.newRestaurant));

            vm.newRestaurant = {
                name: '',
                createdDate: Date.now(),
                menus: []
            };
        };
    }
    CreateRestaurantCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.restaurant')
        .controller('CreateRestaurantCtrl', CreateRestaurantCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function ListRestaurantCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var sync = $firebase(ref);

        vm.restaurants = sync.$asArray();

    }
    ListRestaurantCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.restaurant')
        .controller('ListRestaurantCtrl', ListRestaurantCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function WizardCtrl($log, NotifyService, Firebase, $firebase, UserModel) {

        var self = this;

        // ViewModel
        var vm = this;

        vm.userModel = UserModel;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/orders");
        var sync = $firebase(ref);

        vm.orders = sync.$asArray();

        vm.selectedOrder = undefined;

        vm.newOrderItemForm = undefined;

        vm.totalCounts = {};

        // The data form
        vm.myOrder = {
            foods: []
        };

        this.initOrderForUser = function () {
            var orderDetail = {
                user: UserModel.user,
                order: []
            };

            if (hasOrderWithDetails()) {
                vm.selectedOrder.details.push(orderDetail);
            } else {
                vm.selectedOrder.details = [orderDetail]
            }
        };

        this.userHasOrder = function () {
            if (!hasOrderWithDetails() || !UserModel.user) {
                return false;
            }

            return vm.selectedOrder.details.some(function (detail) {
                return detail.user.id === UserModel.user.id
            })
        };

        this.findUserOrder = function () {
            var userDetails = vm.selectedOrder.details.filter(function (detail) {
                return detail.user.id === UserModel.user.id
            });

            if (userDetails.length === 0) {
                throw new Error('User not found in order!');
            }
            return userDetails[0];
        };

        this.addFoodItem = function () {
            var userOrder = this.findUserOrder();

            if (!userOrder.order) {
                userOrder.order = [];
            }
            userOrder.order.push(vm.newOrderItemForm);
            vm.orders.$save(vm.selectedOrder)
                .then(function () {
                    NotifyService.success('Added ' + userOrder.order[userOrder.order.length - 1].name + ' to the order!');
                    vm.newOrderItemForm = undefined;
                    self.updatePageTotals();
                });
        };

        this.removeFoodItem = function (index, item) {
            this.findUserOrder().order.splice(index, 1);
            vm.orders.$save(vm.selectedOrder)
                .then(function () {
                    NotifyService.success('Removed ' + item.name + ' from the order!');
                    self.updatePageTotals();
                });
        };

        this.getUsersOrder = function () {
            if (!hasOrderWithDetails() || vm.selectedOrder.details.length <= 0) {
                return 0;
            }
            var total = 0;
            (vm.findUserOrder().order || []).forEach(function (item) {
                total += item.price;
            });
            return (total / 100).toFixed(2);
        };

        this.getOrderTotals = function () {
            if (!hasOrderWithDetails() || vm.selectedOrder.details.length <= 0) {
                return 0;
            }
            var total = 0;
            vm.selectedOrder.details.forEach(function (detail) {
                if (detail.order) {
                    detail.order.forEach(function (order) {
                        total += order.price;
                    });
                }
            });
            return (total / 100).toFixed(2);
        };

        this.updatePageTotals = function () {
            if (!hasOrderWithDetails() || vm.selectedOrder.details.length <= 0) {
                return;
            }

            vm.totalCounts = {};
            vm.selectedOrder.details.forEach(function (detail) {
                if (detail.order) {
                    detail.order.forEach(function (order) {
                        if (!vm.totalCounts[order.name]) {
                            vm.totalCounts[order.name] = {
                                name: order.name,
                                price: order.price,
                                count: 1
                            };
                        } else {
                            vm.totalCounts[order.name].count++;
                        }
                    });
                }
            });
        };

        function hasOrderWithDetails() {
            return vm.selectedOrder && vm.selectedOrder.details;
        }

    }
    WizardCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase", "UserModel"];

    angular
        .module('app.controllers.wizard')
        .controller('WizardCtrl', WizardCtrl);

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9fbW9kdWxlLmpzIiwianMvZGlyZWN0aXZlcy9fbW9kdWxlLmpzIiwianMvZmlsdGVycy9fbW9kdWxlLmpzIiwianMvaW50ZXJjZXB0b3JzL19tb2R1bGUuanMiLCJqcy9tb2RlbHMvX21vZHVsZS5qcyIsImpzL25vdGlmeS9fbW9kdWxlLmpzIiwianMvc2VydmljZXMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL2hvbWUvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL21lbnVzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9uYXZpZ2F0aW9uL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9vcmRlcnMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3Jlc3RhdXJhbnQvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3dpemFyZC9fbW9kdWxlLmpzIiwianMvY29uc3RhbnRzLmpzIiwianMvcm91dGVzLmpzIiwianMvY29udHJvbGxlcnMvQXBwQ3RybC5qcyIsImpzL2ludGVyY2VwdG9ycy9IdHRwTG9nZ2luZ0ludGVyY2VwdG9yLmpzIiwianMvbW9kZWxzL1VzZXJNb2RlbC5qcyIsImpzL25vdGlmeS9Ob3RpZnlTZXJ2aWNlLmpzIiwianMvc2VydmljZXMvRGF0ZVNlcnZpY2UuanMiLCJqcy9jb250cm9sbGVycy9ob21lL0hvbWVDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbWVudXMvQ3JlYXRlTWVudUN0cmwuanMiLCJqcy9jb250cm9sbGVycy9tZW51cy9MaXN0TWVudXNDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbmF2aWdhdGlvbi9Ub3BOYXZDdHJsLmpzIiwianMvY29udHJvbGxlcnMvb3JkZXJzL09yZGVyc0N0cmwuanMiLCJqcy9jb250cm9sbGVycy9yZXN0YXVyYW50L0NyZWF0ZVJlc3RhdXJhbnRDdHJsLmpzIiwianMvY29udHJvbGxlcnMvcmVzdGF1cmFudC9MaXN0UmVzdGF1cmFudEN0cmwuanMiLCJqcy9jb250cm9sbGVycy93aXphcmQvV2l6YXJkQ3RybC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTs7SUFFQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtJQUNBOztJQUVBOztBQUVBO0FDckJBOztBQUVBOztJQUVBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO0lBQ0E7O0FBRUE7QUNiQTs7QUFFQTs7SUFFQTs7QUFFQTtBQ05BOztBQUVBOztJQUVBOztBQUVBO0FDTkE7O0FBRUE7O0lBRUE7O0FBRUE7QUNOQTs7QUFFQTtJQUNBOztBQUVBO0FDTEE7O0FBRUE7O0lBRUE7O0lBRUEsaUNBQUEsV0FBQTtRQUNBO1lBQ0E7WUFDQTtRQUNBO0lBQ0EsQ0FBQSxDQUFBOztBQUVBO0FDYkE7O0FBRUE7SUFDQTtBQUNBO0FDSkE7O0FBRUE7O0lBRUE7O0FBRUE7QUNOQTs7QUFFQTs7SUFFQTs7QUFFQTtBQ05BOztBQUVBOztJQUVBOztBQUVBO0FDTkE7O0FBRUE7O0lBRUE7O0FBRUE7QUNOQTs7QUFFQTs7SUFFQTs7QUFFQTtBQ05BOztBQUVBOztJQUVBOztBQUVBO0FDTkE7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O0FBRUE7QUNUQTtBQUNBOztJQUVBO0tBQ0E7S0FDQTtJQUNBLGFBQUEsd0NBQUE7O1FBRUE7WUFDQTtZQUNBLGFBQUEsY0FBQTtRQUNBOztRQUVBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7WUFDQSxhQUFBLGdCQUFBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO1FBQ0E7WUFDQTtZQUNBLGFBQUEsb0JBQUE7UUFDQTtRQUNBO1lBQ0E7WUFDQSxhQUFBLHFCQUFBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO1FBQ0E7WUFDQTtZQUNBLGFBQUEseUJBQUE7UUFDQTtRQUNBO1lBQ0E7WUFDQSxhQUFBLDJCQUFBO1FBQ0E7O1FBRUE7WUFDQTtZQUNBLGFBQUEsZ0JBQUE7UUFDQTs7UUFFQTtTQUNBO1NBQ0E7UUFDQTtZQUNBO1FBQ0E7O1FBRUE7UUFDQTs7SUFFQSxDQUFBLENBQUEsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBOzs7QUFHQTtBQ25FQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQTs7UUFFQTtRQUNBOztRQUVBO1lBQ0E7WUFDQTtZQUNBO1FBQ0E7O0lBRUEsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsT0FBQTs7QUFFQTtBQ3hCQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQSw0Q0FBQSxrQkFBQSxHQUFBLGVBQUE7O1FBRUE7WUFDQTtRQUNBOztRQUVBO1lBQ0E7Z0JBQ0E7b0JBQ0E7Z0JBQ0E7Z0JBQ0E7WUFDQTs7WUFFQTtnQkFDQTtnQkFDQTtZQUNBOztZQUVBO2dCQUNBO29CQUNBO2dCQUNBO2dCQUNBO1lBQ0E7O1lBRUE7Z0JBQ0E7Z0JBQ0E7WUFDQTtRQUNBO0lBQ0EsQ0FBQSxDQUFBOztJQUVBO1FBQ0EsaUNBQUEsa0JBQUE7SUFDQTs7QUFFQTtBQzVDQTs7QUFFQTtJQUNBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1lBQ0E7YUFDQTthQUNBO1lBQ0E7UUFDQTtJQUNBOztJQUVBLHNDQUFBLFNBQUE7QUFDQTtBQ2pCQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQSxvQkFBQSxXQUFBOztRQUVBO1NBQ0E7U0FDQTtTQUNBO1NBQ0E7UUFDQTtZQUNBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7UUFDQTs7UUFFQTtTQUNBO1NBQ0E7U0FDQTtTQUNBO1FBQ0E7WUFDQTtRQUNBOztRQUVBO1NBQ0E7U0FDQTtTQUNBO1NBQ0E7UUFDQTtZQUNBO1FBQ0E7SUFDQSxDQUFBLENBQUEsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLFVBQUEsYUFBQTs7QUFFQTtBQ2xEQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQTs7UUFFQTtTQUNBO1NBQ0E7U0FDQTtTQUNBO1FBQ0E7WUFDQTtRQUNBOztRQUVBO1NBQ0E7U0FDQTtTQUNBO1NBQ0E7UUFDQTtZQUNBO1FBQ0E7SUFDQTs7SUFFQTtRQUNBO1FBQ0EsVUFBQSxXQUFBOztBQUVBO0FDaENBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTs7SUFFQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxRQUFBOztBQUVBO0FDeEJBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtZQUNBO1lBQ0E7Z0JBQ0E7b0JBQ0E7Z0JBQ0E7WUFDQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTtZQUNBOztZQUVBO2dCQUNBO1lBQ0E7WUFDQTs7WUFFQTtZQUNBOztZQUVBO2dCQUNBO2dCQUNBO29CQUNBO3dCQUNBO29CQUNBO2dCQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtZQUNBO1FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0lBR0EsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsY0FBQTs7QUFFQTtBQy9GQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7O1FBRUE7O1FBRUE7WUFDQTtZQUNBO1FBQ0E7SUFDQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxhQUFBOztBQUVBO0FDN0JBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7O1FBRUE7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7Z0JBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO2dCQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7UUFDQTtJQUNBLENBQUE7OztJQUVBO1FBQ0E7UUFDQSxhQUFBLFVBQUE7O0FBRUE7QUN4REE7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBOztRQUVBOztRQUVBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtZQUNBO2dCQUNBO2dCQUNBO2dCQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO29CQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTs7WUFFQTtZQUNBOztZQUVBO2dCQUNBO29CQUNBO2dCQUNBO29CQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO29CQUNBO2dCQUNBO29CQUNBO2dCQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtnQkFDQTtnQkFDQTtnQkFDQTtvQkFDQTtnQkFDQTtnQkFDQTtZQUNBO1FBQ0E7SUFDQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxVQUFBOztBQUVBO0FDMUZBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1lBQ0E7WUFDQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTs7WUFFQTs7WUFFQTtnQkFDQTtnQkFDQTtnQkFDQTtZQUNBO1FBQ0E7SUFDQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxvQkFBQTs7QUFFQTtBQ3pDQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7O0lBRUEsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsa0JBQUE7O0FBRUE7QUN2QkE7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7O1FBRUE7UUFDQTs7UUFFQTs7UUFFQTtRQUNBOztRQUVBOztRQUVBOztRQUVBOztRQUVBOztRQUVBO1FBQ0E7WUFDQTtRQUNBOztRQUVBO1lBQ0E7Z0JBQ0E7Z0JBQ0E7WUFDQTs7WUFFQTtnQkFDQTtZQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO1lBQ0E7O1lBRUE7Z0JBQ0E7WUFDQTtRQUNBOztRQUVBO1lBQ0E7Z0JBQ0E7WUFDQTs7WUFFQTtnQkFDQTtZQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBOztZQUVBO2dCQUNBO1lBQ0E7WUFDQTtZQUNBO2dCQUNBO29CQUNBO29CQUNBO29CQUNBO2dCQUNBO1FBQ0E7O1FBRUE7WUFDQTtZQUNBO2dCQUNBO29CQUNBO29CQUNBO2dCQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtZQUNBO1lBQ0E7WUFDQTtnQkFDQTtZQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO1lBQ0E7WUFDQTtZQUNBO2dCQUNBO29CQUNBO3dCQUNBO29CQUNBO2dCQUNBO1lBQ0E7WUFDQTtRQUNBOztRQUVBO1lBQ0E7Z0JBQ0E7WUFDQTs7WUFFQTtZQUNBO2dCQUNBO29CQUNBO3dCQUNBOzRCQUNBO2dDQUNBO2dDQUNBO2dDQUNBOzRCQUNBO3dCQUNBOzRCQUNBO3dCQUNBO29CQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1FBQ0E7O0lBRUEsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsVUFBQTs7QUFFQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHJlcXVpcmVzID0gW1xuICAgICAgICAvLyAzcmQgUGFydHlcbiAgICAgICAgJ25nUm91dGUnLFxuICAgICAgICAnZmlyZWJhc2UnLFxuICAgICAgICAvLyBJbnRlcm5hbHNcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycycsXG4gICAgICAgICdhcHAuc2VydmljZXMnLFxuICAgICAgICAnYXBwLmZpbHRlcnMnLFxuICAgICAgICAnYXBwLmRpcmVjdGl2ZXMnLFxuICAgICAgICAnYXBwLm1vZGVscycsXG4gICAgICAgICdhcHAucm91dGVzJyxcbiAgICAgICAgJ2FwcC5pbnRlcmNlcHRvcnMnLFxuICAgICAgICAnYXBwLm5vdGlmeSdcbiAgICBdO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIHJlcXVpcmVzKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzJywgW1xuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLmhvbWUnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLm1lbnVzJyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5vcmRlcnMnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLndpemFyZCcsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMubmF2aWdhdGlvbidcbiAgICBdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXJzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaW50ZXJjZXB0b3JzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm1vZGVscycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5vdGlmeScsIFsnY2dOb3RpZnknXSk7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5vdGlmeScpLnJ1bihmdW5jdGlvbiAobm90aWZ5KSB7XG4gICAgICAgIG5vdGlmeS5jb25maWcoe1xuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvdGVtcGxhdGVzL2FuZ3VsYXItbm90aWZ5Lmh0bWwnXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJywgW10pO1xufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLmhvbWUnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5tZW51cycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm5hdmlnYXRpb24nLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5vcmRlcnMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5yZXN0YXVyYW50JywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMud2l6YXJkJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEJhc2ljIGFwcCB2ZXJzaW9uIGNvbnN0YW50XG4gICAgICovXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCd2ZXJzaW9uJywgJzAuMC4xJyk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIHZhciBSb3V0ZXMgPSBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9ob21lL2luZGV4Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDdHJsIGFzIGhjJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogT3JkZXJzIE1hbmFnZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9vcmRlcnMvbGlzdCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9vcmRlcnMvb3JkZXJzLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ09yZGVyc0N0cmwgYXMgdm0nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNZW51cyBNYW5hZ2VtZW50XG4gICAgICAgICAqL1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvbWVudXMvbGlzdCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9tZW51cy9tZW51cy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMaXN0TWVudXNDdHJsIGFzIGxtYydcbiAgICAgICAgfSk7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9tZW51cy9jcmVhdGUnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvbWVudXMvY3JlYXRlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NyZWF0ZU1lbnVDdHJsIGFzIGNtYydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlc3RhdXJhbnQgTWFuYWdlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3Jlc3RhdXJhbnRzL2xpc3QnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvcmVzdGF1cmFudC9yZXN0YXVyYW50Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xpc3RSZXN0YXVyYW50Q3RybCBhcyBscmMnXG4gICAgICAgIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvcmVzdGF1cmFudHMvY3JlYXRlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL3Jlc3RhdXJhbnQvY3JlYXRlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NyZWF0ZVJlc3RhdXJhbnRDdHJsIGFzIGNyYydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3dpemFyZC9uZXctb3JkZXInLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvd2l6YXJkL25ldy1vcmRlci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdXaXphcmRDdHJsIGFzIHZtJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmFsbGJhY2tcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLm90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRGlzYWJsZSBodG1sIDUgbW9kZSBkdWUgdG8gSUU5IGNvbXBhdGliaWxpdHkgcmVxdWlyZW1lbnQhXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShmYWxzZSk7XG5cbiAgICB9O1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAucm91dGVzJywgW10pXG4gICAgICAgIC5jb25maWcoUm91dGVzKTtcblxuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEFwcEN0cmwoJGxvZywgJHJvb3RTY29wZSwgTm90aWZ5U2VydmljZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKFwiJHJvdXRlQ2hhbmdlRXJyb3JcIiwgZnVuY3Rpb24gKGV2ZW50LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICdGYWlsZWQgdG8gY2hhbmdlIHJvdXRlIFsnICsgKHJlamVjdGlvbi5kYXRhLmVycm9yID8gcmVqZWN0aW9uLmRhdGEuZXJyb3IgOiByZWplY3Rpb24uZGF0YSkgKyAnXSc7XG4gICAgICAgICAgICAkbG9nLmVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIobWVzc2FnZSk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMnKVxuICAgICAgICAuY29udHJvbGxlcignQXBwQ3RybCcsIEFwcEN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaW50ZXJjZXB0b3JzJykuZmFjdG9yeSgnbG9nZ2luZ0ludGVyY2VwdG9yJywgZnVuY3Rpb24gKCRxLCAkbG9nKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gaXNQYXJ0aWFsKHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHVybC5pbmRleE9mKCdwYXJ0aWFscycpID09PSAtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAncmVxdWVzdCc6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQYXJ0aWFsKGNvbmZpZy51cmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoJ0h0dHAgUmVxdWVzdCBbJyArIGNvbmZpZy5tZXRob2QgKyAnXVsnICsgY29uZmlnLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncmVxdWVzdEVycm9yJzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0h0dHAgUmVxdWVzdCBFcnJvciBbJyArIGNvbmZpZy5tZXRob2QgKyAnXVsnICsgY29uZmlnLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdyZXNwb25zZSc6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChpc1BhcnRpYWwocmVzcG9uc2UuY29uZmlnLnVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZygnSHR0cCBSZXNwb25zZSBTdWNjZXNzOiBTdGF0dXMgWycgKyByZXNwb25zZS5zdGF0dXMgKyAnXSB0byBbJyArIHJlc3BvbnNlLmNvbmZpZy5tZXRob2QgKyAnXVsnICsgcmVzcG9uc2UuY29uZmlnLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdyZXNwb25zZUVycm9yJzogZnVuY3Rpb24gKHJlamVjdGlvbikge1xuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0h0dHAgUmVzcG9uc2UgRXJyb3I6IFN0YXR1cyBbJyArIHJlamVjdGlvbi5zdGF0dXMgKyAnXSB0byBbJyArIHJlamVjdGlvbi5jb25maWcubWV0aG9kICsgJ11bJyArIHJlamVjdGlvbi5jb25maWcudXJsICsgJ10gZGF0YSBbJyArIChyZWplY3Rpb24uZGF0YS5lcnJvciA/IHJlamVjdGlvbi5kYXRhLmVycm9yIDogcmVqZWN0aW9uLmRhdGEpICsgJ10nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmludGVyY2VwdG9ycycpLmNvbmZpZyhbJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJGh0dHBQcm92aWRlcikge1xuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdsb2dnaW5nSW50ZXJjZXB0b3InKTtcbiAgICB9XSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIHZhciBVc2VyTW9kZWwgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVGhlIHVzZXJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdXNlcjogbnVsbFxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm1vZGVscycpLmZhY3RvcnkoJ1VzZXJNb2RlbCcsIFVzZXJNb2RlbCk7XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIHZhciBOb3RpZnlTZXJ2aWNlID0gZnVuY3Rpb24gKG5vdGlmeSkge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGEgbm90aWZpY2F0aW9uIHdpdGggc3R5bGUgREFOR0VSXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGFuZ2VyID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5vdGlmeSh7bWVzc2FnZTogbWVzc2FnZSwgY2xhc3NlczogJ2FsZXJ0LWRhbmdlcid9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhIG5vdGlmaWNhdGlvbiB3aXRoIHN0eWxlIFdBUk5JTkdcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53YXJuaW5nID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5vdGlmeSh7bWVzc2FnZTogbWVzc2FnZSwgY2xhc3NlczogJ2FsZXJ0LXdhcm5pbmcnfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBTVUNDRVNTXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3VjY2VzcyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBub3RpZnkoe21lc3NhZ2U6IG1lc3NhZ2UsIGNsYXNzZXM6ICdhbGVydC1zdWNjZXNzJ30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGEgbm90aWZpY2F0aW9uIHdpdGggc3R5bGUgSU5GT1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSB0aGUgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluZm8gPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtaW5mbyd9KTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAubm90aWZ5JylcbiAgICAgICAgLnNlcnZpY2UoJ05vdGlmeVNlcnZpY2UnLCBOb3RpZnlTZXJ2aWNlKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICB2YXIgRGF0ZVNlcnZpY2UgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBEYXRlIE5PV1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcmV0dXJucyBEYXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5vdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgRGF0ZSBOT1cgaW4gc2Vjb25kc1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcmV0dXJucyBudW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VGltZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdygpLmdldFRpbWUoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuc2VydmljZXMnKVxuICAgICAgICAuc2VydmljZSgnRGF0ZVNlcnZpY2UnLCBEYXRlU2VydmljZSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gSG9tZUN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vXCIpO1xuICAgICAgICAvLyBjcmVhdGUgYW4gQW5ndWxhckZpcmUgcmVmZXJlbmNlIHRvIHRoZSBkYXRhXG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG4gICAgICAgIC8vIGRvd25sb2FkIHRoZSBkYXRhIGludG8gYSBsb2NhbCBvYmplY3RcbiAgICAgICAgdm0uZGF0YSA9IHN5bmMuJGFzT2JqZWN0KCk7XG5cbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5ob21lJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0hvbWVDdHJsJywgSG9tZUN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIENyZWF0ZU1lbnVDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLyByZXN0YXVyYW50c1JlZlxuICAgICAgICB2YXIgcmVzdGF1cmFudHNSZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciByZXN0YXVyYW50c1N5bmMgPSAkZmlyZWJhc2UocmVzdGF1cmFudHNSZWYpO1xuXG4gICAgICAgIHZtLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHNTeW5jLiRhc0FycmF5KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHZtLnJlc3RhdXJhbnRzKTtcblxuICAgICAgICAvLyBtZW51UmVmXG4gICAgICAgIHZhciBtZW51UmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL21lbnVzXCIpO1xuICAgICAgICB2YXIgbWVudVN5bmMgPSAkZmlyZWJhc2UobWVudVJlZik7XG5cbiAgICAgICAgdm0ubWVudXMgPSBtZW51U3luYy4kYXNBcnJheSgpO1xuICAgICAgICBjb25zb2xlLmxvZyh2bS5tZW51cyk7XG5cbiAgICAgICAgdm0uc2VsZWN0ZWRSZXN0YXVyYW50ID0ge307XG4gICAgICAgIHZtLm5ld01lbnUgPSB7XG4gICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgIGZvb2RzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KClcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmNyZWF0ZU1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQWRkaW5nIG5ldyBtZW51IFslc10nLCBhbmd1bGFyLnRvSnNvbih2bS5uZXdNZW51KSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5zZWxlY3RlZFJlc3RhdXJhbnQpO1xuXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkUmVzdGF1cmFudC5tZW51cykge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVzdGF1cmFudC5tZW51cyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzLnB1c2godm0ubmV3TWVudSk7XG5cbiAgICAgICAgICAgIHZtLnJlc3RhdXJhbnRzLiRzYXZlKHZtLnNlbGVjdGVkUmVzdGF1cmFudCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0YXVyYW50cyk7XG5cbiAgICAgICAgICAgIHZtLm5ld01lbnUgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgZm9vZHM6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsIHByaWNlOiAwXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWREYXRlOiBEYXRlLm5vdygpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlRm9vZCA9IGZ1bmN0aW9uIChmb29kLCBpbmRleCkge1xuICAgICAgICAgICAgdm0ubmV3TWVudS5mb29kcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYWRkRm9vZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm5ld01lbnUuZm9vZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogJycsIHByaWNlOiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuLy8gICAgICAgIFNtYWxsIENoaWNrZW4gTmFhblx0wqMzLjgwXG4vLyAgICAgICAgU21hbGwgQ2hpY2tlbiBDaGFwYXR0aVx0wqMzLjgwXG4vLyAgICAgICAgQ2hpY2tlbiBMYW1iIE1peCBOYWFuXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIExhbWIgTWl4IENoYXBhdHRpXHTCozYuMDBcbi8vICAgICAgICBMYXJnZSBDaGlja2VuIE5hYW5cdMKjNi4wMFxuLy8gICAgICAgIExhcmdlIENoaWNrZW4gQ2hhcGF0dGlcdMKjNi4wMFxuLy8gICAgICAgIExhcmdlIExhbWIgTmFhblx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgTGFtYiBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgQ2hpY2tlbiBTZWVraCBNaXggTmFhblx0wqM2LjAwXG4vLyAgICAgICAgQ2hpY2tlbiBTZWVraCBNaXggQ2hhcGF0dGlcdMKjNi4wMFxuLy8gICAgICAgIFNtYWxsIFNlZWtoIE5hYW5cdMKjMi45MFxuLy8gICAgICAgIFNtYWxsIFNlZWtoIENoYXBhdHRpXHTCozIuOTBcbi8vICAgICAgICBMYXJnZSBTZWVraCBOYWFuXHTCozMuNzBcbi8vICAgICAgICBMYXJnZSBTZWVraCBDaGFwYXR0aVx0wqMzLjcwXG4vLyAgICAgICAgU21hbGwgQ2hpcHNcdMKjMS4zMFxuLy8gICAgICAgIExhcmdlIENoaXBzXHTCozIuMDBcbi8vICAgICAgICBDaGlja2VuIERvbm5lclx0wqMzLjUwXG5cblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm1lbnVzJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NyZWF0ZU1lbnVDdHJsJywgQ3JlYXRlTWVudUN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIExpc3RNZW51c0N0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0ucmVzdGF1cmFudHMgPSBzeW5jLiRhc0FycmF5KCk7XG5cbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdGF1cmFudHMpO1xuXG4gICAgICAgIHRoaXMucmVtb3ZlTWVudUF0SW5kZXggPSBmdW5jdGlvbiAocmVzdHVyYW50LCBpbmRleCkge1xuICAgICAgICAgICAgcmVzdHVyYW50Lm1lbnVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB2bS5yZXN0YXVyYW50cy4kc2F2ZShyZXN0dXJhbnQpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm1lbnVzJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xpc3RNZW51c0N0cmwnLCBMaXN0TWVudXNDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBUb3BOYXZDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsICRmaXJlYmFzZVNpbXBsZUxvZ2luLCBGaXJlYmFzZSwgVXNlck1vZGVsKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbVwiKTtcblxuICAgICAgICB2bS51c2VyTW9kZWwgPSBVc2VyTW9kZWw7XG5cbiAgICAgICAgdmFyIGF1dGhDbGllbnQgPSAkZmlyZWJhc2VTaW1wbGVMb2dpbihyZWYpO1xuICAgICAgICBjb25zb2xlLmxvZyhhdXRoQ2xpZW50KTtcblxuICAgICAgICAvLyBUT0RPIG1vdmUgdG8gcmVzb2x2ZSFcbiAgICAgICAgdGhpcy5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgYXV0aENsaWVudC4kZ2V0Q3VycmVudFVzZXIoKS50aGVuKGhhbmRsZVN1Y2Nlc3NmdWxMb2dpbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ0xvZ2luIC0gZ2l0aHViJyk7XG4gICAgICAgICAgICBhdXRoQ2xpZW50LiRsb2dpbignZ2l0aHViJywgeyByZW1lbWJlck1lOiB0cnVlLCBzY29wZTogJ3VzZXInfSlcbiAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVTdWNjZXNzZnVsTG9naW4sIHBvcEVycm9yKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ0xvZ291dCcpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYXV0aENsaWVudCk7XG4gICAgICAgICAgICBhdXRoQ2xpZW50LiRsb2dvdXQoKTtcbiAgICAgICAgICAgIFVzZXJNb2RlbC51c2VyID0gbnVsbDtcbiAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygndXNlciBpcyBsb2dnZWQgb3V0Jyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlU3VjY2Vzc2Z1bExvZ2luKHVzZXIpIHtcbiAgICAgICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgVXNlck1vZGVsLnVzZXIgPSB1c2VyO1xuICAgICAgICAgICAgICAgICRsb2cuZGVidWcoXCJVc2VyIElEOiBcIiArIHVzZXIudWlkICsgXCIsIFByb3ZpZGVyOiBcIiArIHVzZXIucHJvdmlkZXIpO1xuICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcyhcIlVzZXIgSUQ6IFwiICsgdXNlci51aWQgKyBcIiwgUHJvdmlkZXI6IFwiICsgdXNlci5wcm92aWRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwb3BFcnJvcihlcnJvcikge1xuICAgICAgICAgICAgJGxvZy5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLmRhbmdlcihlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5uYXZpZ2F0aW9uJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1RvcE5hdkN0cmwnLCBUb3BOYXZDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBPcmRlcnNDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UsIFVzZXJNb2RlbCkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vb3JkZXJzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcblxuICAgICAgICB2bS5vcmRlcnMgPSBzeW5jLiRhc0FycmF5KCk7XG5cbiAgICAgICAgcmVzZXRGb3JtKCk7XG5cbiAgICAgICAgLy8gVXNlcnNcbiAgICAgICAgdm0uYXZhaWxhYmxlVXNlcnMgPSBbJ0phbWVzIE1vcmdhbicsICdBbmR5IEdyYXknLCAnU2ltb24gU291dGVyJywgJ0FsZXggTGFzaGZvcmQnXTtcblxuICAgICAgICAvLyBBdmFpbGFibGUgcGFnZSBjb25maWd1cmF0aW9uXG4gICAgICAgIHZtLmF2YWlsYWJsZVJlc3RhdXJhbnRzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdBYmR1bHMgTGV2ZW5zaHVsbWUnLFxuICAgICAgICAgICAgICAgIG9wZW5pbmdUaW1lczogJy4uLicsXG4gICAgICAgICAgICAgICAgZm9vZHM6IFtcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdTbWFsbCBDaGlja2VuIE5hYW4nLCBwcmljZTogMzgwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdTbWFsbCBDaGlja2VuIENoYXBhdHRpJywgcHJpY2U6IDMwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnQ2hpY2tlbiBMYW1iIE1peCBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnQ2hpY2tlbiBMYW1iIE1peCBDaGFwYXR0aScsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIENoaWNrZW4gTmFhbicsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIENoaWNrZW4gQ2hhcGF0dGknLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBMYW1iIE5hYW4nLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBMYW1iIENoYXBhdHRpJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnQ2hpY2tlbiBTZWVraCBNaXggTmFhbicsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIFNlZWtoIE5hYW4nLCBwcmljZTogMjkwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdTbWFsbCBTZWVraCBDaGFwYXR0aScsIHByaWNlOiAyOTB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIFNlZWtoIE5hYW4nLCBwcmljZTogMzcwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBTZWVraCBDaGFwYXR0aScsIHByaWNlOiAzNzB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaXBzJywgcHJpY2U6IDEzMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpcHMnLCBwcmljZTogMjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIERvbm5lcicsIHByaWNlOiAzNTB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHRoaXMuY3JlYXRlT3JkZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIC8vIFNldCB0aGUgdXNlclxuICAgICAgICAgICAgdm0ubmV3T3JkZXIuY3JlYXRlZEJ5ID0gVXNlck1vZGVsLnVzZXI7XG5cbiAgICAgICAgICAgIHZtLm9yZGVycy4kYWRkKGFuZ3VsYXIuY29weSh2bS5uZXdPcmRlcikpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSBhZGRlZCBvcmRlcicpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoJ1VuYWJsZSB0byBzYXZlIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNldEZvcm0oKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnJlbW92ZU9yZGVyID0gZnVuY3Rpb24gKG9yZGVyKSB7XG4gICAgICAgICAgICB2bS5vcmRlcnMuJHJlbW92ZShvcmRlcilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2UuZGFuZ2VyKCdVbmFibGUgdG8gcmVtb3ZlIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzZXRGb3JtKCkge1xuICAgICAgICAgICAgdm0ubmV3T3JkZXIgPSB7XG4gICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiBVc2VyTW9kZWwudXNlcixcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICByZXN0YXVyYW50OiAnJyxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICAgICAgICAgIHt9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycpXG4gICAgICAgIC5jb250cm9sbGVyKCdPcmRlcnNDdHJsJywgT3JkZXJzQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQ3JlYXRlUmVzdGF1cmFudEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0ucmVzdHVyYW50cyA9IHN5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdHVyYW50cyk7XG5cbiAgICAgICAgdm0ubmV3UmVzdGF1cmFudCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KCksXG4gICAgICAgICAgICBtZW51czogW11cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFkZFJlc3RhdXJhbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdBZGRpbmcgbmV3IHJlc3RhdXJhbnRzIFslc10nLCB2bS5uZXdSZXN0YXVyYW50KTtcblxuICAgICAgICAgICAgdm0ucmVzdHVyYW50cy4kYWRkKGFuZ3VsYXIuY29weSh2bS5uZXdSZXN0YXVyYW50KSk7XG5cbiAgICAgICAgICAgIHZtLm5ld1Jlc3RhdXJhbnQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgbWVudXM6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnKVxuICAgICAgICAuY29udHJvbGxlcignQ3JlYXRlUmVzdGF1cmFudEN0cmwnLCBDcmVhdGVSZXN0YXVyYW50Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTGlzdFJlc3RhdXJhbnRDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL3Jlc3RhdXJhbnRzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLnJlc3RhdXJhbnRzID0gc3luYy4kYXNBcnJheSgpO1xuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdMaXN0UmVzdGF1cmFudEN0cmwnLCBMaXN0UmVzdGF1cmFudEN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFdpemFyZEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSwgVXNlck1vZGVsKSB7XG5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL29yZGVyc1wiKTtcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcblxuICAgICAgICB2bS5vcmRlcnMgPSBzeW5jLiRhc0FycmF5KCk7XG5cbiAgICAgICAgdm0uc2VsZWN0ZWRPcmRlciA9IHVuZGVmaW5lZDtcblxuICAgICAgICB2bS5uZXdPcmRlckl0ZW1Gb3JtID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIHZtLnRvdGFsQ291bnRzID0ge307XG5cbiAgICAgICAgLy8gVGhlIGRhdGEgZm9ybVxuICAgICAgICB2bS5teU9yZGVyID0ge1xuICAgICAgICAgICAgZm9vZHM6IFtdXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5pbml0T3JkZXJGb3JVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9yZGVyRGV0YWlsID0ge1xuICAgICAgICAgICAgICAgIHVzZXI6IFVzZXJNb2RlbC51c2VyLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGhhc09yZGVyV2l0aERldGFpbHMoKSkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscy5wdXNoKG9yZGVyRGV0YWlsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzID0gW29yZGVyRGV0YWlsXVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudXNlckhhc09yZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPcmRlcldpdGhEZXRhaWxzKCkgfHwgIVVzZXJNb2RlbC51c2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLnNvbWUoZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkZXRhaWwudXNlci5pZCA9PT0gVXNlck1vZGVsLnVzZXIuaWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5maW5kVXNlck9yZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHVzZXJEZXRhaWxzID0gdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLmZpbHRlcihmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRldGFpbC51c2VyLmlkID09PSBVc2VyTW9kZWwudXNlci5pZFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh1c2VyRGV0YWlscy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kIGluIG9yZGVyIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVzZXJEZXRhaWxzWzBdO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYWRkRm9vZEl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdXNlck9yZGVyID0gdGhpcy5maW5kVXNlck9yZGVyKCk7XG5cbiAgICAgICAgICAgIGlmICghdXNlck9yZGVyLm9yZGVyKSB7XG4gICAgICAgICAgICAgICAgdXNlck9yZGVyLm9yZGVyID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1c2VyT3JkZXIub3JkZXIucHVzaCh2bS5uZXdPcmRlckl0ZW1Gb3JtKTtcbiAgICAgICAgICAgIHZtLm9yZGVycy4kc2F2ZSh2bS5zZWxlY3RlZE9yZGVyKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKCdBZGRlZCAnICsgdXNlck9yZGVyLm9yZGVyW3VzZXJPcmRlci5vcmRlci5sZW5ndGggLSAxXS5uYW1lICsgJyB0byB0aGUgb3JkZXIhJyk7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5ld09yZGVySXRlbUZvcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlUGFnZVRvdGFscygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlRm9vZEl0ZW0gPSBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuZmluZFVzZXJPcmRlcigpLm9yZGVyLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB2bS5vcmRlcnMuJHNhdmUodm0uc2VsZWN0ZWRPcmRlcilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnUmVtb3ZlZCAnICsgaXRlbS5uYW1lICsgJyBmcm9tIHRoZSBvcmRlciEnKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVQYWdlVG90YWxzKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5nZXRVc2Vyc09yZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPcmRlcldpdGhEZXRhaWxzKCkgfHwgdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdG90YWwgPSAwO1xuICAgICAgICAgICAgKHZtLmZpbmRVc2VyT3JkZXIoKS5vcmRlciB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHRvdGFsICs9IGl0ZW0ucHJpY2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAodG90YWwgLyAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5nZXRPcmRlclRvdGFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghaGFzT3JkZXJXaXRoRGV0YWlscygpIHx8IHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRvdGFsID0gMDtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscy5mb3JFYWNoKGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGV0YWlsLm9yZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGRldGFpbC5vcmRlci5mb3JFYWNoKGZ1bmN0aW9uIChvcmRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gb3JkZXIucHJpY2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuICh0b3RhbCAvIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnVwZGF0ZVBhZ2VUb3RhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWhhc09yZGVyV2l0aERldGFpbHMoKSB8fCB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZtLnRvdGFsQ291bnRzID0ge307XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMuZm9yRWFjaChmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRldGFpbC5vcmRlcikge1xuICAgICAgICAgICAgICAgICAgICBkZXRhaWwub3JkZXIuZm9yRWFjaChmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdm0udG90YWxDb3VudHNbb3JkZXIubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50b3RhbENvdW50c1tvcmRlci5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogb3JkZXIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2U6IG9yZGVyLnByaWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsQ291bnRzW29yZGVyLm5hbWVdLmNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGhhc09yZGVyV2l0aERldGFpbHMoKSB7XG4gICAgICAgICAgICByZXR1cm4gdm0uc2VsZWN0ZWRPcmRlciAmJiB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHM7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLndpemFyZCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdXaXphcmRDdHJsJywgV2l6YXJkQ3RybCk7XG5cbn0pKCk7Il0sInNvdXJjZVJvb3QiOiJhcHAifQ==