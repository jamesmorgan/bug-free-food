"use strict";!function(){var requires=["ngRoute","firebase","app.controllers","app.services","app.filters","app.directives","app.models","app.routes","app.interceptors","app.notify"];angular.module("app",requires)}(),function(){angular.module("app.controllers",["app.controllers.home","app.controllers.menus","app.controllers.orders","app.controllers.restaurant","app.controllers.wizard"])}(),function(){angular.module("app.directives",[])}(),function(){angular.module("app.filters",[])}(),function(){angular.module("app.interceptors",[])}(),function(){angular.module("app.models",[])}(),function(){angular.module("app.notify",["cgNotify"]),angular.module("app.notify").run(["notify",function(notify){notify.config({duration:2e3,templateUrl:"/www-build/views/templates/angular-notify.html"})}])}(),function(){angular.module("app.services",[])}(),function(){angular.module("app.controllers.home",[])}(),function(){angular.module("app.controllers.menus",[])}(),function(){angular.module("app.controllers.orders",[])}(),function(){angular.module("app.controllers.restaurant",[])}(),function(){angular.module("app.controllers.wizard",[])}(),function(){angular.module("app").constant("version","0.0.1")}(),function(){var Routes=["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/www-build/views/partials/home/index.html",controller:"HomeCtrl as hc"}),$routeProvider.when("/orders/list",{templateUrl:"/www-build/views/partials/orders/orders.html",controller:"OrdersCtrl as vm"}),$routeProvider.when("/orders/create",{templateUrl:"/www-build/views/partials/orders/create.html",controller:"CreateOrderCtrl as vm"}),$routeProvider.when("/menus/list",{templateUrl:"/www-build/views/partials/menus/menus.html",controller:"ListMenusCtrl as lmc"}),$routeProvider.when("/menus/create",{templateUrl:"/www-build/views/partials/menus/create.html",controller:"CreateMenuCtrl as cmc"}),$routeProvider.when("/restaurants/list",{templateUrl:"/www-build/views/partials/restaurant/restaurant.html",controller:"ListRestaurantCtrl as lrc"}),$routeProvider.when("/restaurants/create",{templateUrl:"/www-build/views/partials/restaurant/create.html",controller:"CreateRestaurantCtrl as crc"}),$routeProvider.when("/wizard/new-order",{templateUrl:"/www-build/views/partials/wizard/new-order.html",controller:"WizardCtrl as wc"}),$routeProvider.otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!1)}];Routes.$inject=["$routeProvider","$locationProvider"],angular.module("app.routes",[]).config(Routes)}(),function(){function AppCtrl($log,$rootScope,NotifyService){$rootScope.$on("$routeChangeError",function(event,current,previous,rejection){var message="Failed to change route ["+(rejection.data.error?rejection.data.error:rejection.data)+"]";$log.error(message),NotifyService.danger(message)})}AppCtrl.$inject=["$log","$rootScope","NotifyService"],angular.module("app.controllers").controller("AppCtrl",AppCtrl)}(),function(){angular.module("app.interceptors").factory("loggingInterceptor",["$q","$log",function($q,$log){function isPartial(url){return-1===url.indexOf("partials")}return{request:function(config){return isPartial(config.url)&&$log.debug("Http Request ["+config.method+"]["+config.url+"]"),config},requestError:function(config){return $log.error("Http Request Error ["+config.method+"]["+config.url+"]"),config},response:function(response){return isPartial(response.config.url)&&$log.debug("Http Response Success: Status ["+response.status+"] to ["+response.config.method+"]["+response.config.url+"]"),response},responseError:function(rejection){return $log.error("Http Response Error: Status ["+rejection.status+"] to ["+rejection.config.method+"]["+rejection.config.url+"] data ["+(rejection.data.error?rejection.data.error:rejection.data)+"]"),$q.reject(rejection)}}}]),angular.module("app.interceptors").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("loggingInterceptor")}])}(),function(){var NotifyService=["notify",function(notify){this.danger=function(message){notify({message:message,classes:"alert-danger"})},this.warning=function(message){notify({message:message,classes:"alert-warning"})},this.success=function(message){notify({message:message,classes:"alert-success"})},this.info=function(message){notify({message:message,classes:"alert-info"})}}];NotifyService.$inject=["notify"],angular.module("app.notify").service("NotifyService",NotifyService)}(),function(){var DateService=function(){this.now=function(){return new Date},this.getTime=function(){return this.now().getTime()}};angular.module("app.services").service("DateService",DateService)}(),function(){function HomeCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/"),sync=$firebase(ref);vm.data=sync.$asObject()}HomeCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.home").controller("HomeCtrl",HomeCtrl)}(),function(){function CreateMenuCtrl($log,NotifyService,Firebase,$firebase){var vm=this,restaurantsRef=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),restaurantsSync=$firebase(restaurantsRef);vm.restaurants=restaurantsSync.$asArray(),console.log(vm.restaurants);var menuRef=new Firebase("https://bug-free-food.firebaseio.com/menus"),menuSync=$firebase(menuRef);vm.menus=menuSync.$asArray(),console.log(vm.menus),vm.selectedRestaurant={},vm.newMenu={name:"",foods:[{name:"",price:0}],createdDate:Date.now()},this.createMenu=function(){console.log("Adding new menu [%s]",angular.toJson(vm.newMenu)),console.log(vm.selectedRestaurant),vm.selectedRestaurant.menus||(vm.selectedRestaurant.menus=[]),vm.selectedRestaurant.menus.push(vm.newMenu),vm.restaurants.$save(vm.selectedRestaurant),console.log(vm.restaurants),vm.newMenu={name:"",foods:[{name:"",price:0}],createdDate:Date.now()}},this.removeFood=function(food,index){vm.newMenu.foods.splice(index,1)},this.addFood=function(){vm.newMenu.foods.push({name:"",price:0})}}CreateMenuCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.menus").controller("CreateMenuCtrl",CreateMenuCtrl)}(),function(){function ListMenusCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.restaurants=sync.$asArray(),console.log(vm.restaurants),this.removeMenuAtIndex=function(resturant,index){resturant.menus.splice(index,1),vm.restaurants.$save(resturant)}}ListMenusCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.menus").controller("ListMenusCtrl",ListMenusCtrl)}(),function(){function OrdersCtrl($log,NotifyService,Firebase,$firebase){function resetForm(){vm.newOrder={createdBy:"",name:"",createdDate:""}}var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/orders"),sync=$firebase(ref);vm.orders=sync.$asArray(),resetForm(),vm.availableUsers=["James Morgan","Andy Gray","Simon Souter","Alex Lashford"],this.createOrder=function(){vm.orders.$add(angular.copy(vm.newOrder)).then(function(){NotifyService.success("Successfully added order")},function(){NotifyService.danger("Unable to save order")}),resetForm()},this.removeOrder=function(order){vm.orders.$remove(order).then(function(){NotifyService.success("Successfully removed order")},function(){NotifyService.danger("Unable to remove order")})}}OrdersCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.orders").controller("OrdersCtrl",OrdersCtrl)}(),function(){function CreateRestaurantCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.resturants=sync.$asArray(),console.log(vm.resturants),vm.newRestaurant={name:"",createdDate:Date.now(),menus:[]},this.addRestaurant=function(){$log.debug("Adding new restaurants [%s]",vm.newRestaurant),vm.resturants.$add(angular.copy(vm.newRestaurant)),vm.newRestaurant={name:"",createdDate:Date.now(),menus:[]}}}CreateRestaurantCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.restaurant").controller("CreateRestaurantCtrl",CreateRestaurantCtrl)}(),function(){function ListRestaurantCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.restaurants=sync.$asArray()}ListRestaurantCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.restaurant").controller("ListRestaurantCtrl",ListRestaurantCtrl)}(),function(){function WizardCtrl(){var vm=this;vm.availableRestaurants=[{name:"Abduls Levenshulme",openingTimes:"...",foods:[{name:"Small Chicken Naan",price:380},{name:"Small Chicken Chapatti",price:300},{name:"Chicken Lamb Mix Naan",price:600},{name:"Chicken Lamb Mix Chapatti",price:600},{name:"Large Chicken Naan",price:600},{name:"Large Chicken Chapatti",price:600},{name:"Large Lamb Naan",price:600},{name:"Large Lamb Chapatti",price:600},{name:"Chicken Seekh Mix Naan",price:600},{name:"Small Seekh Naan",price:290},{name:"Small Seekh Chapatti",price:290},{name:"Large Seekh Naan",price:370},{name:"Large Seekh Chapatti",price:370},{name:"Small Chips",price:130},{name:"Large Chips",price:200},{name:"Chicken Donner",price:350}]}],vm.availableUsers=["James Morgan","Andy Gray","Simon Souter","Alex Lashford"],vm.availableOrders=[{name:"Friday Kebabs",created:Date.now()}],vm.selectedRestaurant={},vm.myOrder={foods:[]},this.restaurantSelected=function(){vm.myOrder.foods=[{}]},this.addFoodItem=function(){vm.myOrder.foods.push({})},this.removeFoodItem=function($index){vm.myOrder.foods.splice($index,1)},this.getOrderTotals=function(){if(!vm.myOrder.foods||vm.myOrder.foods.length<=0)return 0;var total=0;return vm.myOrder.foods.forEach(function(item){item.food&&item.food.price&&(total+=item.food.price)}),(total/100).toFixed(2)}}WizardCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.wizard").controller("WizardCtrl",WizardCtrl)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9fbW9kdWxlLmpzIiwianMvZGlyZWN0aXZlcy9fbW9kdWxlLmpzIiwianMvZmlsdGVycy9fbW9kdWxlLmpzIiwianMvaW50ZXJjZXB0b3JzL19tb2R1bGUuanMiLCJqcy9tb2RlbHMvX21vZHVsZS5qcyIsImpzL25vdGlmeS9fbW9kdWxlLmpzIiwianMvc2VydmljZXMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL2hvbWUvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL21lbnVzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9vcmRlcnMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3Jlc3RhdXJhbnQvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3dpemFyZC9fbW9kdWxlLmpzIiwianMvY29uc3RhbnRzLmpzIiwianMvcm91dGVzLmpzIiwianMvY29udHJvbGxlcnMvQXBwQ3RybC5qcyIsImpzL2ludGVyY2VwdG9ycy9IdHRwTG9nZ2luZ0ludGVyY2VwdG9yLmpzIiwianMvbm90aWZ5L05vdGlmeVNlcnZpY2UuanMiLCJqcy9zZXJ2aWNlcy9EYXRlU2VydmljZS5qcyIsImpzL2NvbnRyb2xsZXJzL2hvbWUvSG9tZUN0cmwuanMiLCJqcy9jb250cm9sbGVycy9tZW51cy9DcmVhdGVNZW51Q3RybC5qcyIsImpzL2NvbnRyb2xsZXJzL21lbnVzL0xpc3RNZW51c0N0cmwuanMiLCJqcy9jb250cm9sbGVycy9vcmRlcnMvT3JkZXJzQ3RybC5qcyIsImpzL2NvbnRyb2xsZXJzL3Jlc3RhdXJhbnQvQ3JlYXRlUmVzdGF1cmFudEN0cmwuanMiLCJqcy9jb250cm9sbGVycy9yZXN0YXVyYW50L0xpc3RSZXN0YXVyYW50Q3RybC5qcyIsImpzL2NvbnRyb2xsZXJzL3dpemFyZC9XaXphcmRDdHJsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGNBRUEsV0FFQSxHQUFBLFdBRUEsVUFDQSxXQUVBLGtCQUNBLGVBQ0EsY0FDQSxpQkFDQSxhQUNBLGFBQ0EsbUJBQ0EsYUFHQSxTQUFBLE9BQUEsTUFBQSxhQ2pCQSxXQUVBLFFBQUEsT0FBQSxtQkFDQSx1QkFDQSx3QkFDQSx5QkFDQSw2QkFDQSw4QkNQQSxXQUVBLFFBQUEsT0FBQSx3QkNGQSxXQUVBLFFBQUEsT0FBQSxxQkNGQSxXQUVBLFFBQUEsT0FBQSwwQkNGQSxXQUNBLFFBQUEsT0FBQSxvQkNEQSxXQUVBLFFBQUEsT0FBQSxjQUFBLGFBRUEsUUFBQSxPQUFBLGNBQUEsS0FBQSxTQUFBLFNBQUEsUUFDQSxPQUFBLFFBQ0EsU0FBQSxJQUNBLFlBQUEseURDUEEsV0FDQSxRQUFBLE9BQUEsc0JDREEsV0FFQSxRQUFBLE9BQUEsOEJDRkEsV0FFQSxRQUFBLE9BQUEsK0JDRkEsV0FFQSxRQUFBLE9BQUEsZ0NDRkEsV0FFQSxRQUFBLE9BQUEsb0NDRkEsV0FFQSxRQUFBLE9BQUEsZ0NDRkEsV0FLQSxRQUFBLE9BQUEsT0FBQSxTQUFBLFVBQUEsWUNOQSxXQUtBLEdBQUEsU0FBQSxpQkFBQSxvQkFBQSxTQUFBLGVBQUEsbUJBRUEsZUFBQSxLQUFBLEtBQ0EsWUFBQSw0Q0FDQSxXQUFBLG1CQU1BLGVBQUEsS0FBQSxnQkFDQSxZQUFBLCtDQUNBLFdBQUEscUJBRUEsZUFBQSxLQUFBLGtCQUNBLFlBQUEsK0NBQ0EsV0FBQSwwQkFNQSxlQUFBLEtBQUEsZUFDQSxZQUFBLDZDQUNBLFdBQUEseUJBRUEsZUFBQSxLQUFBLGlCQUNBLFlBQUEsOENBQ0EsV0FBQSwwQkFNQSxlQUFBLEtBQUEscUJBQ0EsWUFBQSx1REFDQSxXQUFBLDhCQUVBLGVBQUEsS0FBQSx1QkFDQSxZQUFBLG1EQUNBLFdBQUEsZ0NBSUEsZUFBQSxLQUFBLHFCQUNBLFlBQUEsa0RBQ0EsV0FBQSxxQkFNQSxlQUFBLFdBQ0EsV0FBQSxNQUlBLGtCQUFBLFdBQUEsMkRBSUEsUUFDQSxPQUFBLGlCQUNBLE9BQUEsV0NuRUEsV0FLQSxRQUFBLFNBQUEsS0FBQSxXQUFBLGVBS0EsV0FBQSxJQUFBLG9CQUFBLFNBQUEsTUFBQSxRQUFBLFNBQUEsV0FDQSxHQUFBLFNBQUEsNEJBQUEsVUFBQSxLQUFBLE1BQUEsVUFBQSxLQUFBLE1BQUEsVUFBQSxNQUFBLEdBQ0EsTUFBQSxNQUFBLFNBQ0EsY0FBQSxPQUFBLGlFQUtBLFFBQ0EsT0FBQSxtQkFDQSxXQUFBLFVBQUEsWUNwQkEsV0FLQSxRQUFBLE9BQUEsb0JBQUEsUUFBQSxzQkFBQSxLQUFBLE9BQUEsU0FBQSxHQUFBLE1BRUEsUUFBQSxXQUFBLEtBQ0EsTUFBQSxLQUFBLElBQUEsUUFBQSxZQUdBLE9BQ0EsUUFBQSxTQUFBLFFBSUEsTUFIQSxXQUFBLE9BQUEsTUFDQSxLQUFBLE1BQUEsaUJBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxJQUFBLEtBRUEsUUFHQSxhQUFBLFNBQUEsUUFFQSxNQURBLE1BQUEsTUFBQSx1QkFBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLElBQUEsS0FDQSxRQUdBLFNBQUEsU0FBQSxVQUlBLE1BSEEsV0FBQSxTQUFBLE9BQUEsTUFDQSxLQUFBLE1BQUEsa0NBQUEsU0FBQSxPQUFBLFNBQUEsU0FBQSxPQUFBLE9BQUEsS0FBQSxTQUFBLE9BQUEsSUFBQSxLQUVBLFVBR0EsY0FBQSxTQUFBLFdBRUEsTUFEQSxNQUFBLE1BQUEsZ0NBQUEsVUFBQSxPQUFBLFNBQUEsVUFBQSxPQUFBLE9BQUEsS0FBQSxVQUFBLE9BQUEsSUFBQSxZQUFBLFVBQUEsS0FBQSxNQUFBLFVBQUEsS0FBQSxNQUFBLFVBQUEsTUFBQSxLQUNBLEdBQUEsT0FBQSxnQkFLQSxRQUFBLE9BQUEsb0JBQUEsUUFBQSxnQkFBQSxTQUFBLGVBQ0EsY0FBQSxhQUFBLEtBQUEsNEJDdkNBLFdBS0EsR0FBQSxnQkFBQSxTQUFBLFNBQUEsUUFPQSxLQUFBLE9BQUEsU0FBQSxTQUNBLFFBQUEsUUFBQSxRQUFBLFFBQUEsa0JBUUEsS0FBQSxRQUFBLFNBQUEsU0FDQSxRQUFBLFFBQUEsUUFBQSxRQUFBLG1CQVFBLEtBQUEsUUFBQSxTQUFBLFNBQ0EsUUFBQSxR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ZUFBQSxTQUFBLFFBQ0EsR0FBQSxRQUFBLE1BQUEsT0FBQSxPQUFBLElBR0EsS0FBQSxlQUFBLFdBQ0EsSUFBQSxHQUFBLFFBQUEsT0FBQSxHQUFBLFFBQUEsTUFBQSxRQUFBLEVBQ0EsTUFBQSxFQUVBLElBQUEsT0FBQSxDQU1BLE9BTEEsSUFBQSxRQUFBLE1BQUEsUUFBQSxTQUFBLE1BQ0EsS0FBQSxNQUFBLEtBQUEsS0FBQSxRQUNBLE9BQUEsS0FBQSxLQUFBLFVBR0EsTUFBQSxLQUFBLFFBQUEsdUVBSUEsUUFDQSxPQUFBLDBCQUNBLFdBQUEsYUFBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHJlcXVpcmVzID0gW1xuICAgICAgICAvLyAzcmQgUGFydHlcbiAgICAgICAgJ25nUm91dGUnLFxuICAgICAgICAnZmlyZWJhc2UnLFxuICAgICAgICAvLyBJbnRlcm5hbHNcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycycsXG4gICAgICAgICdhcHAuc2VydmljZXMnLFxuICAgICAgICAnYXBwLmZpbHRlcnMnLFxuICAgICAgICAnYXBwLmRpcmVjdGl2ZXMnLFxuICAgICAgICAnYXBwLm1vZGVscycsXG4gICAgICAgICdhcHAucm91dGVzJyxcbiAgICAgICAgJ2FwcC5pbnRlcmNlcHRvcnMnLFxuICAgICAgICAnYXBwLm5vdGlmeSdcbiAgICBdO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIHJlcXVpcmVzKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzJywgW1xuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLmhvbWUnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLm1lbnVzJyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5vcmRlcnMnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLndpemFyZCdcbiAgICBdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXJzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaW50ZXJjZXB0b3JzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm1vZGVscycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5vdGlmeScsIFsnY2dOb3RpZnknXSk7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5vdGlmeScpLnJ1bihmdW5jdGlvbiAobm90aWZ5KSB7XG4gICAgICAgIG5vdGlmeS5jb25maWcoe1xuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvdGVtcGxhdGVzL2FuZ3VsYXItbm90aWZ5Lmh0bWwnXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJywgW10pO1xufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLmhvbWUnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5tZW51cycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy53aXphcmQnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQmFzaWMgYXBwIHZlcnNpb24gY29uc3RhbnRcbiAgICAgKi9cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ3ZlcnNpb24nLCAnMC4wLjEnKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIFJvdXRlcyA9IGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcblxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL2hvbWUvaW5kZXguaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwgYXMgaGMnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcmRlcnMgTWFuYWdlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL29yZGVycy9saXN0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL29yZGVycy9vcmRlcnMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnT3JkZXJzQ3RybCBhcyB2bSdcbiAgICAgICAgfSk7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9vcmRlcnMvY3JlYXRlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL29yZGVycy9jcmVhdGUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ3JlYXRlT3JkZXJDdHJsIGFzIHZtJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWVudXMgTWFuYWdlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL21lbnVzL2xpc3QnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvbWVudXMvbWVudXMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTGlzdE1lbnVzQ3RybCBhcyBsbWMnXG4gICAgICAgIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvbWVudXMvY3JlYXRlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL21lbnVzL2NyZWF0ZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDcmVhdGVNZW51Q3RybCBhcyBjbWMnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXN0YXVyYW50IE1hbmFnZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9yZXN0YXVyYW50cy9saXN0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL3Jlc3RhdXJhbnQvcmVzdGF1cmFudC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMaXN0UmVzdGF1cmFudEN0cmwgYXMgbHJjJ1xuICAgICAgICB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3Jlc3RhdXJhbnRzL2NyZWF0ZScsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9yZXN0YXVyYW50L2NyZWF0ZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDcmVhdGVSZXN0YXVyYW50Q3RybCBhcyBjcmMnXG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3dpemFyZC9uZXctb3JkZXInLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvd2l6YXJkL25ldy1vcmRlci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdXaXphcmRDdHJsIGFzIHdjJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmFsbGJhY2tcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLm90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRGlzYWJsZSBodG1sIDUgbW9kZSBkdWUgdG8gSUU5IGNvbXBhdGliaWxpdHkgcmVxdWlyZW1lbnQhXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShmYWxzZSk7XG5cbiAgICB9O1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAucm91dGVzJywgW10pXG4gICAgICAgIC5jb25maWcoUm91dGVzKTtcblxuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEFwcEN0cmwoJGxvZywgJHJvb3RTY29wZSwgTm90aWZ5U2VydmljZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKFwiJHJvdXRlQ2hhbmdlRXJyb3JcIiwgZnVuY3Rpb24gKGV2ZW50LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICdGYWlsZWQgdG8gY2hhbmdlIHJvdXRlIFsnICsgKHJlamVjdGlvbi5kYXRhLmVycm9yID8gcmVqZWN0aW9uLmRhdGEuZXJyb3IgOiByZWplY3Rpb24uZGF0YSkgKyAnXSc7XG4gICAgICAgICAgICAkbG9nLmVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIobWVzc2FnZSk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMnKVxuICAgICAgICAuY29udHJvbGxlcignQXBwQ3RybCcsIEFwcEN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaW50ZXJjZXB0b3JzJykuZmFjdG9yeSgnbG9nZ2luZ0ludGVyY2VwdG9yJywgZnVuY3Rpb24gKCRxLCAkbG9nKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gaXNQYXJ0aWFsKHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHVybC5pbmRleE9mKCdwYXJ0aWFscycpID09PSAtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAncmVxdWVzdCc6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQYXJ0aWFsKGNvbmZpZy51cmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoJ0h0dHAgUmVxdWVzdCBbJyArIGNvbmZpZy5tZXRob2QgKyAnXVsnICsgY29uZmlnLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncmVxdWVzdEVycm9yJzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0h0dHAgUmVxdWVzdCBFcnJvciBbJyArIGNvbmZpZy5tZXRob2QgKyAnXVsnICsgY29uZmlnLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdyZXNwb25zZSc6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChpc1BhcnRpYWwocmVzcG9uc2UuY29uZmlnLnVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZygnSHR0cCBSZXNwb25zZSBTdWNjZXNzOiBTdGF0dXMgWycgKyByZXNwb25zZS5zdGF0dXMgKyAnXSB0byBbJyArIHJlc3BvbnNlLmNvbmZpZy5tZXRob2QgKyAnXVsnICsgcmVzcG9uc2UuY29uZmlnLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdyZXNwb25zZUVycm9yJzogZnVuY3Rpb24gKHJlamVjdGlvbikge1xuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0h0dHAgUmVzcG9uc2UgRXJyb3I6IFN0YXR1cyBbJyArIHJlamVjdGlvbi5zdGF0dXMgKyAnXSB0byBbJyArIHJlamVjdGlvbi5jb25maWcubWV0aG9kICsgJ11bJyArIHJlamVjdGlvbi5jb25maWcudXJsICsgJ10gZGF0YSBbJyArIChyZWplY3Rpb24uZGF0YS5lcnJvciA/IHJlamVjdGlvbi5kYXRhLmVycm9yIDogcmVqZWN0aW9uLmRhdGEpICsgJ10nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmludGVyY2VwdG9ycycpLmNvbmZpZyhbJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJGh0dHBQcm92aWRlcikge1xuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdsb2dnaW5nSW50ZXJjZXB0b3InKTtcbiAgICB9XSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIE5vdGlmeVNlcnZpY2UgPSBmdW5jdGlvbiAobm90aWZ5KSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBEQU5HRVJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYW5nZXIgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtZGFuZ2VyJ30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGEgbm90aWZpY2F0aW9uIHdpdGggc3R5bGUgV0FSTklOR1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSB0aGUgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndhcm5pbmcgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtd2FybmluZyd9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhIG5vdGlmaWNhdGlvbiB3aXRoIHN0eWxlIFNVQ0NFU1NcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWNjZXNzID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5vdGlmeSh7bWVzc2FnZTogbWVzc2FnZSwgY2xhc3NlczogJ2FsZXJ0LXN1Y2Nlc3MnfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBJTkZPXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5mbyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBub3RpZnkoe21lc3NhZ2U6IG1lc3NhZ2UsIGNsYXNzZXM6ICdhbGVydC1pbmZvJ30pO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5ub3RpZnknKVxuICAgICAgICAuc2VydmljZSgnTm90aWZ5U2VydmljZScsIE5vdGlmeVNlcnZpY2UpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIHZhciBEYXRlU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIERhdGUgTk9XXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBEYXRlIE5PVyBpbiBzZWNvbmRzXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIG51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm93KCkuZ2V0VGltZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycpXG4gICAgICAgIC5zZXJ2aWNlKCdEYXRlU2VydmljZScsIERhdGVTZXJ2aWNlKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBIb21lQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9cIik7XG4gICAgICAgIC8vIGNyZWF0ZSBhbiBBbmd1bGFyRmlyZSByZWZlcmVuY2UgdG8gdGhlIGRhdGFcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcbiAgICAgICAgLy8gZG93bmxvYWQgdGhlIGRhdGEgaW50byBhIGxvY2FsIG9iamVjdFxuICAgICAgICB2bS5kYXRhID0gc3luYy4kYXNPYmplY3QoKTtcblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLmhvbWUnKVxuICAgICAgICAuY29udHJvbGxlcignSG9tZUN0cmwnLCBIb21lQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQ3JlYXRlTWVudUN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vIHJlc3RhdXJhbnRzUmVmXG4gICAgICAgIHZhciByZXN0YXVyYW50c1JlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHJlc3RhdXJhbnRzU3luYyA9ICRmaXJlYmFzZShyZXN0YXVyYW50c1JlZik7XG5cbiAgICAgICAgdm0ucmVzdGF1cmFudHMgPSByZXN0YXVyYW50c1N5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdGF1cmFudHMpO1xuXG4gICAgICAgIC8vIG1lbnVSZWZcbiAgICAgICAgdmFyIG1lbnVSZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vbWVudXNcIik7XG4gICAgICAgIHZhciBtZW51U3luYyA9ICRmaXJlYmFzZShtZW51UmVmKTtcblxuICAgICAgICB2bS5tZW51cyA9IG1lbnVTeW5jLiRhc0FycmF5KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHZtLm1lbnVzKTtcblxuICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQgPSB7fTtcbiAgICAgICAgdm0ubmV3TWVudSA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgZm9vZHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLCBwcmljZTogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuY3JlYXRlTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgbmV3IG1lbnUgWyVzXScsIGFuZ3VsYXIudG9Kc29uKHZtLm5ld01lbnUpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLnNlbGVjdGVkUmVzdGF1cmFudCk7XG5cbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQubWVudXMucHVzaCh2bS5uZXdNZW51KTtcblxuICAgICAgICAgICAgdm0ucmVzdGF1cmFudHMuJHNhdmUodm0uc2VsZWN0ZWRSZXN0YXVyYW50KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLnJlc3RhdXJhbnRzKTtcblxuICAgICAgICAgICAgdm0ubmV3TWVudSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5yZW1vdmVGb29kID0gZnVuY3Rpb24gKGZvb2QsIGluZGV4KSB7XG4gICAgICAgICAgICB2bS5uZXdNZW51LmZvb2RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hZGRGb29kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubmV3TWVudS5mb29kcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4vLyAgICAgICAgU21hbGwgQ2hpY2tlbiBOYWFuXHTCozMuODBcbi8vICAgICAgICBTbWFsbCBDaGlja2VuIENoYXBhdHRpXHTCozMuODBcbi8vICAgICAgICBDaGlja2VuIExhbWIgTWl4IE5hYW5cdMKjNi4wMFxuLy8gICAgICAgIENoaWNrZW4gTGFtYiBNaXggQ2hhcGF0dGlcdMKjNi4wMFxuLy8gICAgICAgIExhcmdlIENoaWNrZW4gTmFhblx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgTGFtYiBOYWFuXHTCozYuMDBcbi8vICAgICAgICBMYXJnZSBMYW1iIENoYXBhdHRpXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIFNlZWtoIE1peCBOYWFuXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIFNlZWtoIE1peCBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgU21hbGwgU2Vla2ggTmFhblx0wqMyLjkwXG4vLyAgICAgICAgU21hbGwgU2Vla2ggQ2hhcGF0dGlcdMKjMi45MFxuLy8gICAgICAgIExhcmdlIFNlZWtoIE5hYW5cdMKjMy43MFxuLy8gICAgICAgIExhcmdlIFNlZWtoIENoYXBhdHRpXHTCozMuNzBcbi8vICAgICAgICBTbWFsbCBDaGlwc1x0wqMxLjMwXG4vLyAgICAgICAgTGFyZ2UgQ2hpcHNcdMKjMi4wMFxuLy8gICAgICAgIENoaWNrZW4gRG9ubmVyXHTCozMuNTBcblxuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnKVxuICAgICAgICAuY29udHJvbGxlcignQ3JlYXRlTWVudUN0cmwnLCBDcmVhdGVNZW51Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTGlzdE1lbnVzQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcblxuICAgICAgICB2bS5yZXN0YXVyYW50cyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0YXVyYW50cyk7XG5cbiAgICAgICAgdGhpcy5yZW1vdmVNZW51QXRJbmRleCA9IGZ1bmN0aW9uIChyZXN0dXJhbnQsIGluZGV4KSB7XG4gICAgICAgICAgICByZXN0dXJhbnQubWVudXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHZtLnJlc3RhdXJhbnRzLiRzYXZlKHJlc3R1cmFudCk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnKVxuICAgICAgICAuY29udHJvbGxlcignTGlzdE1lbnVzQ3RybCcsIExpc3RNZW51c0N0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE9yZGVyc0N0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vb3JkZXJzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLm9yZGVycyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICByZXNldEZvcm0oKTtcblxuICAgICAgICAvLyBFbXBsb3llZXNcbiAgICAgICAgdm0uYXZhaWxhYmxlVXNlcnMgPSBbJ0phbWVzIE1vcmdhbicsICdBbmR5IEdyYXknLCAnU2ltb24gU291dGVyJywgJ0FsZXggTGFzaGZvcmQnXTtcblxuICAgICAgICB0aGlzLmNyZWF0ZU9yZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ub3JkZXJzLiRhZGQoYW5ndWxhci5jb3B5KHZtLm5ld09yZGVyKSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IGFkZGVkIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLmRhbmdlcignVW5hYmxlIHRvIHNhdmUgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc2V0Rm9ybSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlT3JkZXIgPSBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgIHZtLm9yZGVycy4kcmVtb3ZlKG9yZGVyKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVtb3ZlZCBvcmRlcicpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoJ1VuYWJsZSB0byByZW1vdmUgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiByZXNldEZvcm0oKSB7XG4gICAgICAgICAgICB2bS5uZXdPcmRlciA9IHtcbiAgICAgICAgICAgICAgICBjcmVhdGVkQnk6ICcnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWREYXRlOiAnJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycpXG4gICAgICAgIC5jb250cm9sbGVyKCdPcmRlcnNDdHJsJywgT3JkZXJzQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQ3JlYXRlUmVzdGF1cmFudEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0ucmVzdHVyYW50cyA9IHN5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdHVyYW50cyk7XG5cbiAgICAgICAgdm0ubmV3UmVzdGF1cmFudCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KCksXG4gICAgICAgICAgICBtZW51czogW11cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFkZFJlc3RhdXJhbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdBZGRpbmcgbmV3IHJlc3RhdXJhbnRzIFslc10nLCB2bS5uZXdSZXN0YXVyYW50KTtcblxuICAgICAgICAgICAgdm0ucmVzdHVyYW50cy4kYWRkKGFuZ3VsYXIuY29weSh2bS5uZXdSZXN0YXVyYW50KSk7XG5cbiAgICAgICAgICAgIHZtLm5ld1Jlc3RhdXJhbnQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgbWVudXM6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnKVxuICAgICAgICAuY29udHJvbGxlcignQ3JlYXRlUmVzdGF1cmFudEN0cmwnLCBDcmVhdGVSZXN0YXVyYW50Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTGlzdFJlc3RhdXJhbnRDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL3Jlc3RhdXJhbnRzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLnJlc3RhdXJhbnRzID0gc3luYy4kYXNBcnJheSgpO1xuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdMaXN0UmVzdGF1cmFudEN0cmwnLCBMaXN0UmVzdGF1cmFudEN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFdpemFyZEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vIEF2YWlsYWJsZSBwYWdlIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgdm0uYXZhaWxhYmxlUmVzdGF1cmFudHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0FiZHVscyBMZXZlbnNodWxtZScsXG4gICAgICAgICAgICAgICAgb3BlbmluZ1RpbWVzOiAnLi4uJyxcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gTmFhbicsIHByaWNlOiAzODB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gQ2hhcGF0dGknLCBwcmljZTogMzAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IE5hYW4nLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IENoYXBhdHRpJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aScsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgTmFhbicsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgQ2hhcGF0dGknLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIFNlZWtoIE1peCBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgU2Vla2ggTmFhbicsIHByaWNlOiAyOTB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDI5MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgU2Vla2ggTmFhbicsIHByaWNlOiAzNzB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDM3MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgQ2hpcHMnLCBwcmljZTogMTMwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBDaGlwcycsIHByaWNlOiAyMDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0NoaWNrZW4gRG9ubmVyJywgcHJpY2U6IDM1MH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgLy8gRW1wbG95ZWVzXG4gICAgICAgIHZtLmF2YWlsYWJsZVVzZXJzID0gWydKYW1lcyBNb3JnYW4nLCAnQW5keSBHcmF5JywgJ1NpbW9uIFNvdXRlcicsICdBbGV4IExhc2hmb3JkJ107XG5cbiAgICAgICAgdm0uYXZhaWxhYmxlT3JkZXJzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdGcmlkYXkgS2ViYWJzJywgY3JlYXRlZDogRGF0ZS5ub3coKVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLnNlbGVjdGVkUmVzdGF1cmFudCA9IHt9O1xuXG4gICAgICAgIC8vIFRoZSBkYXRhIGZvcm1cbiAgICAgICAgdm0ubXlPcmRlciA9IHtcbiAgICAgICAgICAgIGZvb2RzOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVzdGF1cmFudFNlbGVjdGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubXlPcmRlci5mb29kcyA9IFtcbiAgICAgICAgICAgICAgICB7fVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFkZEZvb2RJdGVtID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubXlPcmRlci5mb29kcy5wdXNoKHt9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnJlbW92ZUZvb2RJdGVtID0gZnVuY3Rpb24gKCRpbmRleCkge1xuICAgICAgICAgICAgdm0ubXlPcmRlci5mb29kcy5zcGxpY2UoJGluZGV4LCAxKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdldE9yZGVyVG90YWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF2bS5teU9yZGVyLmZvb2RzIHx8IHZtLm15T3JkZXIuZm9vZHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB0b3RhbCA9IDA7XG4gICAgICAgICAgICB2bS5teU9yZGVyLmZvb2RzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZihpdGVtLmZvb2QgJiYgaXRlbS5mb29kLnByaWNlKXtcbiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gaXRlbS5mb29kLnByaWNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuICh0b3RhbCAvIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy53aXphcmQnKVxuICAgICAgICAuY29udHJvbGxlcignV2l6YXJkQ3RybCcsIFdpemFyZEN0cmwpO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiYXBwIn0=