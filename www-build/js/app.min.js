'use strict';

(function () {

    var requires = [
        // 3rd Party
        'ngRoute',
        'firebase',
        'ui.bootstrap',
        // 3rd party wrappers
        'app.libs.firebase.utils',
        // Internals
        'app.controllers',
        'app.services',
        'app.filters',
        'app.directives',
        'app.models',
        'app.routes',
        'app.interceptors',
        'app.notify'
    ];

    angular.module('app', requires);

})();
'use strict';

(function () {

    angular.module('app.controllers', [
        'app.controllers.home',
        'app.controllers.menus',
        'app.controllers.orders',
        'app.controllers.restaurant',
        'app.controllers.order-wizard',
        'app.controllers.navigation'
    ]);

})();
'use strict';

(function () {

    angular.module('app.directives', []);

})();
'use strict';

(function () {

    angular.module('app.filters', []);

})();
'use strict';

(function () {
    angular.module('app.libs.firebase.utils', []);
})();
'use strict';

(function () {

    angular.module('app.interceptors', []);

})();
'use strict';

(function () {
    angular.module('app.models', []);

})();
'use strict';

(function () {

    angular.module('app.notify', ['cgNotify']);

    angular.module('app.notify').run(["notify", function (notify) {
        notify.config({
            duration: 2000,
            templateUrl: '/www-build/views/templates/angular-notify.html'
        });
    }]);

})();
'use strict';

(function () {
    angular.module('app.services', []);
})();
'use strict';

(function () {

    angular.module('app.controllers.home', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.menus', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.navigation', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.orders', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.restaurant', []);

})();
'use strict';

(function () {

    angular.module('app.controllers.order-wizard', []);

})();
'use strict';

(function () {

    /**
     * Basic app version constant
     */
    angular
        .module('app')

        // App version
        .constant('version', '0.0.1')

        // your Firebase data URL goes here, no trailing slash
        .constant('FBURL', 'https://bug-free-food.firebaseio.com');

})();
'use strict';
(function () {

    /**
     * @ngInject
     */
    var Routes = ["$routeProvider", "$locationProvider", function ($routeProvider, $locationProvider) {

        $routeProvider.when('/', {
            templateUrl: 'www-build/views/partials/home/index.html',
            controller: 'HomeCtrl as hc'
        });

        /**
         * Orders Management
         */
        $routeProvider.when('/orders/list', {
            templateUrl: 'www-build/views/partials/orders/orders.html',
            controller: 'OrdersCtrl as vm'
        });

        /**
         * Order Wizard
         */
        $routeProvider.when('/order-wizard/my-order/:orderId?', {
            templateUrl: 'www-build/views/partials/order-wizard/my-order.html',
            controller: 'MyOrderCtrl as vm'
        });
        $routeProvider.when('/order-wizard/place-order/:orderId', {
            templateUrl: 'www-build/views/partials/order-wizard/place-order.html',
            controller: 'PlaceOrderCtrl as vm'
        });

        /**
         * Menus Management
         */
//        $routeProvider.when('/menus/list', {
//            templateUrl: 'www-build/views/partials/menus/menus.html',
//            controller: 'ListMenusCtrl as lmc'
//        });
//        $routeProvider.when('/menus/create', {
//            templateUrl: 'www-build/views/partials/menus/create.html',
//            controller: 'CreateMenuCtrl as cmc'
//        });

        /**
         * Restaurant Management
         */
//        $routeProvider.when('/restaurants/list', {
//            templateUrl: 'www-build/views/partials/restaurant/restaurant.html',
//            controller: 'ListRestaurantCtrl as lrc'
//        });
//        $routeProvider.when('/restaurants/create', {
//            templateUrl: 'www-build/views/partials/restaurant/create.html',
//            controller: 'CreateRestaurantCtrl as crc'
//        });

        /**
         * Fallback
         */
        $routeProvider.otherwise({
            redirectTo: '/'
        });

        // Disable html 5 mode due to IE9 compatibility requirement!
        $locationProvider.html5Mode(false);

    }];
    Routes.$inject = ["$routeProvider", "$locationProvider"];

    angular
        .module('app.routes', [])
        .config(Routes);


})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function AppCtrl($log, $rootScope, NotifyService) {

        // ViewModel
        var vm = this;

        $rootScope.$on("$routeChangeError", function (event, current, previous, rejection) {
            var message = 'Failed to change route [' + (rejection.data.error ? rejection.data.error : rejection.data) + ']';
            $log.error(message);
            NotifyService.danger(message);
        });

    }
    AppCtrl.$inject = ["$log", "$rootScope", "NotifyService"];

    angular
        .module('app.controllers')
        .controller('AppCtrl', AppCtrl);

})();

// a simple wrapper on Firebase and AngularFire to simplify deps and keep things DRY
angular.module('app.libs.firebase.utils', ['firebase'])
   .factory('fbutil', ['$window', 'FBURL', '$firebase', function($window, FBURL, $firebase) {
      "use strict";

      return {
        syncObject: function(path, factoryConfig) {
          return syncData.apply(null, arguments).$asObject();
        },

        syncArray: function(path, factoryConfig) {
          return syncData.apply(null, arguments).$asArray();
        },

        ref: firebaseRef
      };

      function pathRef(args) {
        for (var i = 0; i < args.length; i++) {
          if (angular.isArray(args[i])) {
            args[i] = pathRef(args[i]);
          }
          else if( typeof args[i] !== 'string' ) {
            throw new Error('Argument '+i+' to firebaseRef is not a string: '+args[i]);
          }
        }
        return args.join('/');
      }

      /**
       * Example:
       * <code>
       *    function(firebaseRef) {
         *       var ref = firebaseRef('path/to/data');
         *    }
       * </code>
       *
       * @function
       * @name firebaseRef
       * @param {String|Array...} path relative path to the root folder in Firebase instance
       * @return a Firebase instance
       */
      function firebaseRef(path) {
        var ref = new $window.Firebase(FBURL);
        var args = Array.prototype.slice.call(arguments);
        if( args.length ) {
          ref = ref.child(pathRef(args));
        }
        return ref;
      }

      /**
       * Create a $firebase reference with just a relative path. For example:
       *
       * <code>
       * function(syncData) {
         *    // a regular $firebase ref
         *    $scope.widget = syncData('widgets/alpha');
         *
         *    // or automatic 3-way binding
         *    syncData('widgets/alpha').$bind($scope, 'widget');
         * }
       * </code>
       *
       * Props is the second param passed into $firebase. It can also contain limit, startAt, endAt,
       * and they will be applied to the ref before passing into $firebase
       *
       * @function
       * @name syncData
       * @param {String|Array...} path relative path to the root folder in Firebase instance
       * @param {object} [props]
       * @return a Firebase instance
       */
      function syncData(path, props) {
        var ref = firebaseRef(path);
        props = angular.extend({}, props);
        angular.forEach(['limit', 'startAt', 'endAt'], function(k) {
          if( props.hasOwnProperty(k) ) {
            var v = props[k];
            ref = ref[k].apply(ref, angular.isArray(v)? v : [v]);
            delete props[k];
          }
        });
        return $firebase(ref, props);
      }
   }]);


'use strict';

(function () {

    /**
     * @ngInject
     */
    angular.module('app.interceptors').factory('loggingInterceptor', ["$q", "$log", function ($q, $log) {

        function isPartial(url) {
            return url.indexOf('partials') === -1;
        }

        return {
            'request': function (config) {
                if (isPartial(config.url)) {
                    $log.debug('Http Request [' + config.method + '][' + config.url + ']');
                }
                return config;
            },

            'requestError': function (config) {
                $log.error('Http Request Error [' + config.method + '][' + config.url + ']');
                return config;
            },

            'response': function (response) {
                if (isPartial(response.config.url)) {
                    $log.debug('Http Response Success: Status [' + response.status + '] to [' + response.config.method + '][' + response.config.url + ']');
                }
                return response;
            },

            'responseError': function (rejection) {
                $log.error('Http Response Error: Status [' + rejection.status + '] to [' + rejection.config.method + '][' + rejection.config.url + '] data [' + (rejection.data.error ? rejection.data.error : rejection.data) + ']');
                return $q.reject(rejection);
            }
        };
    }]);

    angular.module('app.interceptors').config(['$httpProvider', function ($httpProvider) {
        $httpProvider.interceptors.push('loggingInterceptor');
    }]);

})();
'use strict';

(function () {
    /**
     * @ngInject
     */
    var UserModel = function () {

        return {
            /**
             * The user
             */
            user: null
        };
    };

    angular.module('app.models').factory('UserModel', UserModel);
})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    var NotifyService = ["notify", function (notify) {

        /**
         * Show a notification with style DANGER
         *
         * @param message the message to display
         */
        this.danger = function (message) {
            notify({message: message, classes: 'alert-danger'});
        };

        /**
         * Show a notification with style WARNING
         *
         * @param message the message to display
         */
        this.warning = function (message) {
            notify({message: message, classes: 'alert-warning'});
        };

        /**
         * Show a notification with style SUCCESS
         *
         * @param message the message to display
         */
        this.success = function (message) {
            notify({message: message, classes: 'alert-success'});
        };

        /**
         * Show a notification with style INFO
         *
         * @param message the message to display
         */
        this.info = function (message) {
            notify({message: message, classes: 'alert-info'});
        };
    }];
    NotifyService.$inject = ["notify"];

    angular
        .module('app.notify')
        .service('NotifyService', NotifyService);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    var DateService = function () {

        /**
         * The Date NOW
         *
         * @returns Date
         */
        this.now = function () {
            return new Date();
        };

        /**
         * The Date NOW in seconds
         *
         * @returns number
         */
        this.getTime = function () {
            return this.now().getTime();
        };
    };

    angular
        .module('app.services')
        .service('DateService', DateService);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function HomeCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/");
        // create an AngularFire reference to the data
        var sync = $firebase(ref);
        // download the data into a local object
        vm.data = sync.$asObject();

    }
    HomeCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.home')
        .controller('HomeCtrl', HomeCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function CreateMenuCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        // restaurantsRef
        var restaurantsRef = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var restaurantsSync = $firebase(restaurantsRef);

        vm.restaurants = restaurantsSync.$asArray();
        console.log(vm.restaurants);

        // menuRef
        var menuRef = new Firebase("https://bug-free-food.firebaseio.com/menus");
        var menuSync = $firebase(menuRef);

        vm.menus = menuSync.$asArray();
        console.log(vm.menus);

        vm.selectedRestaurant = {};
        vm.newMenu = {
            name: '',
            foods: [
                {
                    name: '', price: 0
                }
            ],
            createdDate: Date.now()
        };

        this.createMenu = function () {
            console.log('Adding new menu [%s]', angular.toJson(vm.newMenu));
            console.log(vm.selectedRestaurant);

            if (!vm.selectedRestaurant.menus) {
                vm.selectedRestaurant.menus = [];
            }
            vm.selectedRestaurant.menus.push(vm.newMenu);

            vm.restaurants.$save(vm.selectedRestaurant);
            console.log(vm.restaurants);

            vm.newMenu = {
                name: '',
                foods: [
                    {
                        name: '', price: 0
                    }
                ],
                createdDate: Date.now()
            };
        };

        this.removeFood = function (food, index) {
            vm.newMenu.foods.splice(index, 1);
        };

        this.addFood = function () {
            vm.newMenu.foods.push({
                name: '', price: 0
            });
        };

//        Small Chicken Naan	£3.80
//        Small Chicken Chapatti	£3.80
//        Chicken Lamb Mix Naan	£6.00
//        Chicken Lamb Mix Chapatti	£6.00
//        Large Chicken Naan	£6.00
//        Large Chicken Chapatti	£6.00
//        Large Lamb Naan	£6.00
//        Large Lamb Chapatti	£6.00
//        Chicken Seekh Mix Naan	£6.00
//        Chicken Seekh Mix Chapatti	£6.00
//        Small Seekh Naan	£2.90
//        Small Seekh Chapatti	£2.90
//        Large Seekh Naan	£3.70
//        Large Seekh Chapatti	£3.70
//        Small Chips	£1.30
//        Large Chips	£2.00
//        Chicken Donner	£3.50


    }
    CreateMenuCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.menus')
        .controller('CreateMenuCtrl', CreateMenuCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function ListMenusCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var sync = $firebase(ref);

        vm.restaurants = sync.$asArray();

        console.log(vm.restaurants);

        this.removeMenuAtIndex = function (resturant, index) {
            resturant.menus.splice(index, 1);
            vm.restaurants.$save(resturant);
        };
    }
    ListMenusCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.menus')
        .controller('ListMenusCtrl', ListMenusCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function LeftNavCtrl($log, UserModel) {

        // ViewModel
        var vm = this;

        vm.userModel = UserModel;

    }
    LeftNavCtrl.$inject = ["$log", "UserModel"];

    angular
        .module('app.controllers.navigation')
        .controller('LeftNavCtrl', LeftNavCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function TopNavCtrl($log, NotifyService, $firebaseSimpleLogin, Firebase, UserModel, fbutil) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com");

        vm.userModel = UserModel;

        vm.users = fbutil.syncArray('users');

        vm.userModel.allUsers = vm.users;

        var authClient = $firebaseSimpleLogin(ref);
        console.log(authClient);

        // TODO move to resolve!
        this.init = function () {
            authClient.$getCurrentUser().then(handleSuccessfulLogin);
        };

        this.login = function () {
            $log.debug('Login - github');
            authClient.$login('github', { rememberMe: true, scope: 'user'})
                .then(handleSuccessfulLogin, popError);
        };

        this.logout = function () {
            $log.debug('Logout');
            console.log(authClient);
            authClient.$logout();
            UserModel.user = null;
            NotifyService.success('user is logged out');
        };

        function handleSuccessfulLogin(user) {
            if (user) {

                console.log('user:', user);

//                var drinkRef = fbutil.ref('users/' + user.uid);
//                console.log('MyUser:', drinkRef);
//                drinkRef.push(user);

//                var myUser = fbutil.syncObject('users/' + user.uid);
//                console.log('MyUser:', myUser);
//
//                myUser.$add(user)
//                    .then(function () {
//                        NotifyService.success('Successfully SAVED user');
//                    }, function (err) {
//                        NotifyService.danger('Unable to SAVE user');
//                        console.log(err);
//                    });

                UserModel.user = user;
                $log.debug("User ID: " + user.uid + ", Provider: " + user.provider);
                NotifyService.success("User ID: " + user.uid + ", Provider: " + user.provider);
            }
        }

        function popError(error) {
            $log.error(error);
            NotifyService.danger(error);
        }
    }
    TopNavCtrl.$inject = ["$log", "NotifyService", "$firebaseSimpleLogin", "Firebase", "UserModel", "fbutil"];

    angular
        .module('app.controllers.navigation')
        .controller('TopNavCtrl', TopNavCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function OrdersCtrl($log, fbutil, NotifyService, UserModel) {

        // ViewModel
        var vm = this;

        vm.orders = fbutil.syncArray('orders');

        vm.userModel = UserModel;

        resetForm();

        // Users
        vm.availableUsers = ['James Morgan', 'Andy Gray', 'Simon Souter', 'Alex Lashford'];

        // Available page configuration
        vm.availableRestaurants = [
            {
                name: 'Abduls Fallowfield',
                openingTimes: 'Mon - Sun - 4pm - 3:30am',
                contactNumber: '0161 248 7573',
                address: '324 Wilmslow Rd, Manchester M14 6XQ',
                directionLink: "https://www.google.co.uk/maps/dir/''/abduls+Fallowfield/@53.4404063,-2.2884381,12z/data=!3m1!4b1!4m8!4m7!1m0!1m5!1m1!1s0x487bb230d2757a57:0x5ef709045f361c95!2m2!1d-2.219772!2d53.440426",
                foods: [
                    {name: 'Small Chicken Naan', price: 380},
                    {name: 'Small Chicken Chapatti', price: 300},
                    {name: 'Chicken Lamb Mix Naan', price: 600},
                    {name: 'Chicken Lamb Mix Chapatti', price: 600},
                    {name: 'Large Chicken Naan', price: 600},
                    {name: 'Large Chicken Chapatti', price: 600},
                    {name: 'Large Lamb Naan', price: 600},
                    {name: 'Large Lamb Chapatti', price: 600},
                    {name: 'Chicken Seekh Mix Naan', price: 600},
                    {name: 'Small Seekh Naan', price: 290},
                    {name: 'Small Seekh Chapatti', price: 290},
                    {name: 'Large Seekh Naan', price: 370},
                    {name: 'Large Seekh Chapatti', price: 370},
                    {name: 'Small Chips', price: 130},
                    {name: 'Large Chips', price: 200},
                    {name: 'Chicken Donner', price: 350}
                ]
            }
        ];

        this.createOrder = function () {

            // Set the user
            vm.newOrder.createdBy = UserModel.user;

            vm.orders.$add(angular.copy(vm.newOrder))
                .then(function () {
                    NotifyService.success('Successfully added order');
                }, function () {
                    NotifyService.danger('Unable to save order');
                });
            resetForm();
        };

        this.removeOrder = function (order) {
            vm.orders.$remove(order)
                .then(function () {
                    NotifyService.success('Successfully removed order');
                }, function () {
                    NotifyService.danger('Unable to remove order');
                });
        };

        function resetForm() {
            vm.newOrder = {
                createdBy: UserModel.user,
                name: '',
                restaurant: '',
                content: [
                    {}
                ],
                createdDate: Date.now()
            };
        }
    }
    OrdersCtrl.$inject = ["$log", "fbutil", "NotifyService", "UserModel"];

    angular
        .module('app.controllers.orders')
        .controller('OrdersCtrl', OrdersCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function CreateRestaurantCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var sync = $firebase(ref);

        vm.resturants = sync.$asArray();
        console.log(vm.resturants);

        vm.newRestaurant = {
            name: '',
            createdDate: Date.now(),
            menus: []
        };

        this.addRestaurant = function () {
            $log.debug('Adding new restaurants [%s]', vm.newRestaurant);

            vm.resturants.$add(angular.copy(vm.newRestaurant));

            vm.newRestaurant = {
                name: '',
                createdDate: Date.now(),
                menus: []
            };
        };
    }
    CreateRestaurantCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.restaurant')
        .controller('CreateRestaurantCtrl', CreateRestaurantCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function ListRestaurantCtrl($log, NotifyService, Firebase, $firebase) {

        // ViewModel
        var vm = this;

        var ref = new Firebase("https://bug-free-food.firebaseio.com/restaurants");
        var sync = $firebase(ref);

        vm.restaurants = sync.$asArray();

    }
    ListRestaurantCtrl.$inject = ["$log", "NotifyService", "Firebase", "$firebase"];

    angular
        .module('app.controllers.restaurant')
        .controller('ListRestaurantCtrl', ListRestaurantCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function MyOrderCtrl($log, $routeParams, NotifyService, fbutil, UserModel) {

        // ViewModel
        var vm = this;

        vm.optionalOrderId = $routeParams.orderId;

        vm.userModel = UserModel;
        vm.selectedOrder = undefined;
        vm.newOrderItemForm = undefined;
        vm.orders = undefined;

        if (vm.optionalOrderId) {
            $log.debug('Attempting to get order for ref [%]', vm.optionalOrderId);
            vm.selectedOrder = fbutil.syncObject('orders/' + vm.optionalOrderId);
        //} else {
        //    $log.debug('Loading all orders');
        //    vm.orders = fbutil.syncArray('orders');
        }

        $log.debug('Loading all orders');
        vm.orders = fbutil.syncArray('orders');

        // The data form
        vm.myOrder = {
            foods: []
        };

        this.initOrderForUser = function () {
            var orderDetail = {
                user: UserModel.user,
                order: []
            };

            if (hasOrderWithDetails()) {
                vm.selectedOrder.details.push(orderDetail);
            } else {
                vm.selectedOrder.details = [orderDetail]
            }
        };

        this.userHasOrder = function () {
            if (!hasOrderWithDetails() || !UserModel.user) {
                return false;
            }

            return vm.selectedOrder.details.some(function (detail) {
                return detail.user.id === UserModel.user.id
            })
        };

        this.findUserOrder = function () {
            var userDetails = vm.selectedOrder.details.filter(function (detail) {
                return detail.user.id === UserModel.user.id
            });

            if (userDetails.length === 0) {
                throw new Error('User not found in order!');
            }
            return userDetails[0];
        };

        this.addFoodItem = function () {
            var userOrder = this.findUserOrder();

            if (!userOrder.order) {
                userOrder.order = [];
            }
            userOrder.order.push(vm.newOrderItemForm);

            console.log(vm.selectedOrder);

            vm.orders.$save(vm.selectedOrder)
                .then(function () {
                    NotifyService.success('Added ' + userOrder.order[userOrder.order.length - 1].name + ' to the order!');
                    vm.newOrderItemForm = undefined;
                });
        };

        this.removeFoodItem = function (index, item) {
            this.findUserOrder().order.splice(index, 1);
            vm.orders.$save(vm.selectedOrder)
                .then(function () {
                    NotifyService.success('Removed ' + item.name + ' from the order!');
                });
        };

        this.getUsersOrder = function () {
            if (!hasOrderWithDetails() || vm.selectedOrder.details.length <= 0) {
                return 0;
            }
            var total = 0;
            (vm.findUserOrder().order || []).forEach(function (item) {
                total += item.price;
            });
            return (total / 100).toFixed(2);
        };

        function hasOrderWithDetails() {
            return vm.selectedOrder && vm.selectedOrder.details;
        }

    }
    MyOrderCtrl.$inject = ["$log", "$routeParams", "NotifyService", "fbutil", "UserModel"];

    angular
        .module('app.controllers.order-wizard')
        .controller('MyOrderCtrl', MyOrderCtrl);

})();
'use strict';

(function () {

    /**
     * @ngInject
     */
    function PlaceOrderCtrl($log, NotifyService, $routeParams, fbutil, UserModel) {

        var self = this;

        // ViewModel
        var vm = this;

        vm.userModel = UserModel;

        vm.selectedOrder = fbutil.syncObject(['orders/', $routeParams.orderId]);

        vm.selectedOrder.$loaded()
            .then(function () {
                vm.updatePageTotals();
            });

        vm.totalCounts = {};

        this.getOrderTotals = function () {
            if (!vm.selectedOrder || !vm.selectedOrder.details || vm.selectedOrder.details.length <= 0) {
                return 0;
            }
            var total = 0;
            vm.selectedOrder.details.forEach(function (detail) {
                if (detail.order) {
                    detail.order.forEach(function (order) {
                        total += order.price;
                    });
                }
            });
            return (total / 100).toFixed(2);
        };

        this.updatePageTotals = function () {
            if (!vm.selectedOrder || !vm.selectedOrder.details || vm.selectedOrder.details.length <= 0) {
                return;
            }

            vm.totalCounts = {};
            vm.selectedOrder.details.forEach(function (detail) {
                if (detail.order) {
                    detail.order.forEach(function (order) {
                        if (!vm.totalCounts[order.name]) {
                            vm.totalCounts[order.name] = {
                                name: order.name,
                                price: order.price,
                                count: 1
                            };
                        } else {
                            vm.totalCounts[order.name].count++;
                        }
                    });
                }
            });
        };

        vm.updatePageTotals();
    }
    PlaceOrderCtrl.$inject = ["$log", "NotifyService", "$routeParams", "fbutil", "UserModel"];

    angular
        .module('app.controllers.order-wizard')
        .controller('PlaceOrderCtrl', PlaceOrderCtrl);

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9fbW9kdWxlLmpzIiwianMvZGlyZWN0aXZlcy9fbW9kdWxlLmpzIiwianMvZmlsdGVycy9fbW9kdWxlLmpzIiwianMvZmlyZWJhc2UvX21vZHVsZS5qcyIsImpzL2ludGVyY2VwdG9ycy9fbW9kdWxlLmpzIiwianMvbW9kZWxzL19tb2R1bGUuanMiLCJqcy9ub3RpZnkvX21vZHVsZS5qcyIsImpzL3NlcnZpY2VzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9ob21lL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9tZW51cy9fbW9kdWxlLmpzIiwianMvY29udHJvbGxlcnMvbmF2aWdhdGlvbi9fbW9kdWxlLmpzIiwianMvY29udHJvbGxlcnMvb3JkZXJzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9yZXN0YXVyYW50L19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy93aXphcmQvX21vZHVsZS5qcyIsImpzL2NvbnN0YW50cy5qcyIsImpzL3JvdXRlcy5qcyIsImpzL2NvbnRyb2xsZXJzL0FwcEN0cmwuanMiLCJqcy9maXJlYmFzZS9maXJlYmFzZS51dGlscy5qcyIsImpzL2ludGVyY2VwdG9ycy9IdHRwTG9nZ2luZ0ludGVyY2VwdG9yLmpzIiwianMvbW9kZWxzL1VzZXJNb2RlbC5qcyIsImpzL25vdGlmeS9Ob3RpZnlTZXJ2aWNlLmpzIiwianMvc2VydmljZXMvRGF0ZVNlcnZpY2UuanMiLCJqcy9jb250cm9sbGVycy9ob21lL0hvbWVDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbWVudXMvQ3JlYXRlTWVudUN0cmwuanMiLCJqcy9jb250cm9sbGVycy9tZW51cy9MaXN0TWVudXNDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbmF2aWdhdGlvbi9MZWZ0TmF2Q3RybC5qcyIsImpzL2NvbnRyb2xsZXJzL25hdmlnYXRpb24vVG9wTmF2Q3RybC5qcyIsImpzL2NvbnRyb2xsZXJzL29yZGVycy9PcmRlcnNDdHJsLmpzIiwianMvY29udHJvbGxlcnMvcmVzdGF1cmFudC9DcmVhdGVSZXN0YXVyYW50Q3RybC5qcyIsImpzL2NvbnRyb2xsZXJzL3Jlc3RhdXJhbnQvTGlzdFJlc3RhdXJhbnRDdHJsLmpzIiwianMvY29udHJvbGxlcnMvd2l6YXJkL015T3JkZXJDdHJsLmpzIiwianMvY29udHJvbGxlcnMvd2l6YXJkL1BsYWNlT3JkZXJDdHJsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOztJQUVBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO0lBQ0E7O0lBRUE7O0FBRUE7QUN4QkE7O0FBRUE7O0lBRUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7SUFDQTs7QUFFQTtBQ2JBOztBQUVBOztJQUVBOztBQUVBO0FDTkE7O0FBRUE7O0lBRUE7O0FBRUE7QUNOQTs7QUFFQTtJQUNBO0FBQ0E7QUNKQTs7QUFFQTs7SUFFQTs7QUFFQTtBQ05BOztBQUVBO0lBQ0E7O0FBRUE7QUNMQTs7QUFFQTs7SUFFQTs7SUFFQSxpQ0FBQSxXQUFBO1FBQ0E7WUFDQTtZQUNBO1FBQ0E7SUFDQSxDQUFBLENBQUE7O0FBRUE7QUNiQTs7QUFFQTtJQUNBO0FBQ0E7QUNKQTs7QUFFQTs7SUFFQTs7QUFFQTtBQ05BOztBQUVBOztJQUVBOztBQUVBO0FDTkE7O0FBRUE7O0lBRUE7O0FBRUE7QUNOQTs7QUFFQTs7SUFFQTs7QUFFQTtBQ05BOztBQUVBOztJQUVBOztBQUVBO0FDTkE7O0FBRUE7O0lBRUE7O0FBRUE7QUNOQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTs7QUFFQTtBQ2hCQTtBQUNBOztJQUVBO0tBQ0E7S0FDQTtJQUNBLGFBQUEsd0NBQUE7O1FBRUE7WUFDQTtZQUNBLGFBQUEsY0FBQTtRQUNBOztRQUVBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7WUFDQSxhQUFBLGdCQUFBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO1FBQ0E7WUFDQTtZQUNBLGFBQUEsaUJBQUE7UUFDQTtRQUNBO1lBQ0E7WUFDQSxhQUFBLG9CQUFBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7UUFFQTtTQUNBO1NBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztRQUVBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7UUFDQTs7UUFFQTtRQUNBOztJQUVBLENBQUEsQ0FBQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0E7OztBQUdBO0FDMUVBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7WUFDQTtZQUNBO1lBQ0E7UUFDQTs7SUFFQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxPQUFBOztBQUVBOztBQ3ZCQTtBQUNBO0dBQ0EsVUFBQSxNQUFBO01BQ0E7O01BRUE7UUFDQTtVQUNBO1FBQ0E7O1FBRUE7VUFDQTtRQUNBOztRQUVBO01BQ0E7O01BRUE7UUFDQTtVQUNBO1lBQ0E7VUFDQTtVQUNBO1lBQ0E7VUFDQTtRQUNBO1FBQ0E7TUFDQTs7TUFFQTtPQUNBO09BQ0E7T0FDQTtTQUNBO1NBQ0E7T0FDQTtPQUNBO09BQ0E7T0FDQTtPQUNBO09BQ0E7T0FDQTtNQUNBO1FBQ0E7UUFDQTtRQUNBO1VBQ0E7UUFDQTtRQUNBO01BQ0E7O01BRUE7T0FDQTtPQUNBO09BQ0E7T0FDQTtTQUNBO1NBQ0E7U0FDQTtTQUNBO1NBQ0E7U0FDQTtPQUNBO09BQ0E7T0FDQTtPQUNBO09BQ0E7T0FDQTtPQUNBO09BQ0E7T0FDQTtPQUNBO09BQ0E7TUFDQTtRQUNBO1FBQ0E7UUFDQTtVQUNBO1lBQ0E7WUFDQTtZQUNBO1VBQ0E7UUFDQTtRQUNBO01BQ0E7R0FDQTs7O0FDdEZBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBLDRDQUFBLGtCQUFBLEdBQUEsZUFBQTs7UUFFQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtvQkFDQTtnQkFDQTtnQkFDQTtZQUNBOztZQUVBO2dCQUNBO2dCQUNBO1lBQ0E7O1lBRUE7Z0JBQ0E7b0JBQ0E7Z0JBQ0E7Z0JBQ0E7WUFDQTs7WUFFQTtnQkFDQTtnQkFDQTtZQUNBO1FBQ0E7SUFDQSxDQUFBLENBQUE7O0lBRUE7UUFDQSxpQ0FBQSxrQkFBQTtJQUNBOztBQUVBO0FDNUNBOztBQUVBO0lBQ0E7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7WUFDQTthQUNBO2FBQ0E7WUFDQTtRQUNBO0lBQ0E7O0lBRUEsc0NBQUEsU0FBQTtBQUNBO0FDakJBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBLG9CQUFBLFdBQUE7O1FBRUE7U0FDQTtTQUNBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7UUFDQTs7UUFFQTtTQUNBO1NBQ0E7U0FDQTtTQUNBO1FBQ0E7WUFDQTtRQUNBOztRQUVBO1NBQ0E7U0FDQTtTQUNBO1NBQ0E7UUFDQTtZQUNBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7UUFDQTtJQUNBLENBQUEsQ0FBQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsVUFBQSxhQUFBOztBQUVBO0FDbERBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1NBQ0E7U0FDQTtTQUNBO1NBQ0E7UUFDQTtZQUNBO1FBQ0E7O1FBRUE7U0FDQTtTQUNBO1NBQ0E7U0FDQTtRQUNBO1lBQ0E7UUFDQTtJQUNBOztJQUVBO1FBQ0E7UUFDQSxVQUFBLFdBQUE7O0FBRUE7QUNoQ0E7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQTtRQUNBOztJQUVBLENBQUE7OztJQUVBO1FBQ0E7UUFDQSxhQUFBLFFBQUE7O0FBRUE7QUN4QkE7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1lBQ0E7WUFDQTtnQkFDQTtvQkFDQTtnQkFDQTtZQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7O1lBRUE7Z0JBQ0E7WUFDQTtZQUNBOztZQUVBO1lBQ0E7O1lBRUE7Z0JBQ0E7Z0JBQ0E7b0JBQ0E7d0JBQ0E7b0JBQ0E7Z0JBQ0E7Z0JBQ0E7WUFDQTtRQUNBOztRQUVBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO1lBQ0E7UUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7SUFHQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxjQUFBOztBQUVBO0FDL0ZBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTs7UUFFQTs7UUFFQTtZQUNBO1lBQ0E7UUFDQTtJQUNBLENBQUE7OztJQUVBO1FBQ0E7UUFDQSxhQUFBLGFBQUE7O0FBRUE7QUM3QkE7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7UUFDQTs7UUFFQTs7SUFFQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxXQUFBOztBQUVBO0FDcEJBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7O1FBRUE7O1FBRUE7O1FBRUE7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7Z0JBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBOztnQkFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O2dCQUVBO2dCQUNBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7UUFDQTtJQUNBLENBQUE7OztJQUVBO1FBQ0E7UUFDQSxhQUFBLFVBQUE7O0FBRUE7QUM5RUE7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7UUFDQTs7UUFFQTs7UUFFQTs7UUFFQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7WUFDQTtnQkFDQTtnQkFDQTtnQkFDQTtnQkFDQTtnQkFDQTtnQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtvQkFDQTtnQkFDQTtZQUNBO1FBQ0E7O1FBRUE7O1lBRUE7WUFDQTs7WUFFQTtnQkFDQTtvQkFDQTtnQkFDQTtvQkFDQTtnQkFDQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtvQkFDQTtnQkFDQTtvQkFDQTtnQkFDQTtRQUNBOztRQUVBO1lBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7b0JBQ0E7Z0JBQ0E7Z0JBQ0E7WUFDQTtRQUNBO0lBQ0EsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsVUFBQTs7QUFFQTtBQzFGQTs7QUFFQTs7SUFFQTtLQUNBO0tBQ0E7SUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7WUFDQTtRQUNBOztRQUVBO1lBQ0E7O1lBRUE7O1lBRUE7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7WUFDQTtRQUNBO0lBQ0EsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsb0JBQUE7O0FBRUE7QUN6Q0E7O0FBRUE7O0lBRUE7S0FDQTtLQUNBO0lBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBOztJQUVBLENBQUE7OztJQUVBO1FBQ0E7UUFDQSxhQUFBLGtCQUFBOztBQUVBO0FDdkJBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBO1FBQ0E7O1FBRUE7O1FBRUE7UUFDQTtRQUNBO1FBQ0E7O1FBRUE7WUFDQTtZQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO2dCQUNBO1lBQ0E7O1lBRUE7Z0JBQ0E7WUFDQTtnQkFDQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtZQUNBOztZQUVBO2dCQUNBO1lBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO1lBQ0E7O1lBRUE7Z0JBQ0E7WUFDQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTs7WUFFQTtnQkFDQTtZQUNBO1lBQ0E7O1lBRUE7O1lBRUE7Z0JBQ0E7b0JBQ0E7b0JBQ0E7Z0JBQ0E7UUFDQTs7UUFFQTtZQUNBO1lBQ0E7Z0JBQ0E7b0JBQ0E7Z0JBQ0E7UUFDQTs7UUFFQTtZQUNBO2dCQUNBO1lBQ0E7WUFDQTtZQUNBO2dCQUNBO1lBQ0E7WUFDQTtRQUNBOztRQUVBO1lBQ0E7UUFDQTs7SUFFQSxDQUFBOzs7SUFFQTtRQUNBO1FBQ0EsYUFBQSxXQUFBOztBQUVBO0FDbkhBOztBQUVBOztJQUVBO0tBQ0E7S0FDQTtJQUNBOztRQUVBOztRQUVBO1FBQ0E7O1FBRUE7O1FBRUE7O1FBRUE7WUFDQTtnQkFDQTtZQUNBOztRQUVBOztRQUVBO1lBQ0E7Z0JBQ0E7WUFDQTtZQUNBO1lBQ0E7Z0JBQ0E7b0JBQ0E7d0JBQ0E7b0JBQ0E7Z0JBQ0E7WUFDQTtZQUNBO1FBQ0E7O1FBRUE7WUFDQTtnQkFDQTtZQUNBOztZQUVBO1lBQ0E7Z0JBQ0E7b0JBQ0E7d0JBQ0E7NEJBQ0E7Z0NBQ0E7Z0NBQ0E7Z0NBQ0E7NEJBQ0E7d0JBQ0E7NEJBQ0E7d0JBQ0E7b0JBQ0E7Z0JBQ0E7WUFDQTtRQUNBOztRQUVBO0lBQ0EsQ0FBQTs7O0lBRUE7UUFDQTtRQUNBLGFBQUEsY0FBQTs7QUFFQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHJlcXVpcmVzID0gW1xuICAgICAgICAvLyAzcmQgUGFydHlcbiAgICAgICAgJ25nUm91dGUnLFxuICAgICAgICAnZmlyZWJhc2UnLFxuICAgICAgICAndWkuYm9vdHN0cmFwJyxcbiAgICAgICAgLy8gM3JkIHBhcnR5IHdyYXBwZXJzXG4gICAgICAgICdhcHAubGlicy5maXJlYmFzZS51dGlscycsXG4gICAgICAgIC8vIEludGVybmFsc1xuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzJyxcbiAgICAgICAgJ2FwcC5zZXJ2aWNlcycsXG4gICAgICAgICdhcHAuZmlsdGVycycsXG4gICAgICAgICdhcHAuZGlyZWN0aXZlcycsXG4gICAgICAgICdhcHAubW9kZWxzJyxcbiAgICAgICAgJ2FwcC5yb3V0ZXMnLFxuICAgICAgICAnYXBwLmludGVyY2VwdG9ycycsXG4gICAgICAgICdhcHAubm90aWZ5J1xuICAgIF07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJywgcmVxdWlyZXMpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMnLCBbXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMuaG9tZScsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMubWVudXMnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMub3JkZXItd2l6YXJkJyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5uYXZpZ2F0aW9uJ1xuICAgIF0pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcnMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubGlicy5maXJlYmFzZS51dGlscycsIFtdKTtcbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5pbnRlcmNlcHRvcnMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubW9kZWxzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubm90aWZ5JywgWydjZ05vdGlmeSddKTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubm90aWZ5JykucnVuKGZ1bmN0aW9uIChub3RpZnkpIHtcbiAgICAgICAgbm90aWZ5LmNvbmZpZyh7XG4gICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy90ZW1wbGF0ZXMvYW5ndWxhci1ub3RpZnkuaHRtbCdcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnLCBbXSk7XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMuaG9tZScsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm1lbnVzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubmF2aWdhdGlvbicsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5vcmRlci13aXphcmQnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQmFzaWMgYXBwIHZlcnNpb24gY29uc3RhbnRcbiAgICAgKi9cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG5cbiAgICAgICAgLy8gQXBwIHZlcnNpb25cbiAgICAgICAgLmNvbnN0YW50KCd2ZXJzaW9uJywgJzAuMC4xJylcblxuICAgICAgICAvLyB5b3VyIEZpcmViYXNlIGRhdGEgVVJMIGdvZXMgaGVyZSwgbm8gdHJhaWxpbmcgc2xhc2hcbiAgICAgICAgLmNvbnN0YW50KCdGQlVSTCcsICdodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20nKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIFJvdXRlcyA9IGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcblxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd3d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS9pbmRleC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ3RybCBhcyBoYydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9yZGVycyBNYW5hZ2VtZW50XG4gICAgICAgICAqL1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvb3JkZXJzL2xpc3QnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9vcmRlcnMvb3JkZXJzLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ09yZGVyc0N0cmwgYXMgdm0nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcmRlciBXaXphcmRcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9vcmRlci13aXphcmQvbXktb3JkZXIvOm9yZGVySWQ/Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd3d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvb3JkZXItd2l6YXJkL215LW9yZGVyLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ015T3JkZXJDdHJsIGFzIHZtJ1xuICAgICAgICB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL29yZGVyLXdpemFyZC9wbGFjZS1vcmRlci86b3JkZXJJZCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL29yZGVyLXdpemFyZC9wbGFjZS1vcmRlci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQbGFjZU9yZGVyQ3RybCBhcyB2bSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1lbnVzIE1hbmFnZW1lbnRcbiAgICAgICAgICovXG4vLyAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL21lbnVzL2xpc3QnLCB7XG4vLyAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL21lbnVzL21lbnVzLmh0bWwnLFxuLy8gICAgICAgICAgICBjb250cm9sbGVyOiAnTGlzdE1lbnVzQ3RybCBhcyBsbWMnXG4vLyAgICAgICAgfSk7XG4vLyAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL21lbnVzL2NyZWF0ZScsIHtcbi8vICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd3d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvbWVudXMvY3JlYXRlLmh0bWwnLFxuLy8gICAgICAgICAgICBjb250cm9sbGVyOiAnQ3JlYXRlTWVudUN0cmwgYXMgY21jJ1xuLy8gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXN0YXVyYW50IE1hbmFnZW1lbnRcbiAgICAgICAgICovXG4vLyAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3Jlc3RhdXJhbnRzL2xpc3QnLCB7XG4vLyAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL3Jlc3RhdXJhbnQvcmVzdGF1cmFudC5odG1sJyxcbi8vICAgICAgICAgICAgY29udHJvbGxlcjogJ0xpc3RSZXN0YXVyYW50Q3RybCBhcyBscmMnXG4vLyAgICAgICAgfSk7XG4vLyAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3Jlc3RhdXJhbnRzL2NyZWF0ZScsIHtcbi8vICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd3d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvcmVzdGF1cmFudC9jcmVhdGUuaHRtbCcsXG4vLyAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDcmVhdGVSZXN0YXVyYW50Q3RybCBhcyBjcmMnXG4vLyAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICAkcm91dGVQcm92aWRlci5vdGhlcndpc2Uoe1xuICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERpc2FibGUgaHRtbCA1IG1vZGUgZHVlIHRvIElFOSBjb21wYXRpYmlsaXR5IHJlcXVpcmVtZW50IVxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoZmFsc2UpO1xuXG4gICAgfTtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnJvdXRlcycsIFtdKVxuICAgICAgICAuY29uZmlnKFJvdXRlcyk7XG5cblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBBcHBDdHJsKCRsb2csICRyb290U2NvcGUsIE5vdGlmeVNlcnZpY2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbihcIiRyb3V0ZUNoYW5nZUVycm9yXCIsIGZ1bmN0aW9uIChldmVudCwgY3VycmVudCwgcHJldmlvdXMsIHJlamVjdGlvbikge1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnRmFpbGVkIHRvIGNoYW5nZSByb3V0ZSBbJyArIChyZWplY3Rpb24uZGF0YS5lcnJvciA/IHJlamVjdGlvbi5kYXRhLmVycm9yIDogcmVqZWN0aW9uLmRhdGEpICsgJ10nO1xuICAgICAgICAgICAgJGxvZy5lcnJvcihtZXNzYWdlKTtcbiAgICAgICAgICAgIE5vdGlmeVNlcnZpY2UuZGFuZ2VyKG1lc3NhZ2UpO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FwcEN0cmwnLCBBcHBDdHJsKTtcblxufSkoKTsiLCJcbi8vIGEgc2ltcGxlIHdyYXBwZXIgb24gRmlyZWJhc2UgYW5kIEFuZ3VsYXJGaXJlIHRvIHNpbXBsaWZ5IGRlcHMgYW5kIGtlZXAgdGhpbmdzIERSWVxuYW5ndWxhci5tb2R1bGUoJ2FwcC5saWJzLmZpcmViYXNlLnV0aWxzJywgWydmaXJlYmFzZSddKVxuICAgLmZhY3RvcnkoJ2ZidXRpbCcsIFsnJHdpbmRvdycsICdGQlVSTCcsICckZmlyZWJhc2UnLCBmdW5jdGlvbigkd2luZG93LCBGQlVSTCwgJGZpcmViYXNlKSB7XG4gICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3luY09iamVjdDogZnVuY3Rpb24ocGF0aCwgZmFjdG9yeUNvbmZpZykge1xuICAgICAgICAgIHJldHVybiBzeW5jRGF0YS5hcHBseShudWxsLCBhcmd1bWVudHMpLiRhc09iamVjdCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHN5bmNBcnJheTogZnVuY3Rpb24ocGF0aCwgZmFjdG9yeUNvbmZpZykge1xuICAgICAgICAgIHJldHVybiBzeW5jRGF0YS5hcHBseShudWxsLCBhcmd1bWVudHMpLiRhc0FycmF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVmOiBmaXJlYmFzZVJlZlxuICAgICAgfTtcblxuICAgICAgZnVuY3Rpb24gcGF0aFJlZihhcmdzKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoYXJnc1tpXSkpIHtcbiAgICAgICAgICAgIGFyZ3NbaV0gPSBwYXRoUmVmKGFyZ3NbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKCB0eXBlb2YgYXJnc1tpXSAhPT0gJ3N0cmluZycgKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FyZ3VtZW50ICcraSsnIHRvIGZpcmViYXNlUmVmIGlzIG5vdCBhIHN0cmluZzogJythcmdzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFyZ3Muam9pbignLycpO1xuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIEV4YW1wbGU6XG4gICAgICAgKiA8Y29kZT5cbiAgICAgICAqICAgIGZ1bmN0aW9uKGZpcmViYXNlUmVmKSB7XG4gICAgICAgICAqICAgICAgIHZhciByZWYgPSBmaXJlYmFzZVJlZigncGF0aC90by9kYXRhJyk7XG4gICAgICAgICAqICAgIH1cbiAgICAgICAqIDwvY29kZT5cbiAgICAgICAqXG4gICAgICAgKiBAZnVuY3Rpb25cbiAgICAgICAqIEBuYW1lIGZpcmViYXNlUmVmXG4gICAgICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS4uLn0gcGF0aCByZWxhdGl2ZSBwYXRoIHRvIHRoZSByb290IGZvbGRlciBpbiBGaXJlYmFzZSBpbnN0YW5jZVxuICAgICAgICogQHJldHVybiBhIEZpcmViYXNlIGluc3RhbmNlXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIGZpcmViYXNlUmVmKHBhdGgpIHtcbiAgICAgICAgdmFyIHJlZiA9IG5ldyAkd2luZG93LkZpcmViYXNlKEZCVVJMKTtcbiAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICBpZiggYXJncy5sZW5ndGggKSB7XG4gICAgICAgICAgcmVmID0gcmVmLmNoaWxkKHBhdGhSZWYoYXJncykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWY7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlIGEgJGZpcmViYXNlIHJlZmVyZW5jZSB3aXRoIGp1c3QgYSByZWxhdGl2ZSBwYXRoLiBGb3IgZXhhbXBsZTpcbiAgICAgICAqXG4gICAgICAgKiA8Y29kZT5cbiAgICAgICAqIGZ1bmN0aW9uKHN5bmNEYXRhKSB7XG4gICAgICAgICAqICAgIC8vIGEgcmVndWxhciAkZmlyZWJhc2UgcmVmXG4gICAgICAgICAqICAgICRzY29wZS53aWRnZXQgPSBzeW5jRGF0YSgnd2lkZ2V0cy9hbHBoYScpO1xuICAgICAgICAgKlxuICAgICAgICAgKiAgICAvLyBvciBhdXRvbWF0aWMgMy13YXkgYmluZGluZ1xuICAgICAgICAgKiAgICBzeW5jRGF0YSgnd2lkZ2V0cy9hbHBoYScpLiRiaW5kKCRzY29wZSwgJ3dpZGdldCcpO1xuICAgICAgICAgKiB9XG4gICAgICAgKiA8L2NvZGU+XG4gICAgICAgKlxuICAgICAgICogUHJvcHMgaXMgdGhlIHNlY29uZCBwYXJhbSBwYXNzZWQgaW50byAkZmlyZWJhc2UuIEl0IGNhbiBhbHNvIGNvbnRhaW4gbGltaXQsIHN0YXJ0QXQsIGVuZEF0LFxuICAgICAgICogYW5kIHRoZXkgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSByZWYgYmVmb3JlIHBhc3NpbmcgaW50byAkZmlyZWJhc2VcbiAgICAgICAqXG4gICAgICAgKiBAZnVuY3Rpb25cbiAgICAgICAqIEBuYW1lIHN5bmNEYXRhXG4gICAgICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS4uLn0gcGF0aCByZWxhdGl2ZSBwYXRoIHRvIHRoZSByb290IGZvbGRlciBpbiBGaXJlYmFzZSBpbnN0YW5jZVxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IFtwcm9wc11cbiAgICAgICAqIEByZXR1cm4gYSBGaXJlYmFzZSBpbnN0YW5jZVxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBzeW5jRGF0YShwYXRoLCBwcm9wcykge1xuICAgICAgICB2YXIgcmVmID0gZmlyZWJhc2VSZWYocGF0aCk7XG4gICAgICAgIHByb3BzID0gYW5ndWxhci5leHRlbmQoe30sIHByb3BzKTtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKFsnbGltaXQnLCAnc3RhcnRBdCcsICdlbmRBdCddLCBmdW5jdGlvbihrKSB7XG4gICAgICAgICAgaWYoIHByb3BzLmhhc093blByb3BlcnR5KGspICkge1xuICAgICAgICAgICAgdmFyIHYgPSBwcm9wc1trXTtcbiAgICAgICAgICAgIHJlZiA9IHJlZltrXS5hcHBseShyZWYsIGFuZ3VsYXIuaXNBcnJheSh2KT8gdiA6IFt2XSk7XG4gICAgICAgICAgICBkZWxldGUgcHJvcHNba107XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICRmaXJlYmFzZShyZWYsIHByb3BzKTtcbiAgICAgIH1cbiAgIH1dKTtcblxuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5pbnRlcmNlcHRvcnMnKS5mYWN0b3J5KCdsb2dnaW5nSW50ZXJjZXB0b3InLCBmdW5jdGlvbiAoJHEsICRsb2cpIHtcblxuICAgICAgICBmdW5jdGlvbiBpc1BhcnRpYWwodXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJsLmluZGV4T2YoJ3BhcnRpYWxzJykgPT09IC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICdyZXF1ZXN0JzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgICAgIGlmIChpc1BhcnRpYWwoY29uZmlnLnVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZygnSHR0cCBSZXF1ZXN0IFsnICsgY29uZmlnLm1ldGhvZCArICddWycgKyBjb25maWcudXJsICsgJ10nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdyZXF1ZXN0RXJyb3InOiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignSHR0cCBSZXF1ZXN0IEVycm9yIFsnICsgY29uZmlnLm1ldGhvZCArICddWycgKyBjb25maWcudXJsICsgJ10nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3Jlc3BvbnNlJzogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUGFydGlhbChyZXNwb25zZS5jb25maWcudXJsKSkge1xuICAgICAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKCdIdHRwIFJlc3BvbnNlIFN1Y2Nlc3M6IFN0YXR1cyBbJyArIHJlc3BvbnNlLnN0YXR1cyArICddIHRvIFsnICsgcmVzcG9uc2UuY29uZmlnLm1ldGhvZCArICddWycgKyByZXNwb25zZS5jb25maWcudXJsICsgJ10nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3Jlc3BvbnNlRXJyb3InOiBmdW5jdGlvbiAocmVqZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignSHR0cCBSZXNwb25zZSBFcnJvcjogU3RhdHVzIFsnICsgcmVqZWN0aW9uLnN0YXR1cyArICddIHRvIFsnICsgcmVqZWN0aW9uLmNvbmZpZy5tZXRob2QgKyAnXVsnICsgcmVqZWN0aW9uLmNvbmZpZy51cmwgKyAnXSBkYXRhIFsnICsgKHJlamVjdGlvbi5kYXRhLmVycm9yID8gcmVqZWN0aW9uLmRhdGEuZXJyb3IgOiByZWplY3Rpb24uZGF0YSkgKyAnXScpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaW50ZXJjZXB0b3JzJykuY29uZmlnKFsnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyKSB7XG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2xvZ2dpbmdJbnRlcmNlcHRvcicpO1xuICAgIH1dKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIFVzZXJNb2RlbCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUaGUgdXNlclxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB1c2VyOiBudWxsXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubW9kZWxzJykuZmFjdG9yeSgnVXNlck1vZGVsJywgVXNlck1vZGVsKTtcbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIE5vdGlmeVNlcnZpY2UgPSBmdW5jdGlvbiAobm90aWZ5KSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBEQU5HRVJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYW5nZXIgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtZGFuZ2VyJ30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGEgbm90aWZpY2F0aW9uIHdpdGggc3R5bGUgV0FSTklOR1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSB0aGUgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndhcm5pbmcgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtd2FybmluZyd9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhIG5vdGlmaWNhdGlvbiB3aXRoIHN0eWxlIFNVQ0NFU1NcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWNjZXNzID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5vdGlmeSh7bWVzc2FnZTogbWVzc2FnZSwgY2xhc3NlczogJ2FsZXJ0LXN1Y2Nlc3MnfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBJTkZPXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5mbyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBub3RpZnkoe21lc3NhZ2U6IG1lc3NhZ2UsIGNsYXNzZXM6ICdhbGVydC1pbmZvJ30pO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5ub3RpZnknKVxuICAgICAgICAuc2VydmljZSgnTm90aWZ5U2VydmljZScsIE5vdGlmeVNlcnZpY2UpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIHZhciBEYXRlU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIERhdGUgTk9XXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBEYXRlIE5PVyBpbiBzZWNvbmRzXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIG51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm93KCkuZ2V0VGltZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycpXG4gICAgICAgIC5zZXJ2aWNlKCdEYXRlU2VydmljZScsIERhdGVTZXJ2aWNlKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBIb21lQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9cIik7XG4gICAgICAgIC8vIGNyZWF0ZSBhbiBBbmd1bGFyRmlyZSByZWZlcmVuY2UgdG8gdGhlIGRhdGFcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcbiAgICAgICAgLy8gZG93bmxvYWQgdGhlIGRhdGEgaW50byBhIGxvY2FsIG9iamVjdFxuICAgICAgICB2bS5kYXRhID0gc3luYy4kYXNPYmplY3QoKTtcblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLmhvbWUnKVxuICAgICAgICAuY29udHJvbGxlcignSG9tZUN0cmwnLCBIb21lQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQ3JlYXRlTWVudUN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vIHJlc3RhdXJhbnRzUmVmXG4gICAgICAgIHZhciByZXN0YXVyYW50c1JlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHJlc3RhdXJhbnRzU3luYyA9ICRmaXJlYmFzZShyZXN0YXVyYW50c1JlZik7XG5cbiAgICAgICAgdm0ucmVzdGF1cmFudHMgPSByZXN0YXVyYW50c1N5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdGF1cmFudHMpO1xuXG4gICAgICAgIC8vIG1lbnVSZWZcbiAgICAgICAgdmFyIG1lbnVSZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vbWVudXNcIik7XG4gICAgICAgIHZhciBtZW51U3luYyA9ICRmaXJlYmFzZShtZW51UmVmKTtcblxuICAgICAgICB2bS5tZW51cyA9IG1lbnVTeW5jLiRhc0FycmF5KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHZtLm1lbnVzKTtcblxuICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQgPSB7fTtcbiAgICAgICAgdm0ubmV3TWVudSA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgZm9vZHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLCBwcmljZTogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuY3JlYXRlTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgbmV3IG1lbnUgWyVzXScsIGFuZ3VsYXIudG9Kc29uKHZtLm5ld01lbnUpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLnNlbGVjdGVkUmVzdGF1cmFudCk7XG5cbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQubWVudXMucHVzaCh2bS5uZXdNZW51KTtcblxuICAgICAgICAgICAgdm0ucmVzdGF1cmFudHMuJHNhdmUodm0uc2VsZWN0ZWRSZXN0YXVyYW50KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLnJlc3RhdXJhbnRzKTtcblxuICAgICAgICAgICAgdm0ubmV3TWVudSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5yZW1vdmVGb29kID0gZnVuY3Rpb24gKGZvb2QsIGluZGV4KSB7XG4gICAgICAgICAgICB2bS5uZXdNZW51LmZvb2RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hZGRGb29kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubmV3TWVudS5mb29kcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4vLyAgICAgICAgU21hbGwgQ2hpY2tlbiBOYWFuXHTCozMuODBcbi8vICAgICAgICBTbWFsbCBDaGlja2VuIENoYXBhdHRpXHTCozMuODBcbi8vICAgICAgICBDaGlja2VuIExhbWIgTWl4IE5hYW5cdMKjNi4wMFxuLy8gICAgICAgIENoaWNrZW4gTGFtYiBNaXggQ2hhcGF0dGlcdMKjNi4wMFxuLy8gICAgICAgIExhcmdlIENoaWNrZW4gTmFhblx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgTGFtYiBOYWFuXHTCozYuMDBcbi8vICAgICAgICBMYXJnZSBMYW1iIENoYXBhdHRpXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIFNlZWtoIE1peCBOYWFuXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIFNlZWtoIE1peCBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgU21hbGwgU2Vla2ggTmFhblx0wqMyLjkwXG4vLyAgICAgICAgU21hbGwgU2Vla2ggQ2hhcGF0dGlcdMKjMi45MFxuLy8gICAgICAgIExhcmdlIFNlZWtoIE5hYW5cdMKjMy43MFxuLy8gICAgICAgIExhcmdlIFNlZWtoIENoYXBhdHRpXHTCozMuNzBcbi8vICAgICAgICBTbWFsbCBDaGlwc1x0wqMxLjMwXG4vLyAgICAgICAgTGFyZ2UgQ2hpcHNcdMKjMi4wMFxuLy8gICAgICAgIENoaWNrZW4gRG9ubmVyXHTCozMuNTBcblxuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnKVxuICAgICAgICAuY29udHJvbGxlcignQ3JlYXRlTWVudUN0cmwnLCBDcmVhdGVNZW51Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTGlzdE1lbnVzQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcblxuICAgICAgICB2bS5yZXN0YXVyYW50cyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0YXVyYW50cyk7XG5cbiAgICAgICAgdGhpcy5yZW1vdmVNZW51QXRJbmRleCA9IGZ1bmN0aW9uIChyZXN0dXJhbnQsIGluZGV4KSB7XG4gICAgICAgICAgICByZXN0dXJhbnQubWVudXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHZtLnJlc3RhdXJhbnRzLiRzYXZlKHJlc3R1cmFudCk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnKVxuICAgICAgICAuY29udHJvbGxlcignTGlzdE1lbnVzQ3RybCcsIExpc3RNZW51c0N0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIExlZnROYXZDdHJsKCRsb2csIFVzZXJNb2RlbCkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm5hdmlnYXRpb24nKVxuICAgICAgICAuY29udHJvbGxlcignTGVmdE5hdkN0cmwnLCBMZWZ0TmF2Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gVG9wTmF2Q3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCAkZmlyZWJhc2VTaW1wbGVMb2dpbiwgRmlyZWJhc2UsIFVzZXJNb2RlbCwgZmJ1dGlsKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbVwiKTtcblxuICAgICAgICB2bS51c2VyTW9kZWwgPSBVc2VyTW9kZWw7XG5cbiAgICAgICAgdm0udXNlcnMgPSBmYnV0aWwuc3luY0FycmF5KCd1c2VycycpO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbC5hbGxVc2VycyA9IHZtLnVzZXJzO1xuXG4gICAgICAgIHZhciBhdXRoQ2xpZW50ID0gJGZpcmViYXNlU2ltcGxlTG9naW4ocmVmKTtcbiAgICAgICAgY29uc29sZS5sb2coYXV0aENsaWVudCk7XG5cbiAgICAgICAgLy8gVE9ETyBtb3ZlIHRvIHJlc29sdmUhXG4gICAgICAgIHRoaXMuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGF1dGhDbGllbnQuJGdldEN1cnJlbnRVc2VyKCkudGhlbihoYW5kbGVTdWNjZXNzZnVsTG9naW4pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubG9naW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdMb2dpbiAtIGdpdGh1YicpO1xuICAgICAgICAgICAgYXV0aENsaWVudC4kbG9naW4oJ2dpdGh1YicsIHsgcmVtZW1iZXJNZTogdHJ1ZSwgc2NvcGU6ICd1c2VyJ30pXG4gICAgICAgICAgICAgICAgLnRoZW4oaGFuZGxlU3VjY2Vzc2Z1bExvZ2luLCBwb3BFcnJvcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdMb2dvdXQnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGF1dGhDbGllbnQpO1xuICAgICAgICAgICAgYXV0aENsaWVudC4kbG9nb3V0KCk7XG4gICAgICAgICAgICBVc2VyTW9kZWwudXNlciA9IG51bGw7XG4gICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ3VzZXIgaXMgbG9nZ2VkIG91dCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVN1Y2Nlc3NmdWxMb2dpbih1c2VyKSB7XG4gICAgICAgICAgICBpZiAodXNlcikge1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXI6JywgdXNlcik7XG5cbi8vICAgICAgICAgICAgICAgIHZhciBkcmlua1JlZiA9IGZidXRpbC5yZWYoJ3VzZXJzLycgKyB1c2VyLnVpZCk7XG4vLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTXlVc2VyOicsIGRyaW5rUmVmKTtcbi8vICAgICAgICAgICAgICAgIGRyaW5rUmVmLnB1c2godXNlcik7XG5cbi8vICAgICAgICAgICAgICAgIHZhciBteVVzZXIgPSBmYnV0aWwuc3luY09iamVjdCgndXNlcnMvJyArIHVzZXIudWlkKTtcbi8vICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNeVVzZXI6JywgbXlVc2VyKTtcbi8vXG4vLyAgICAgICAgICAgICAgICBteVVzZXIuJGFkZCh1c2VyKVxuLy8gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgU0FWRUQgdXNlcicpO1xuLy8gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoJ1VuYWJsZSB0byBTQVZFIHVzZXInKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbi8vICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIFVzZXJNb2RlbC51c2VyID0gdXNlcjtcbiAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKFwiVXNlciBJRDogXCIgKyB1c2VyLnVpZCArIFwiLCBQcm92aWRlcjogXCIgKyB1c2VyLnByb3ZpZGVyKTtcbiAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoXCJVc2VyIElEOiBcIiArIHVzZXIudWlkICsgXCIsIFByb3ZpZGVyOiBcIiArIHVzZXIucHJvdmlkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcG9wRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubmF2aWdhdGlvbicpXG4gICAgICAgIC5jb250cm9sbGVyKCdUb3BOYXZDdHJsJywgVG9wTmF2Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gT3JkZXJzQ3RybCgkbG9nLCBmYnV0aWwsIE5vdGlmeVNlcnZpY2UsIFVzZXJNb2RlbCkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLm9yZGVycyA9IGZidXRpbC5zeW5jQXJyYXkoJ29yZGVycycpO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcblxuICAgICAgICByZXNldEZvcm0oKTtcblxuICAgICAgICAvLyBVc2Vyc1xuICAgICAgICB2bS5hdmFpbGFibGVVc2VycyA9IFsnSmFtZXMgTW9yZ2FuJywgJ0FuZHkgR3JheScsICdTaW1vbiBTb3V0ZXInLCAnQWxleCBMYXNoZm9yZCddO1xuXG4gICAgICAgIC8vIEF2YWlsYWJsZSBwYWdlIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgdm0uYXZhaWxhYmxlUmVzdGF1cmFudHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0FiZHVscyBGYWxsb3dmaWVsZCcsXG4gICAgICAgICAgICAgICAgb3BlbmluZ1RpbWVzOiAnTW9uIC0gU3VuIC0gNHBtIC0gMzozMGFtJyxcbiAgICAgICAgICAgICAgICBjb250YWN0TnVtYmVyOiAnMDE2MSAyNDggNzU3MycsXG4gICAgICAgICAgICAgICAgYWRkcmVzczogJzMyNCBXaWxtc2xvdyBSZCwgTWFuY2hlc3RlciBNMTQgNlhRJyxcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb25MaW5rOiBcImh0dHBzOi8vd3d3Lmdvb2dsZS5jby51ay9tYXBzL2Rpci8nJy9hYmR1bHMrRmFsbG93ZmllbGQvQDUzLjQ0MDQwNjMsLTIuMjg4NDM4MSwxMnovZGF0YT0hM20xITRiMSE0bTghNG03ITFtMCExbTUhMW0xITFzMHg0ODdiYjIzMGQyNzU3YTU3OjB4NWVmNzA5MDQ1ZjM2MWM5NSEybTIhMWQtMi4yMTk3NzIhMmQ1My40NDA0MjZcIixcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gTmFhbicsIHByaWNlOiAzODB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gQ2hhcGF0dGknLCBwcmljZTogMzAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IE5hYW4nLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IENoYXBhdHRpJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aScsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgTmFhbicsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgQ2hhcGF0dGknLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIFNlZWtoIE1peCBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgU2Vla2ggTmFhbicsIHByaWNlOiAyOTB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDI5MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgU2Vla2ggTmFhbicsIHByaWNlOiAzNzB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDM3MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgQ2hpcHMnLCBwcmljZTogMTMwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBDaGlwcycsIHByaWNlOiAyMDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0NoaWNrZW4gRG9ubmVyJywgcHJpY2U6IDM1MH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdGhpcy5jcmVhdGVPcmRlciA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgLy8gU2V0IHRoZSB1c2VyXG4gICAgICAgICAgICB2bS5uZXdPcmRlci5jcmVhdGVkQnkgPSBVc2VyTW9kZWwudXNlcjtcblxuICAgICAgICAgICAgdm0ub3JkZXJzLiRhZGQoYW5ndWxhci5jb3B5KHZtLm5ld09yZGVyKSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IGFkZGVkIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLmRhbmdlcignVW5hYmxlIHRvIHNhdmUgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc2V0Rm9ybSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlT3JkZXIgPSBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgIHZtLm9yZGVycy4kcmVtb3ZlKG9yZGVyKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVtb3ZlZCBvcmRlcicpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoJ1VuYWJsZSB0byByZW1vdmUgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiByZXNldEZvcm0oKSB7XG4gICAgICAgICAgICB2bS5uZXdPcmRlciA9IHtcbiAgICAgICAgICAgICAgICBjcmVhdGVkQnk6IFVzZXJNb2RlbC51c2VyLFxuICAgICAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgICAgIHJlc3RhdXJhbnQ6ICcnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgICAgICAgICAge31cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWREYXRlOiBEYXRlLm5vdygpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMub3JkZXJzJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ09yZGVyc0N0cmwnLCBPcmRlcnNDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBDcmVhdGVSZXN0YXVyYW50Q3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcblxuICAgICAgICB2bS5yZXN0dXJhbnRzID0gc3luYy4kYXNBcnJheSgpO1xuICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0dXJhbnRzKTtcblxuICAgICAgICB2bS5uZXdSZXN0YXVyYW50ID0ge1xuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIG1lbnVzOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYWRkUmVzdGF1cmFudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ0FkZGluZyBuZXcgcmVzdGF1cmFudHMgWyVzXScsIHZtLm5ld1Jlc3RhdXJhbnQpO1xuXG4gICAgICAgICAgICB2bS5yZXN0dXJhbnRzLiRhZGQoYW5ndWxhci5jb3B5KHZtLm5ld1Jlc3RhdXJhbnQpKTtcblxuICAgICAgICAgICAgdm0ubmV3UmVzdGF1cmFudCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICBtZW51czogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdDcmVhdGVSZXN0YXVyYW50Q3RybCcsIENyZWF0ZVJlc3RhdXJhbnRDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBMaXN0UmVzdGF1cmFudEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0ucmVzdGF1cmFudHMgPSBzeW5jLiRhc0FycmF5KCk7XG5cbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5yZXN0YXVyYW50JylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xpc3RSZXN0YXVyYW50Q3RybCcsIExpc3RSZXN0YXVyYW50Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTXlPcmRlckN0cmwoJGxvZywgJHJvdXRlUGFyYW1zLCBOb3RpZnlTZXJ2aWNlLCBmYnV0aWwsIFVzZXJNb2RlbCkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLm9wdGlvbmFsT3JkZXJJZCA9ICRyb3V0ZVBhcmFtcy5vcmRlcklkO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcbiAgICAgICAgdm0uc2VsZWN0ZWRPcmRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdm0ubmV3T3JkZXJJdGVtRm9ybSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdm0ub3JkZXJzID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIGlmICh2bS5vcHRpb25hbE9yZGVySWQpIHtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ0F0dGVtcHRpbmcgdG8gZ2V0IG9yZGVyIGZvciByZWYgWyVdJywgdm0ub3B0aW9uYWxPcmRlcklkKTtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkT3JkZXIgPSBmYnV0aWwuc3luY09iamVjdCgnb3JkZXJzLycgKyB2bS5vcHRpb25hbE9yZGVySWQpO1xuICAgICAgICAvL30gZWxzZSB7XG4gICAgICAgIC8vICAgICRsb2cuZGVidWcoJ0xvYWRpbmcgYWxsIG9yZGVycycpO1xuICAgICAgICAvLyAgICB2bS5vcmRlcnMgPSBmYnV0aWwuc3luY0FycmF5KCdvcmRlcnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRsb2cuZGVidWcoJ0xvYWRpbmcgYWxsIG9yZGVycycpO1xuICAgICAgICB2bS5vcmRlcnMgPSBmYnV0aWwuc3luY0FycmF5KCdvcmRlcnMnKTtcblxuICAgICAgICAvLyBUaGUgZGF0YSBmb3JtXG4gICAgICAgIHZtLm15T3JkZXIgPSB7XG4gICAgICAgICAgICBmb29kczogW11cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmluaXRPcmRlckZvclVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgb3JkZXJEZXRhaWwgPSB7XG4gICAgICAgICAgICAgICAgdXNlcjogVXNlck1vZGVsLnVzZXIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoaGFzT3JkZXJXaXRoRGV0YWlscygpKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLnB1c2gob3JkZXJEZXRhaWwpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMgPSBbb3JkZXJEZXRhaWxdXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy51c2VySGFzT3JkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWhhc09yZGVyV2l0aERldGFpbHMoKSB8fCAhVXNlck1vZGVsLnVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMuc29tZShmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRldGFpbC51c2VyLmlkID09PSBVc2VyTW9kZWwudXNlci5pZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmZpbmRVc2VyT3JkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdXNlckRldGFpbHMgPSB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMuZmlsdGVyKGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWlsLnVzZXIuaWQgPT09IFVzZXJNb2RlbC51c2VyLmlkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHVzZXJEZXRhaWxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQgaW4gb3JkZXIhJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdXNlckRldGFpbHNbMF07XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hZGRGb29kSXRlbSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1c2VyT3JkZXIgPSB0aGlzLmZpbmRVc2VyT3JkZXIoKTtcblxuICAgICAgICAgICAgaWYgKCF1c2VyT3JkZXIub3JkZXIpIHtcbiAgICAgICAgICAgICAgICB1c2VyT3JkZXIub3JkZXIgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVzZXJPcmRlci5vcmRlci5wdXNoKHZtLm5ld09yZGVySXRlbUZvcm0pO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5zZWxlY3RlZE9yZGVyKTtcblxuICAgICAgICAgICAgdm0ub3JkZXJzLiRzYXZlKHZtLnNlbGVjdGVkT3JkZXIpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ0FkZGVkICcgKyB1c2VyT3JkZXIub3JkZXJbdXNlck9yZGVyLm9yZGVyLmxlbmd0aCAtIDFdLm5hbWUgKyAnIHRvIHRoZSBvcmRlciEnKTtcbiAgICAgICAgICAgICAgICAgICAgdm0ubmV3T3JkZXJJdGVtRm9ybSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnJlbW92ZUZvb2RJdGVtID0gZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG4gICAgICAgICAgICB0aGlzLmZpbmRVc2VyT3JkZXIoKS5vcmRlci5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdm0ub3JkZXJzLiRzYXZlKHZtLnNlbGVjdGVkT3JkZXIpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ1JlbW92ZWQgJyArIGl0ZW0ubmFtZSArICcgZnJvbSB0aGUgb3JkZXIhJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5nZXRVc2Vyc09yZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPcmRlcldpdGhEZXRhaWxzKCkgfHwgdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdG90YWwgPSAwO1xuICAgICAgICAgICAgKHZtLmZpbmRVc2VyT3JkZXIoKS5vcmRlciB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHRvdGFsICs9IGl0ZW0ucHJpY2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAodG90YWwgLyAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gaGFzT3JkZXJXaXRoRGV0YWlscygpIHtcbiAgICAgICAgICAgIHJldHVybiB2bS5zZWxlY3RlZE9yZGVyICYmIHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscztcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMub3JkZXItd2l6YXJkJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ015T3JkZXJDdHJsJywgTXlPcmRlckN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFBsYWNlT3JkZXJDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsICRyb3V0ZVBhcmFtcywgZmJ1dGlsLCBVc2VyTW9kZWwpIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0udXNlck1vZGVsID0gVXNlck1vZGVsO1xuXG4gICAgICAgIHZtLnNlbGVjdGVkT3JkZXIgPSBmYnV0aWwuc3luY09iamVjdChbJ29yZGVycy8nLCAkcm91dGVQYXJhbXMub3JkZXJJZF0pO1xuXG4gICAgICAgIHZtLnNlbGVjdGVkT3JkZXIuJGxvYWRlZCgpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlUGFnZVRvdGFscygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdm0udG90YWxDb3VudHMgPSB7fTtcblxuICAgICAgICB0aGlzLmdldE9yZGVyVG90YWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZE9yZGVyIHx8ICF2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMgfHwgdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdG90YWwgPSAwO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzLmZvckVhY2goZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgICAgICAgIGlmIChkZXRhaWwub3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsLm9yZGVyLmZvckVhY2goZnVuY3Rpb24gKG9yZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSBvcmRlci5wcmljZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gKHRvdGFsIC8gMTAwKS50b0ZpeGVkKDIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudXBkYXRlUGFnZVRvdGFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRPcmRlciB8fCAhdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzIHx8IHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdm0udG90YWxDb3VudHMgPSB7fTtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscy5mb3JFYWNoKGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGV0YWlsLm9yZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGRldGFpbC5vcmRlci5mb3JFYWNoKGZ1bmN0aW9uIChvcmRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF2bS50b3RhbENvdW50c1tvcmRlci5uYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsQ291bnRzW29yZGVyLm5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBvcmRlci5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogb3JkZXIucHJpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udG90YWxDb3VudHNbb3JkZXIubmFtZV0uY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlUGFnZVRvdGFscygpO1xuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVyLXdpemFyZCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdQbGFjZU9yZGVyQ3RybCcsIFBsYWNlT3JkZXJDdHJsKTtcblxufSkoKTsiXSwic291cmNlUm9vdCI6ImFwcCJ9