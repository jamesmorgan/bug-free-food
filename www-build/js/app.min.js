"use strict";!function(){var requires=["ngRoute","firebase","app.controllers","app.services","app.filters","app.directives","app.models","app.routes","app.interceptors","app.notify"];angular.module("app",requires)}(),function(){angular.module("app.controllers",["app.controllers.home","app.controllers.menus","app.controllers.orders","app.controllers.restaurant","app.controllers.wizard","app.controllers.navigation"])}(),function(){angular.module("app.directives",[])}(),function(){angular.module("app.filters",[])}(),function(){angular.module("app.interceptors",[])}(),function(){angular.module("app.models",[])}(),function(){angular.module("app.notify",["cgNotify"]),angular.module("app.notify").run(["notify",function(notify){notify.config({duration:2e3,templateUrl:"/www-build/views/templates/angular-notify.html"})}])}(),function(){angular.module("app.services",[])}(),function(){angular.module("app.controllers.home",[])}(),function(){angular.module("app.controllers.menus",[])}(),function(){angular.module("app.controllers.navigation",[])}(),function(){angular.module("app.controllers.orders",[])}(),function(){angular.module("app.controllers.restaurant",[])}(),function(){angular.module("app.controllers.wizard",[])}(),function(){angular.module("app").constant("version","0.0.1")}(),function(){var Routes=["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/www-build/views/partials/home/index.html",controller:"HomeCtrl as hc"}),$routeProvider.when("/orders/list",{templateUrl:"/www-build/views/partials/orders/orders.html",controller:"OrdersCtrl as vm"}),$routeProvider.when("/menus/list",{templateUrl:"/www-build/views/partials/menus/menus.html",controller:"ListMenusCtrl as lmc"}),$routeProvider.when("/menus/create",{templateUrl:"/www-build/views/partials/menus/create.html",controller:"CreateMenuCtrl as cmc"}),$routeProvider.when("/restaurants/list",{templateUrl:"/www-build/views/partials/restaurant/restaurant.html",controller:"ListRestaurantCtrl as lrc"}),$routeProvider.when("/restaurants/create",{templateUrl:"/www-build/views/partials/restaurant/create.html",controller:"CreateRestaurantCtrl as crc"}),$routeProvider.when("/wizard/new-order",{templateUrl:"/www-build/views/partials/wizard/new-order.html",controller:"WizardCtrl as vm"}),$routeProvider.otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!1)}];Routes.$inject=["$routeProvider","$locationProvider"],angular.module("app.routes",[]).config(Routes)}(),function(){function AppCtrl($log,$rootScope,NotifyService){$rootScope.$on("$routeChangeError",function(event,current,previous,rejection){var message="Failed to change route ["+(rejection.data.error?rejection.data.error:rejection.data)+"]";$log.error(message),NotifyService.danger(message)})}AppCtrl.$inject=["$log","$rootScope","NotifyService"],angular.module("app.controllers").controller("AppCtrl",AppCtrl)}(),function(){angular.module("app.interceptors").factory("loggingInterceptor",["$q","$log",function($q,$log){function isPartial(url){return-1===url.indexOf("partials")}return{request:function(config){return isPartial(config.url)&&$log.debug("Http Request ["+config.method+"]["+config.url+"]"),config},requestError:function(config){return $log.error("Http Request Error ["+config.method+"]["+config.url+"]"),config},response:function(response){return isPartial(response.config.url)&&$log.debug("Http Response Success: Status ["+response.status+"] to ["+response.config.method+"]["+response.config.url+"]"),response},responseError:function(rejection){return $log.error("Http Response Error: Status ["+rejection.status+"] to ["+rejection.config.method+"]["+rejection.config.url+"] data ["+(rejection.data.error?rejection.data.error:rejection.data)+"]"),$q.reject(rejection)}}}]),angular.module("app.interceptors").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("loggingInterceptor")}])}(),function(){var UserModel=function(){return{user:null}};angular.module("app.models").factory("UserModel",UserModel)}(),function(){var NotifyService=["notify",function(notify){this.danger=function(message){notify({message:message,classes:"alert-danger"})},this.warning=function(message){notify({message:message,classes:"alert-warning"})},this.success=function(message){notify({message:message,classes:"alert-success"})},this.info=function(message){notify({message:message,classes:"alert-info"})}}];NotifyService.$inject=["notify"],angular.module("app.notify").service("NotifyService",NotifyService)}(),function(){var DateService=function(){this.now=function(){return new Date},this.getTime=function(){return this.now().getTime()}};angular.module("app.services").service("DateService",DateService)}(),function(){function HomeCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/"),sync=$firebase(ref);vm.data=sync.$asObject()}HomeCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.home").controller("HomeCtrl",HomeCtrl)}(),function(){function CreateMenuCtrl($log,NotifyService,Firebase,$firebase){var vm=this,restaurantsRef=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),restaurantsSync=$firebase(restaurantsRef);vm.restaurants=restaurantsSync.$asArray(),console.log(vm.restaurants);var menuRef=new Firebase("https://bug-free-food.firebaseio.com/menus"),menuSync=$firebase(menuRef);vm.menus=menuSync.$asArray(),console.log(vm.menus),vm.selectedRestaurant={},vm.newMenu={name:"",foods:[{name:"",price:0}],createdDate:Date.now()},this.createMenu=function(){console.log("Adding new menu [%s]",angular.toJson(vm.newMenu)),console.log(vm.selectedRestaurant),vm.selectedRestaurant.menus||(vm.selectedRestaurant.menus=[]),vm.selectedRestaurant.menus.push(vm.newMenu),vm.restaurants.$save(vm.selectedRestaurant),console.log(vm.restaurants),vm.newMenu={name:"",foods:[{name:"",price:0}],createdDate:Date.now()}},this.removeFood=function(food,index){vm.newMenu.foods.splice(index,1)},this.addFood=function(){vm.newMenu.foods.push({name:"",price:0})}}CreateMenuCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.menus").controller("CreateMenuCtrl",CreateMenuCtrl)}(),function(){function ListMenusCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.restaurants=sync.$asArray(),console.log(vm.restaurants),this.removeMenuAtIndex=function(resturant,index){resturant.menus.splice(index,1),vm.restaurants.$save(resturant)}}ListMenusCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.menus").controller("ListMenusCtrl",ListMenusCtrl)}(),function(){function TopNavCtrl($log,NotifyService,$firebaseSimpleLogin,Firebase,UserModel){function handleSuccessfulLogin(user){user&&(UserModel.user=user,$log.debug("User ID: "+user.uid+", Provider: "+user.provider),NotifyService.success("User ID: "+user.uid+", Provider: "+user.provider))}function popError(error){$log.error(error),NotifyService.danger(error)}var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com");vm.userModel=UserModel;var authClient=$firebaseSimpleLogin(ref);console.log(authClient),this.init=function(){authClient.$getCurrentUser().then(handleSuccessfulLogin)},this.login=function(){$log.debug("Login - github"),authClient.$login("github",{rememberMe:!0,scope:"user"}).then(handleSuccessfulLogin,popError)},this.logout=function(){$log.debug("Logout"),console.log(authClient),authClient.$logout(),UserModel.user=null,NotifyService.success("user is logged out")}}TopNavCtrl.$inject=["$log","NotifyService","$firebaseSimpleLogin","Firebase","UserModel"],angular.module("app.controllers.navigation").controller("TopNavCtrl",TopNavCtrl)}(),function(){function OrdersCtrl($log,NotifyService,Firebase,$firebase,UserModel){function resetForm(){vm.newOrder={createdBy:UserModel.user,name:"",restaurant:"",content:[{}],createdDate:Date.now()}}var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/orders"),sync=$firebase(ref);vm.userModel=UserModel,vm.orders=sync.$asArray(),resetForm(),vm.availableUsers=["James Morgan","Andy Gray","Simon Souter","Alex Lashford"],vm.availableRestaurants=[{name:"Abduls Levenshulme",openingTimes:"...",foods:[{name:"Small Chicken Naan",price:380},{name:"Small Chicken Chapatti",price:300},{name:"Chicken Lamb Mix Naan",price:600},{name:"Chicken Lamb Mix Chapatti",price:600},{name:"Large Chicken Naan",price:600},{name:"Large Chicken Chapatti",price:600},{name:"Large Lamb Naan",price:600},{name:"Large Lamb Chapatti",price:600},{name:"Chicken Seekh Mix Naan",price:600},{name:"Small Seekh Naan",price:290},{name:"Small Seekh Chapatti",price:290},{name:"Large Seekh Naan",price:370},{name:"Large Seekh Chapatti",price:370},{name:"Small Chips",price:130},{name:"Large Chips",price:200},{name:"Chicken Donner",price:350}]}],this.createOrder=function(){vm.newOrder.createdBy=UserModel.user,vm.orders.$add(angular.copy(vm.newOrder)).then(function(){NotifyService.success("Successfully added order")},function(){NotifyService.danger("Unable to save order")}),resetForm()},this.removeOrder=function(order){vm.orders.$remove(order).then(function(){NotifyService.success("Successfully removed order")},function(){NotifyService.danger("Unable to remove order")})}}OrdersCtrl.$inject=["$log","NotifyService","Firebase","$firebase","UserModel"],angular.module("app.controllers.orders").controller("OrdersCtrl",OrdersCtrl)}(),function(){function CreateRestaurantCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.resturants=sync.$asArray(),console.log(vm.resturants),vm.newRestaurant={name:"",createdDate:Date.now(),menus:[]},this.addRestaurant=function(){$log.debug("Adding new restaurants [%s]",vm.newRestaurant),vm.resturants.$add(angular.copy(vm.newRestaurant)),vm.newRestaurant={name:"",createdDate:Date.now(),menus:[]}}}CreateRestaurantCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.restaurant").controller("CreateRestaurantCtrl",CreateRestaurantCtrl)}(),function(){function ListRestaurantCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.restaurants=sync.$asArray()}ListRestaurantCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.restaurant").controller("ListRestaurantCtrl",ListRestaurantCtrl)}(),function(){function WizardCtrl($log,NotifyService,Firebase,$firebase,UserModel){var self=this,vm=this;vm.userModel=UserModel;var ref=new Firebase("https://bug-free-food.firebaseio.com/orders"),sync=$firebase(ref);vm.orders=sync.$asArray(),vm.availableUsers=["James Morgan","Andy Gray","Simon Souter","Alex Lashford"],vm.selectedOrder=void 0,vm.newOrderItemForm=void 0,vm.totalCounts={},vm.myOrder={foods:[]},this.initOrderForUser=function(){vm.selectedOrder.details||(vm.selectedOrder.details=[{user:UserModel.user,order:[]}])},this.userHasOrder=function(){return vm.selectedOrder&&vm.selectedOrder.details&&UserModel.user?vm.selectedOrder.details.some(function(detail){return detail.user.id===UserModel.user.id}):!1},this.findUserOrder=function(){for(var index in vm.selectedOrder.details)if(vm.selectedOrder.details[index].user.id===UserModel.user.id)return vm.selectedOrder.details[index];throw Error("User not found in order")},this.addFoodItem=function(){var userOrder=this.findUserOrder();userOrder.order||(userOrder.order=[]),userOrder.order.push(vm.newOrderItemForm),vm.orders.$save(vm.selectedOrder).then(function(){NotifyService.success("Added "+userOrder.order[userOrder.order.length-1].name),vm.newOrderItemForm=void 0,self.updatePageTotals()})},this.removeFoodItem=function(index){this.findUserOrder().order.splice(index,1),vm.orders.$save(vm.selectedOrder).then(function(){NotifyService.success("Item removed"),self.updatePageTotals()})},this.getOrderTotals=function(){if(!vm.selectedOrder.details||vm.selectedOrder.details.length<=0)return 0;var total=0;return vm.selectedOrder.details.forEach(function(detail){detail.order&&detail.order.forEach(function(order){total+=order.price})}),(total/100).toFixed(2)},this.updatePageTotals=function(){!vm.selectedOrder.details||vm.selectedOrder.details.length<=0||(vm.totalCounts={},vm.selectedOrder.details.forEach(function(detail){detail.order&&detail.order.forEach(function(order){vm.totalCounts[order.name]?vm.totalCounts[order.name].count++:vm.totalCounts[order.name]={name:order.name,price:order.price,count:1}})}))}}WizardCtrl.$inject=["$log","NotifyService","Firebase","$firebase","UserModel"],angular.module("app.controllers.wizard").controller("WizardCtrl",WizardCtrl)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9fbW9kdWxlLmpzIiwianMvZGlyZWN0aXZlcy9fbW9kdWxlLmpzIiwianMvZmlsdGVycy9fbW9kdWxlLmpzIiwianMvaW50ZXJjZXB0b3JzL19tb2R1bGUuanMiLCJqcy9tb2RlbHMvX21vZHVsZS5qcyIsImpzL25vdGlmeS9fbW9kdWxlLmpzIiwianMvc2VydmljZXMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL2hvbWUvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL21lbnVzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9uYXZpZ2F0aW9uL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9vcmRlcnMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3Jlc3RhdXJhbnQvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3dpemFyZC9fbW9kdWxlLmpzIiwianMvY29uc3RhbnRzLmpzIiwianMvcm91dGVzLmpzIiwianMvY29udHJvbGxlcnMvQXBwQ3RybC5qcyIsImpzL2ludGVyY2VwdG9ycy9IdHRwTG9nZ2luZ0ludGVyY2VwdG9yLmpzIiwianMvbW9kZWxzL1VzZXJNb2RlbC5qcyIsImpzL25vdGlmeS9Ob3RpZnlTZXJ2aWNlLmpzIiwianMvc2VydmljZXMvRGF0ZVNlcnZpY2UuanMiLCJqcy9jb250cm9sbGVycy9ob21lL0hvbWVDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbWVudXMvQ3JlYXRlTWVudUN0cmwuanMiLCJqcy9jb250cm9sbGVycy9tZW51cy9MaXN0TWVudXNDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbmF2aWdhdGlvbi9Ub3BOYXZDdHJsLmpzIiwianMvY29udHJvbGxlcnMvb3JkZXJzL09yZGVyc0N0cmwuanMiLCJqcy9jb250cm9sbGVycy9yZXN0YXVyYW50L0NyZWF0ZVJlc3RhdXJhbnRDdHJsLmpzIiwianMvY29udHJvbGxlcnMvcmVzdGF1cmFudC9MaXN0UmVzdGF1cmFudEN0cmwuanMiLCJqcy9jb250cm9sbGVycy93aXphcmQvV2l6YXJkQ3RybC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxjQUVBLFdBRUEsR0FBQSxXQUVBLFVBQ0EsV0FFQSxrQkFDQSxlQUNBLGNBQ0EsaUJBQ0EsYUFDQSxhQUNBLG1CQUNBLGFBR0EsU0FBQSxPQUFBLE1BQUEsYUNqQkEsV0FFQSxRQUFBLE9BQUEsbUJBQ0EsdUJBQ0Esd0JBQ0EseUJBQ0EsNkJBQ0EseUJBQ0Esa0NDUkEsV0FFQSxRQUFBLE9BQUEsd0JDRkEsV0FFQSxRQUFBLE9BQUEscUJDRkEsV0FFQSxRQUFBLE9BQUEsMEJDRkEsV0FDQSxRQUFBLE9BQUEsb0JDREEsV0FFQSxRQUFBLE9BQUEsY0FBQSxhQUVBLFFBQUEsT0FBQSxjQUFBLEtBQUEsU0FBQSxTQUFBLFFBQ0EsT0FBQSxRQUNBLFNBQUEsSUFDQSxZQUFBLHlEQ1BBLFdBQ0EsUUFBQSxPQUFBLHNCQ0RBLFdBRUEsUUFBQSxPQUFBLDhCQ0ZBLFdBRUEsUUFBQSxPQUFBLCtCQ0ZBLFdBRUEsUUFBQSxPQUFBLG9DQ0ZBLFdBRUEsUUFBQSxPQUFBLGdDQ0ZBLFdBRUEsUUFBQSxPQUFBLG9DQ0ZBLFdBRUEsUUFBQSxPQUFBLGdDQ0ZBLFdBS0EsUUFBQSxPQUFBLE9BQUEsU0FBQSxVQUFBLFlDTkEsV0FLQSxHQUFBLFNBQUEsaUJBQUEsb0JBQUEsU0FBQSxlQUFBLG1CQUVBLGVBQUEsS0FBQSxLQUNBLFlBQUEsNENBQ0EsV0FBQSxtQkFNQSxlQUFBLEtBQUEsZ0JBQ0EsWUFBQSwrQ0FDQSxXQUFBLHFCQU1BLGVBQUEsS0FBQSxlQUNBLFlBQUEsNkNBQ0EsV0FBQSx5QkFFQSxlQUFBLEtBQUEsaUJBQ0EsWUFBQSw4Q0FDQSxXQUFBLDBCQU1BLGVBQUEsS0FBQSxxQkFDQSxZQUFBLHVEQUNBLFdBQUEsOEJBRUEsZUFBQSxLQUFBLHVCQUNBLFlBQUEsbURBQ0EsV0FBQSxnQ0FHQSxlQUFBLEtBQUEscUJBQ0EsWUFBQSxrREFDQSxXQUFBLHFCQU1B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LEdBQUEsbUJBQUEsTUFBQSxLQUFBLEdBQUEsU0FFQSxHQUFBLFlBQUEsTUFBQSxHQUFBLG9CQUNBLFFBQUEsSUFBQSxHQUFBLGFBRUEsR0FBQSxTQUNBLEtBQUEsR0FDQSxRQUVBLEtBQUEsR0FBQSxNQUFBLElBR0EsWUFBQSxLQUFBLFFBSUEsS0FBQSxXQUFBLFNBQUEsS0FBQSxPQUNBLEdBQUEsUUFBQSxNQUFBLE9BQUEsTUFBQSxJQUdBLEtBQUEsUUFBQSxXQUNBLEdBQUEsUUFBQSxNQUFBLE1BQ0EsS0FBQSxHQUFBLE1BQUEsNEVBeUJBLFFBQ0EsT0FBQSx5QkFDQSxXQUFBLGlCQUFBLG1CQzNGQSxXQUtBLFFBQUEsZUFBQSxLQUFBLGNBQUEsU0FBQSxXQUdBLEdBQUEsSUFBQSxLQUVBLElBQUEsR0FBQSxVQUFBLG9EQUNBLEtBQUEsVUFBQSxJQUVBLElBQUEsWUFBQSxLQUFBLFdBRUEsUUFBQSxJQUFBLEdBQUEsYUFFQSxLQUFBLGtCQUFBLFNBQUEsVUFBQSxPQUNBLFVBQUEsTUFBQSxPQUFBLE1BQUEsR0FDQSxHQUFBLFlBQUEsTUFBQSxrRkFJQSxRQUNBLE9BQUEseUJBQ0EsV0FBQSxnQkFBQSxrQkN6QkEsV0FLQSxRQUFBLFlBQUEsS0FBQSxjQUFBLHFCQUFBLFNBQUEsV0ErQkEsUUFBQSx1QkFBQSxNQUNBLE9BQ0EsVUFBQSxLQUFBLEtBQ0EsS0FBQSxNQUFBLFlBQUEsS0FBQSxJQUFBLGVBQUEsS0FBQSxVQUNBLGNBQUEsUUFBQSxZQUFBLEtBQUEsSUFBQSxlQUFBLEtBQUEsV0FJQSxRQUFBLFVBQUEsT0FDQSxLQUFBLE1BQUEsT0FDQSxjQUFBLE9BQUEsT0F0Q0EsR0FBQSxJQUFBLEtBRUEsSUFBQSxHQUFBLFVBQUEsdUNBRUEsSUFBQSxVQUFBLFNBRUEsSUFBQSxZQUFBLHFCQUFBLElBQ0EsU0FBQSxJQUFBLFlBR0EsS0FBQSxLQUFBLFdBQ0EsV0FBQSxrQkFBQSxLQUFBLHdCQUdBLEtBQUEsTUFBQSxXQUNBLEtBQUEsTUFBQSxrQkFDQSxXQUFBLE9BQUEsVUFBQSxZQUFBLEVBQUEsTUFBQSxTQUNBLEtBQUEsc0JBQUEsV0FHQSxLQUFBLE9BQUEsV0FDQSxLQUFBLE1BQUEsVUFDQSxRQUFBLElBQUEsWUFDQSxXQUFBLFVBQ0EsVUFBQSxLQUFBLEtBQ0EsY0FBQSxRQUFBLGlIQWlCQSxRQUNBLE9BQUEsOEJBQ0EsV0FBQSxhQUFBLGVDcERBLFdBS0EsUUFBQSxZQUFBLEtBQUEsY0FBQSxTQUFBLFVBQUEsV0FrRUEsUUFBQSxhQUNBLEdBQUEsVUFDQSxVQUFBLFVBQUEsS0FDQSxLQUFBLEdBQ0EsV0FBQSxHQUNBLGFBR0EsWUFBQSxLQUFBLE9BdkVBLEdBQUEsSUFBQSxLQUVBLElBQUEsR0FBQSxVQUFBLCtDQUNBLEtBQUEsVUFBQSxJQUVBLElBQUEsVUFBQSxVQUVBLEdBQUEsT0FBQSxLQUFBLFdBRUEsWUFHQSxHQUFBLGdCQUFBLGVBQUEsWUFBQSxlQUFBLGlCQUdBLEdBQUEsdUJBRUEsS0FBQSxxQkFDQSxhQUFBLE1BQ0EsUUFDQSxLQUFBLHFCQUFBLE1BQUEsTUFDQSxLQUFBLHlCQUFBLE1BQUEsTUFDQSxLQUFBLHdCQUFBLE1BQUEsTUFDQSxLQUFBLDRCQUFBLE1BQUEsTUFDQSxLQUFBLHFCQUFBLE1BQUEsTUFDQSxLQUFBLHlCQUFBLE1BQUEsTUFDQSxLQUFBLGtCQUFBLE1BQUEsTUFDQSxLQUFBLHNCQUFBLE1BQUEsTUFDQSxLQUFBLHlCQUFBLE1BQUEsTUFDQSxLQUFBLG1CQUFBLE1BQUEsTUFDQSxLQUFBLHVCQUFBLE1BQUEsTUFDQSxLQUFBLG1CQUFBLE1BQUEsTUFDQSxLQUFBLHVCQUFBLE1BQUEsTUFDQSxLQUFBLGNBQUEsTUFBQSxNQUNBLEtBQUEsY0FBQSxNQUFBLE1BQ0EsS0FBQSxpQkFBQSxNQUFBLFFBS0EsS0FBQSxZQUFBLFdBR0EsR0FBQSxTQUFBLFVBQUEsVUFBQSxLQUVBLEdBQUEsT0FBQSxLQUFBLFFBQUEsS0FBQSxHQUFBLFdBQ0EsS0FBQSxXQUNBLGNBQUEsUUFBQSw2QkFDQSxXQUNBLGNBQUEsT0FBQSwwQkFFQSxhQUdBLEtBQUEsWUFBQSxTQUFBLE9BQ0EsR0FBQSxPQUFBLFFBQUEsT0FDQSxLQUFBLFdBQ0EsY0FBQSxRQUFBLCtCQUNBLFdBQ0EsY0FBQSxPQUFBLDRHQWlCQSxRQUNBLE9BQUEsMEJBQ0EsV0FBQSxhQUFBLGVDdEZBLFdBS0EsUUFBQSxzQkFBQSxLQUFBLGNBQUEsU0FBQSxXQUdBLEdBQUEsSUFBQSxLQUVBLElBQUEsR0FBQSxVQUFBLG9EQUNBLEtBQUEsVUFBQSxJQUVBLElBQUEsV0FBQSxLQUFBLFdBQ0EsUUFBQSxJQUFBLEdBQUEsWUFFQSxHQUFBLGVBQ0EsS0FBQSxHQUNBLFlBQUEsS0FBQSxNQUNBLFVBR0EsS0FBQSxjQUFBLFdBQ0EsS0FBQSxNQUFBLDhCQUFBLEdBQUEsZUFFQSxHQUFBLFdBQUEsS0FBQSxRQUFBLEtBQUEsR0FBQSxnQkFFQSxHQUFBLGVBQ0EsS0FBQSxHQUNBLFlBQUEsS0FBQSxNQUNBLHdGQUtBLFFBQ0EsT0FBQSw4QkFDQSxXQUFBLHVCQUFBLHlCQ3JDQSxXQUtBLFFBQUEsb0JBQUEsS0FBQSxjQUFBLFNBQUEsV0FHQSxHQUFBLElBQUEsS0FFQSxJQUFBLEdBQUEsVUFBQSxvREFDQSxLQUFBLFVBQUEsSUFFQSxJQUFBLFlBQUEsS0FBQSxzRkFJQSxRQUNBLE9BQUEsOEJBQ0EsV0FBQSxxQkFBQSx1QkNuQkEsV0FLQSxRQUFBLFlBQUEsS0FBQSxjQUFBLFNBQUEsVUFBQSxXQUVBLEdBQUEsTUFBQSxLQUdBLEdBQUEsSUFFQSxJQUFBLFVBQUEsU0FFQSxJQUFBLEtBQUEsR0FBQSxVQUFBLCtDQUNBLEtBQUEsVUFBQSxJQUVBLElBQUEsT0FBQSxLQUFBLFdBR0EsR0FBQSxnQkFBQSxlQUFBLFlBQUEsZUFBQSxpQkFFQSxHQUFBLGNBQUEsT0FFQSxHQUFBLGlCQUFBLE9BRUEsR0FBQSxlQUdBLEdBQUEsU0FDQSxVQUdBLEtBQUEsaUJBQUEsV0FDQSxHQUFBLGNBQUEsVUFDQSxHQUFBLGNBQUEsVUFFQSxLQUFBLFVBQUEsS0FDQSxhQU1BLEtBQUEsYUFBQSxXQUNBLE1BQUEsSUFBQSxlQUFBLEdBQUEsY0FBQSxTQUFBLFVBQUEsS0FHQSxHQUFBLGNBQUEsUUFBQSxLQUFBLFNBQUEsUUFDQSxNQUFBLFFBQUEsS0FBQSxLQUFBLFVBQUEsS0FBQSxNQUhBLEdBT0EsS0FBQSxjQUFBLFdBQ0EsSUFBQSxHQUFBLFNBQUEsSUFBQSxjQUFBLFFBQ0EsR0FBQSxHQUFBLGNBQUEsUUFBQSxPQUFBLEtBQUEsS0FBQSxVQUFBLEtBQUEsR0FDQSxNQUFBLElBQUEsY0FBQSxRQUFBLE1BR0EsTUFBQSxPQUFBLDRCQUdBLEtBQUEsWUFBQSxXQUNBLEdBQUEsV0FBQSxLQUFBLGVBRUEsV0FBQSxRQUNBLFVBQUEsVUFFQSxVQUFBLE1BQUEsS0FBQSxHQUFBLGtCQUNBLEdBQUEsT0FBQSxNQUFBLEdBQUEsZUFDQSxLQUFBLFdBQ0EsY0FBQSxRQUFBLFNBQUEsVUFBQSxNQUFBLFVBQUEsTUFBQSxPQUFBLEdBQUEsTUFDQSxHQUFBLGlCQUFBLE9BQ0EsS0FBQSxzQkFJQSxLQUFBLGVBQUEsU0FBQSxPQUNBLEtBQUEsZ0JBQUEsTUFBQSxPQUFBLE1BQUEsR0FDQSxHQUFBLE9BQUEsTUFBQSxHQUFBLGVBQ0EsS0FBQSxXQUNBLGNBQUEsUUFBQSxnQkFDQSxLQUFBLHNCQUlBLEtBQUEsZUFBQSxXQUNBLElBQUEsR0FBQSxjQUFBLFNBQUEsR0FBQSxjQUFBLFFBQUEsUUFBQSxFQUNBLE1BQUEsRUFFQSxJQUFBLE9BQUEsQ0FRQSxPQVBBLElBQUEsY0FBQSxRQUFBLFFBQUEsU0FBQSxRQUNBLE9BQUEsT0FDQSxPQUFBLE1BQUEsUUFBQSxTQUFBLE9BQ0EsT0FBQSxNQUFBLFdBSUEsTUFBQSxLQUFBLFFBQUEsSUFJQSxLQUFBLGlCQUFBLFlBQ0EsR0FBQSxjQUFBLFNBQUEsR0FBQSxjQUFBLFFBQUEsUUFBQSxJQUlBLEdBQUEsZUFDQSxHQUFBLGNBQUEsUUFBQSxRQUFBLFNBQUEsUUFDQSxPQUFBLE9BQ0EsT0FBQSxNQUFBLFFBQUEsU0FBQSxPQUNBLEdBQUEsWUFBQSxNQUFBLE1BT0EsR0FBQSxZQUFBLE1BQUEsTUFBQSxRQU5BLEdBQUEsWUFBQSxNQUFBLE9BQ0EsS0FBQSxNQUFBLEtBQ0EsTUFBQSxNQUFBLE1BQ0EsTUFBQSx3RkFXQSxRQUNBLE9BQUEsMEJBQ0EsV0FBQSxhQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgcmVxdWlyZXMgPSBbXG4gICAgICAgIC8vIDNyZCBQYXJ0eVxuICAgICAgICAnbmdSb3V0ZScsXG4gICAgICAgICdmaXJlYmFzZScsXG4gICAgICAgIC8vIEludGVybmFsc1xuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzJyxcbiAgICAgICAgJ2FwcC5zZXJ2aWNlcycsXG4gICAgICAgICdhcHAuZmlsdGVycycsXG4gICAgICAgICdhcHAuZGlyZWN0aXZlcycsXG4gICAgICAgICdhcHAubW9kZWxzJyxcbiAgICAgICAgJ2FwcC5yb3V0ZXMnLFxuICAgICAgICAnYXBwLmludGVyY2VwdG9ycycsXG4gICAgICAgICdhcHAubm90aWZ5J1xuICAgIF07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJywgcmVxdWlyZXMpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMnLCBbXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMuaG9tZScsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMubWVudXMnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMud2l6YXJkJyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5uYXZpZ2F0aW9uJ1xuICAgIF0pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcnMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5pbnRlcmNlcHRvcnMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubW9kZWxzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubm90aWZ5JywgWydjZ05vdGlmeSddKTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubm90aWZ5JykucnVuKGZ1bmN0aW9uIChub3RpZnkpIHtcbiAgICAgICAgbm90aWZ5LmNvbmZpZyh7XG4gICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy90ZW1wbGF0ZXMvYW5ndWxhci1ub3RpZnkuaHRtbCdcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnLCBbXSk7XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMuaG9tZScsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm1lbnVzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubmF2aWdhdGlvbicsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy53aXphcmQnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQmFzaWMgYXBwIHZlcnNpb24gY29uc3RhbnRcbiAgICAgKi9cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ3ZlcnNpb24nLCAnMC4wLjEnKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIFJvdXRlcyA9IGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcblxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL2hvbWUvaW5kZXguaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwgYXMgaGMnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcmRlcnMgTWFuYWdlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL29yZGVycy9saXN0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL29yZGVycy9vcmRlcnMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnT3JkZXJzQ3RybCBhcyB2bSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1lbnVzIE1hbmFnZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9tZW51cy9saXN0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL21lbnVzL21lbnVzLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xpc3RNZW51c0N0cmwgYXMgbG1jJ1xuICAgICAgICB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL21lbnVzL2NyZWF0ZScsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9tZW51cy9jcmVhdGUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ3JlYXRlTWVudUN0cmwgYXMgY21jJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVzdGF1cmFudCBNYW5hZ2VtZW50XG4gICAgICAgICAqL1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvcmVzdGF1cmFudHMvbGlzdCcsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9yZXN0YXVyYW50L3Jlc3RhdXJhbnQuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTGlzdFJlc3RhdXJhbnRDdHJsIGFzIGxyYydcbiAgICAgICAgfSk7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9yZXN0YXVyYW50cy9jcmVhdGUnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvcmVzdGF1cmFudC9jcmVhdGUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ3JlYXRlUmVzdGF1cmFudEN0cmwgYXMgY3JjJ1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvd2l6YXJkL25ldy1vcmRlcicsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy93aXphcmQvbmV3LW9yZGVyLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1dpemFyZEN0cmwgYXMgdm0nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGYWxsYmFja1xuICAgICAgICAgKi9cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIub3RoZXJ3aXNlKHtcbiAgICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBEaXNhYmxlIGh0bWwgNSBtb2RlIGR1ZSB0byBJRTkgY29tcGF0aWJpbGl0eSByZXF1aXJlbWVudCFcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKGZhbHNlKTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5yb3V0ZXMnLCBbXSlcbiAgICAgICAgLmNvbmZpZyhSb3V0ZXMpO1xuXG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQXBwQ3RybCgkbG9nLCAkcm9vdFNjb3BlLCBOb3RpZnlTZXJ2aWNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oXCIkcm91dGVDaGFuZ2VFcnJvclwiLCBmdW5jdGlvbiAoZXZlbnQsIGN1cnJlbnQsIHByZXZpb3VzLCByZWplY3Rpb24pIHtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJ0ZhaWxlZCB0byBjaGFuZ2Ugcm91dGUgWycgKyAocmVqZWN0aW9uLmRhdGEuZXJyb3IgPyByZWplY3Rpb24uZGF0YS5lcnJvciA6IHJlamVjdGlvbi5kYXRhKSArICddJztcbiAgICAgICAgICAgICRsb2cuZXJyb3IobWVzc2FnZSk7XG4gICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLmRhbmdlcihtZXNzYWdlKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycycpXG4gICAgICAgIC5jb250cm9sbGVyKCdBcHBDdHJsJywgQXBwQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5pbnRlcmNlcHRvcnMnKS5mYWN0b3J5KCdsb2dnaW5nSW50ZXJjZXB0b3InLCBmdW5jdGlvbiAoJHEsICRsb2cpIHtcblxuICAgICAgICBmdW5jdGlvbiBpc1BhcnRpYWwodXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJsLmluZGV4T2YoJ3BhcnRpYWxzJykgPT09IC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICdyZXF1ZXN0JzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgICAgIGlmIChpc1BhcnRpYWwoY29uZmlnLnVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZygnSHR0cCBSZXF1ZXN0IFsnICsgY29uZmlnLm1ldGhvZCArICddWycgKyBjb25maWcudXJsICsgJ10nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdyZXF1ZXN0RXJyb3InOiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignSHR0cCBSZXF1ZXN0IEVycm9yIFsnICsgY29uZmlnLm1ldGhvZCArICddWycgKyBjb25maWcudXJsICsgJ10nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3Jlc3BvbnNlJzogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUGFydGlhbChyZXNwb25zZS5jb25maWcudXJsKSkge1xuICAgICAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKCdIdHRwIFJlc3BvbnNlIFN1Y2Nlc3M6IFN0YXR1cyBbJyArIHJlc3BvbnNlLnN0YXR1cyArICddIHRvIFsnICsgcmVzcG9uc2UuY29uZmlnLm1ldGhvZCArICddWycgKyByZXNwb25zZS5jb25maWcudXJsICsgJ10nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3Jlc3BvbnNlRXJyb3InOiBmdW5jdGlvbiAocmVqZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignSHR0cCBSZXNwb25zZSBFcnJvcjogU3RhdHVzIFsnICsgcmVqZWN0aW9uLnN0YXR1cyArICddIHRvIFsnICsgcmVqZWN0aW9uLmNvbmZpZy5tZXRob2QgKyAnXVsnICsgcmVqZWN0aW9uLmNvbmZpZy51cmwgKyAnXSBkYXRhIFsnICsgKHJlamVjdGlvbi5kYXRhLmVycm9yID8gcmVqZWN0aW9uLmRhdGEuZXJyb3IgOiByZWplY3Rpb24uZGF0YSkgKyAnXScpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaW50ZXJjZXB0b3JzJykuY29uZmlnKFsnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyKSB7XG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2xvZ2dpbmdJbnRlcmNlcHRvcicpO1xuICAgIH1dKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIFVzZXJNb2RlbCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUaGUgdXNlclxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB1c2VyOiBudWxsXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubW9kZWxzJykuZmFjdG9yeSgnVXNlck1vZGVsJywgVXNlck1vZGVsKTtcbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIE5vdGlmeVNlcnZpY2UgPSBmdW5jdGlvbiAobm90aWZ5KSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBEQU5HRVJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYW5nZXIgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtZGFuZ2VyJ30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGEgbm90aWZpY2F0aW9uIHdpdGggc3R5bGUgV0FSTklOR1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSB0aGUgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndhcm5pbmcgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtd2FybmluZyd9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhIG5vdGlmaWNhdGlvbiB3aXRoIHN0eWxlIFNVQ0NFU1NcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWNjZXNzID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5vdGlmeSh7bWVzc2FnZTogbWVzc2FnZSwgY2xhc3NlczogJ2FsZXJ0LXN1Y2Nlc3MnfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBJTkZPXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5mbyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBub3RpZnkoe21lc3NhZ2U6IG1lc3NhZ2UsIGNsYXNzZXM6ICdhbGVydC1pbmZvJ30pO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5ub3RpZnknKVxuICAgICAgICAuc2VydmljZSgnTm90aWZ5U2VydmljZScsIE5vdGlmeVNlcnZpY2UpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIHZhciBEYXRlU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIERhdGUgTk9XXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBEYXRlIE5PVyBpbiBzZWNvbmRzXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIG51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm93KCkuZ2V0VGltZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycpXG4gICAgICAgIC5zZXJ2aWNlKCdEYXRlU2VydmljZScsIERhdGVTZXJ2aWNlKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBIb21lQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9cIik7XG4gICAgICAgIC8vIGNyZWF0ZSBhbiBBbmd1bGFyRmlyZSByZWZlcmVuY2UgdG8gdGhlIGRhdGFcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcbiAgICAgICAgLy8gZG93bmxvYWQgdGhlIGRhdGEgaW50byBhIGxvY2FsIG9iamVjdFxuICAgICAgICB2bS5kYXRhID0gc3luYy4kYXNPYmplY3QoKTtcblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLmhvbWUnKVxuICAgICAgICAuY29udHJvbGxlcignSG9tZUN0cmwnLCBIb21lQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQ3JlYXRlTWVudUN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vIHJlc3RhdXJhbnRzUmVmXG4gICAgICAgIHZhciByZXN0YXVyYW50c1JlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHJlc3RhdXJhbnRzU3luYyA9ICRmaXJlYmFzZShyZXN0YXVyYW50c1JlZik7XG5cbiAgICAgICAgdm0ucmVzdGF1cmFudHMgPSByZXN0YXVyYW50c1N5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdGF1cmFudHMpO1xuXG4gICAgICAgIC8vIG1lbnVSZWZcbiAgICAgICAgdmFyIG1lbnVSZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vbWVudXNcIik7XG4gICAgICAgIHZhciBtZW51U3luYyA9ICRmaXJlYmFzZShtZW51UmVmKTtcblxuICAgICAgICB2bS5tZW51cyA9IG1lbnVTeW5jLiRhc0FycmF5KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHZtLm1lbnVzKTtcblxuICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQgPSB7fTtcbiAgICAgICAgdm0ubmV3TWVudSA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgZm9vZHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLCBwcmljZTogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuY3JlYXRlTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGRpbmcgbmV3IG1lbnUgWyVzXScsIGFuZ3VsYXIudG9Kc29uKHZtLm5ld01lbnUpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLnNlbGVjdGVkUmVzdGF1cmFudCk7XG5cbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXN0YXVyYW50Lm1lbnVzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQubWVudXMucHVzaCh2bS5uZXdNZW51KTtcblxuICAgICAgICAgICAgdm0ucmVzdGF1cmFudHMuJHNhdmUodm0uc2VsZWN0ZWRSZXN0YXVyYW50KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLnJlc3RhdXJhbnRzKTtcblxuICAgICAgICAgICAgdm0ubmV3TWVudSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5yZW1vdmVGb29kID0gZnVuY3Rpb24gKGZvb2QsIGluZGV4KSB7XG4gICAgICAgICAgICB2bS5uZXdNZW51LmZvb2RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hZGRGb29kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubmV3TWVudS5mb29kcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJywgcHJpY2U6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4vLyAgICAgICAgU21hbGwgQ2hpY2tlbiBOYWFuXHTCozMuODBcbi8vICAgICAgICBTbWFsbCBDaGlja2VuIENoYXBhdHRpXHTCozMuODBcbi8vICAgICAgICBDaGlja2VuIExhbWIgTWl4IE5hYW5cdMKjNi4wMFxuLy8gICAgICAgIENoaWNrZW4gTGFtYiBNaXggQ2hhcGF0dGlcdMKjNi4wMFxuLy8gICAgICAgIExhcmdlIENoaWNrZW4gTmFhblx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgTGFtYiBOYWFuXHTCozYuMDBcbi8vICAgICAgICBMYXJnZSBMYW1iIENoYXBhdHRpXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIFNlZWtoIE1peCBOYWFuXHTCozYuMDBcbi8vICAgICAgICBDaGlja2VuIFNlZWtoIE1peCBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgU21hbGwgU2Vla2ggTmFhblx0wqMyLjkwXG4vLyAgICAgICAgU21hbGwgU2Vla2ggQ2hhcGF0dGlcdMKjMi45MFxuLy8gICAgICAgIExhcmdlIFNlZWtoIE5hYW5cdMKjMy43MFxuLy8gICAgICAgIExhcmdlIFNlZWtoIENoYXBhdHRpXHTCozMuNzBcbi8vICAgICAgICBTbWFsbCBDaGlwc1x0wqMxLjMwXG4vLyAgICAgICAgTGFyZ2UgQ2hpcHNcdMKjMi4wMFxuLy8gICAgICAgIENoaWNrZW4gRG9ubmVyXHTCozMuNTBcblxuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnKVxuICAgICAgICAuY29udHJvbGxlcignQ3JlYXRlTWVudUN0cmwnLCBDcmVhdGVNZW51Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTGlzdE1lbnVzQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcblxuICAgICAgICB2bS5yZXN0YXVyYW50cyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0YXVyYW50cyk7XG5cbiAgICAgICAgdGhpcy5yZW1vdmVNZW51QXRJbmRleCA9IGZ1bmN0aW9uIChyZXN0dXJhbnQsIGluZGV4KSB7XG4gICAgICAgICAgICByZXN0dXJhbnQubWVudXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHZtLnJlc3RhdXJhbnRzLiRzYXZlKHJlc3R1cmFudCk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnKVxuICAgICAgICAuY29udHJvbGxlcignTGlzdE1lbnVzQ3RybCcsIExpc3RNZW51c0N0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFRvcE5hdkN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgJGZpcmViYXNlU2ltcGxlTG9naW4sIEZpcmViYXNlLCBVc2VyTW9kZWwpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tXCIpO1xuXG4gICAgICAgIHZtLnVzZXJNb2RlbCA9IFVzZXJNb2RlbDtcblxuICAgICAgICB2YXIgYXV0aENsaWVudCA9ICRmaXJlYmFzZVNpbXBsZUxvZ2luKHJlZik7XG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhDbGllbnQpO1xuXG4gICAgICAgIC8vIFRPRE8gbW92ZSB0byByZXNvbHZlIVxuICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBhdXRoQ2xpZW50LiRnZXRDdXJyZW50VXNlcigpLnRoZW4oaGFuZGxlU3VjY2Vzc2Z1bExvZ2luKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmxvZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZygnTG9naW4gLSBnaXRodWInKTtcbiAgICAgICAgICAgIGF1dGhDbGllbnQuJGxvZ2luKCdnaXRodWInLCB7IHJlbWVtYmVyTWU6IHRydWUsIHNjb3BlOiAndXNlcid9KVxuICAgICAgICAgICAgICAgIC50aGVuKGhhbmRsZVN1Y2Nlc3NmdWxMb2dpbiwgcG9wRXJyb3IpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZygnTG9nb3V0Jyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhdXRoQ2xpZW50KTtcbiAgICAgICAgICAgIGF1dGhDbGllbnQuJGxvZ291dCgpO1xuICAgICAgICAgICAgVXNlck1vZGVsLnVzZXIgPSBudWxsO1xuICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKCd1c2VyIGlzIGxvZ2dlZCBvdXQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVTdWNjZXNzZnVsTG9naW4odXNlcikge1xuICAgICAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgICAgICBVc2VyTW9kZWwudXNlciA9IHVzZXI7XG4gICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZyhcIlVzZXIgSUQ6IFwiICsgdXNlci51aWQgKyBcIiwgUHJvdmlkZXI6IFwiICsgdXNlci5wcm92aWRlcik7XG4gICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKFwiVXNlciBJRDogXCIgKyB1c2VyLnVpZCArIFwiLCBQcm92aWRlcjogXCIgKyB1c2VyLnByb3ZpZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHBvcEVycm9yKGVycm9yKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIE5vdGlmeVNlcnZpY2UuZGFuZ2VyKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm5hdmlnYXRpb24nKVxuICAgICAgICAuY29udHJvbGxlcignVG9wTmF2Q3RybCcsIFRvcE5hdkN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE9yZGVyc0N0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSwgVXNlck1vZGVsKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9vcmRlcnNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0udXNlck1vZGVsID0gVXNlck1vZGVsO1xuXG4gICAgICAgIHZtLm9yZGVycyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICByZXNldEZvcm0oKTtcblxuICAgICAgICAvLyBVc2Vyc1xuICAgICAgICB2bS5hdmFpbGFibGVVc2VycyA9IFsnSmFtZXMgTW9yZ2FuJywgJ0FuZHkgR3JheScsICdTaW1vbiBTb3V0ZXInLCAnQWxleCBMYXNoZm9yZCddO1xuXG4gICAgICAgIC8vIEF2YWlsYWJsZSBwYWdlIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgdm0uYXZhaWxhYmxlUmVzdGF1cmFudHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0FiZHVscyBMZXZlbnNodWxtZScsXG4gICAgICAgICAgICAgICAgb3BlbmluZ1RpbWVzOiAnLi4uJyxcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gTmFhbicsIHByaWNlOiAzODB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gQ2hhcGF0dGknLCBwcmljZTogMzAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IE5hYW4nLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IENoYXBhdHRpJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aScsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgTmFhbicsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgQ2hhcGF0dGknLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIFNlZWtoIE1peCBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgU2Vla2ggTmFhbicsIHByaWNlOiAyOTB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDI5MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgU2Vla2ggTmFhbicsIHByaWNlOiAzNzB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDM3MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgQ2hpcHMnLCBwcmljZTogMTMwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBDaGlwcycsIHByaWNlOiAyMDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0NoaWNrZW4gRG9ubmVyJywgcHJpY2U6IDM1MH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdGhpcy5jcmVhdGVPcmRlciA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgLy8gU2V0IHRoZSB1c2VyXG4gICAgICAgICAgICB2bS5uZXdPcmRlci5jcmVhdGVkQnkgPSBVc2VyTW9kZWwudXNlcjtcblxuICAgICAgICAgICAgdm0ub3JkZXJzLiRhZGQoYW5ndWxhci5jb3B5KHZtLm5ld09yZGVyKSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IGFkZGVkIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLmRhbmdlcignVW5hYmxlIHRvIHNhdmUgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc2V0Rm9ybSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlT3JkZXIgPSBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgIHZtLm9yZGVycy4kcmVtb3ZlKG9yZGVyKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVtb3ZlZCBvcmRlcicpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoJ1VuYWJsZSB0byByZW1vdmUgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiByZXNldEZvcm0oKSB7XG4gICAgICAgICAgICB2bS5uZXdPcmRlciA9IHtcbiAgICAgICAgICAgICAgICBjcmVhdGVkQnk6IFVzZXJNb2RlbC51c2VyLFxuICAgICAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgICAgIHJlc3RhdXJhbnQ6ICcnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgICAgICAgICAge31cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWREYXRlOiBEYXRlLm5vdygpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMub3JkZXJzJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ09yZGVyc0N0cmwnLCBPcmRlcnNDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBDcmVhdGVSZXN0YXVyYW50Q3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9yZXN0YXVyYW50c1wiKTtcbiAgICAgICAgdmFyIHN5bmMgPSAkZmlyZWJhc2UocmVmKTtcblxuICAgICAgICB2bS5yZXN0dXJhbnRzID0gc3luYy4kYXNBcnJheSgpO1xuICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0dXJhbnRzKTtcblxuICAgICAgICB2bS5uZXdSZXN0YXVyYW50ID0ge1xuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIG1lbnVzOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYWRkUmVzdGF1cmFudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ0FkZGluZyBuZXcgcmVzdGF1cmFudHMgWyVzXScsIHZtLm5ld1Jlc3RhdXJhbnQpO1xuXG4gICAgICAgICAgICB2bS5yZXN0dXJhbnRzLiRhZGQoYW5ndWxhci5jb3B5KHZtLm5ld1Jlc3RhdXJhbnQpKTtcblxuICAgICAgICAgICAgdm0ubmV3UmVzdGF1cmFudCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICBtZW51czogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdDcmVhdGVSZXN0YXVyYW50Q3RybCcsIENyZWF0ZVJlc3RhdXJhbnRDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBMaXN0UmVzdGF1cmFudEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0ucmVzdGF1cmFudHMgPSBzeW5jLiRhc0FycmF5KCk7XG5cbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5yZXN0YXVyYW50JylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xpc3RSZXN0YXVyYW50Q3RybCcsIExpc3RSZXN0YXVyYW50Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gV2l6YXJkQ3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlLCBVc2VyTW9kZWwpIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0udXNlck1vZGVsID0gVXNlck1vZGVsO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vb3JkZXJzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLm9yZGVycyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICAvLyBFbXBsb3llZXNcbiAgICAgICAgdm0uYXZhaWxhYmxlVXNlcnMgPSBbJ0phbWVzIE1vcmdhbicsICdBbmR5IEdyYXknLCAnU2ltb24gU291dGVyJywgJ0FsZXggTGFzaGZvcmQnXTtcblxuICAgICAgICB2bS5zZWxlY3RlZE9yZGVyID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIHZtLm5ld09yZGVySXRlbUZvcm0gPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgdm0udG90YWxDb3VudHMgPSB7fTtcblxuICAgICAgICAvLyBUaGUgZGF0YSBmb3JtXG4gICAgICAgIHZtLm15T3JkZXIgPSB7XG4gICAgICAgICAgICBmb29kczogW11cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmluaXRPcmRlckZvclVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscykge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscyA9IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogVXNlck1vZGVsLnVzZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogW11cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnVzZXJIYXNPcmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRPcmRlciB8fCAhdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzIHx8ICFVc2VyTW9kZWwudXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMuc29tZShmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRldGFpbC51c2VyLmlkID09PSBVc2VyTW9kZWwudXNlci5pZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmZpbmRVc2VyT3JkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzW2luZGV4XS51c2VyLmlkID09PSBVc2VyTW9kZWwudXNlci5pZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm0uc2VsZWN0ZWRPcmRlci5kZXRhaWxzW2luZGV4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignVXNlciBub3QgZm91bmQgaW4gb3JkZXInKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFkZEZvb2RJdGVtID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHVzZXJPcmRlciA9IHRoaXMuZmluZFVzZXJPcmRlcigpO1xuXG4gICAgICAgICAgICBpZiAoIXVzZXJPcmRlci5vcmRlcikge1xuICAgICAgICAgICAgICAgIHVzZXJPcmRlci5vcmRlciA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXNlck9yZGVyLm9yZGVyLnB1c2godm0ubmV3T3JkZXJJdGVtRm9ybSk7XG4gICAgICAgICAgICB2bS5vcmRlcnMuJHNhdmUodm0uc2VsZWN0ZWRPcmRlcilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnQWRkZWQgJyArIHVzZXJPcmRlci5vcmRlclt1c2VyT3JkZXIub3JkZXIubGVuZ3RoIC0gMV0ubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5ld09yZGVySXRlbUZvcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlUGFnZVRvdGFscygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlRm9vZEl0ZW0gPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgIHRoaXMuZmluZFVzZXJPcmRlcigpLm9yZGVyLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB2bS5vcmRlcnMuJHNhdmUodm0uc2VsZWN0ZWRPcmRlcilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnSXRlbSByZW1vdmVkJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlUGFnZVRvdGFscygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ2V0T3JkZXJUb3RhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscyB8fCB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB0b3RhbCA9IDA7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMuZm9yRWFjaChmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRldGFpbC5vcmRlcikge1xuICAgICAgICAgICAgICAgICAgICBkZXRhaWwub3JkZXIuZm9yRWFjaChmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IG9yZGVyLnByaWNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAodG90YWwgLyAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgIH07XG5cblxuICAgICAgICB0aGlzLnVwZGF0ZVBhZ2VUb3RhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkT3JkZXIuZGV0YWlscyB8fCB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZtLnRvdGFsQ291bnRzID0ge307XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE9yZGVyLmRldGFpbHMuZm9yRWFjaChmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRldGFpbC5vcmRlcikge1xuICAgICAgICAgICAgICAgICAgICBkZXRhaWwub3JkZXIuZm9yRWFjaChmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdm0udG90YWxDb3VudHNbb3JkZXIubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50b3RhbENvdW50c1tvcmRlci5uYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogb3JkZXIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2U6IG9yZGVyLnByaWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsQ291bnRzW29yZGVyLm5hbWVdLmNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMud2l6YXJkJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1dpemFyZEN0cmwnLCBXaXphcmRDdHJsKTtcblxufSkoKTsiXSwic291cmNlUm9vdCI6ImFwcCJ9