"use strict";!function(){var requires=["ngRoute","firebase","app.controllers","app.services","app.filters","app.directives","app.models","app.routes","app.interceptors","app.notify"];angular.module("app",requires)}(),function(){angular.module("app.controllers",["app.controllers.home","app.controllers.menus","app.controllers.orders","app.controllers.restaurant","app.controllers.wizard","app.controllers.navigation"])}(),function(){angular.module("app.directives",[])}(),function(){angular.module("app.filters",[])}(),function(){angular.module("app.interceptors",[])}(),function(){angular.module("app.models",[])}(),function(){angular.module("app.notify",["cgNotify"]),angular.module("app.notify").run(["notify",function(notify){notify.config({duration:2e3,templateUrl:"/www-build/views/templates/angular-notify.html"})}])}(),function(){angular.module("app.services",[])}(),function(){angular.module("app.controllers.home",[])}(),function(){angular.module("app.controllers.menus",[])}(),function(){angular.module("app.controllers.navigation",[])}(),function(){angular.module("app.controllers.orders",[])}(),function(){angular.module("app.controllers.restaurant",[])}(),function(){angular.module("app.controllers.wizard",[])}(),function(){angular.module("app").constant("version","0.0.1")}(),function(){var Routes=["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/www-build/views/partials/home/index.html",controller:"HomeCtrl as hc"}),$routeProvider.when("/orders/list",{templateUrl:"/www-build/views/partials/orders/orders.html",controller:"OrdersCtrl as vm"}),$routeProvider.when("/menus/list",{templateUrl:"/www-build/views/partials/menus/menus.html",controller:"ListMenusCtrl as lmc"}),$routeProvider.when("/menus/create",{templateUrl:"/www-build/views/partials/menus/create.html",controller:"CreateMenuCtrl as cmc"}),$routeProvider.when("/restaurants/list",{templateUrl:"/www-build/views/partials/restaurant/restaurant.html",controller:"ListRestaurantCtrl as lrc"}),$routeProvider.when("/restaurants/create",{templateUrl:"/www-build/views/partials/restaurant/create.html",controller:"CreateRestaurantCtrl as crc"}),$routeProvider.when("/wizard/new-order",{templateUrl:"/www-build/views/partials/wizard/new-order.html",controller:"WizardCtrl as vm"}),$routeProvider.otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!1)}];Routes.$inject=["$routeProvider","$locationProvider"],angular.module("app.routes",[]).config(Routes)}(),function(){function AppCtrl($log,$rootScope,NotifyService){$rootScope.$on("$routeChangeError",function(event,current,previous,rejection){var message="Failed to change route ["+(rejection.data.error?rejection.data.error:rejection.data)+"]";$log.error(message),NotifyService.danger(message)})}AppCtrl.$inject=["$log","$rootScope","NotifyService"],angular.module("app.controllers").controller("AppCtrl",AppCtrl)}(),function(){angular.module("app.interceptors").factory("loggingInterceptor",["$q","$log",function($q,$log){function isPartial(url){return-1===url.indexOf("partials")}return{request:function(config){return isPartial(config.url)&&$log.debug("Http Request ["+config.method+"]["+config.url+"]"),config},requestError:function(config){return $log.error("Http Request Error ["+config.method+"]["+config.url+"]"),config},response:function(response){return isPartial(response.config.url)&&$log.debug("Http Response Success: Status ["+response.status+"] to ["+response.config.method+"]["+response.config.url+"]"),response},responseError:function(rejection){return $log.error("Http Response Error: Status ["+rejection.status+"] to ["+rejection.config.method+"]["+rejection.config.url+"] data ["+(rejection.data.error?rejection.data.error:rejection.data)+"]"),$q.reject(rejection)}}}]),angular.module("app.interceptors").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("loggingInterceptor")}])}(),function(){var UserModel=function(){return{user:null}};angular.module("app.models").factory("UserModel",UserModel)}(),function(){var NotifyService=["notify",function(notify){this.danger=function(message){notify({message:message,classes:"alert-danger"})},this.warning=function(message){notify({message:message,classes:"alert-warning"})},this.success=function(message){notify({message:message,classes:"alert-success"})},this.info=function(message){notify({message:message,classes:"alert-info"})}}];NotifyService.$inject=["notify"],angular.module("app.notify").service("NotifyService",NotifyService)}(),function(){var DateService=function(){this.now=function(){return new Date},this.getTime=function(){return this.now().getTime()}};angular.module("app.services").service("DateService",DateService)}(),function(){function HomeCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/"),sync=$firebase(ref);vm.data=sync.$asObject()}HomeCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.home").controller("HomeCtrl",HomeCtrl)}(),function(){function CreateMenuCtrl($log,NotifyService,Firebase,$firebase){var vm=this,restaurantsRef=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),restaurantsSync=$firebase(restaurantsRef);vm.restaurants=restaurantsSync.$asArray(),console.log(vm.restaurants);var menuRef=new Firebase("https://bug-free-food.firebaseio.com/menus"),menuSync=$firebase(menuRef);vm.menus=menuSync.$asArray(),console.log(vm.menus),vm.selectedRestaurant={},vm.newMenu={name:"",foods:[{name:"",price:0}],createdDate:Date.now()},this.createMenu=function(){console.log("Adding new menu [%s]",angular.toJson(vm.newMenu)),console.log(vm.selectedRestaurant),vm.selectedRestaurant.menus||(vm.selectedRestaurant.menus=[]),vm.selectedRestaurant.menus.push(vm.newMenu),vm.restaurants.$save(vm.selectedRestaurant),console.log(vm.restaurants),vm.newMenu={name:"",foods:[{name:"",price:0}],createdDate:Date.now()}},this.removeFood=function(food,index){vm.newMenu.foods.splice(index,1)},this.addFood=function(){vm.newMenu.foods.push({name:"",price:0})}}CreateMenuCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.menus").controller("CreateMenuCtrl",CreateMenuCtrl)}(),function(){function ListMenusCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.restaurants=sync.$asArray(),console.log(vm.restaurants),this.removeMenuAtIndex=function(resturant,index){resturant.menus.splice(index,1),vm.restaurants.$save(resturant)}}ListMenusCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.menus").controller("ListMenusCtrl",ListMenusCtrl)}(),function(){function TopNavCtrl($log,NotifyService,$firebaseSimpleLogin,Firebase,UserModel){function handleSuccessfulLogin(user){user&&(vm.currentUser=user,UserModel.user=user,$log.debug("User ID: "+user.uid+", Provider: "+user.provider),NotifyService.success("User ID: "+user.uid+", Provider: "+user.provider))}function popError(error){$log.error(error),NotifyService.danger(error)}var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com");vm.currentUser=UserModel.user;var authClient=$firebaseSimpleLogin(ref);console.log(authClient),authClient.$getCurrentUser().then(handleSuccessfulLogin),this.login=function(){$log.debug("Login - github"),authClient.$login("github",{rememberMe:!0,scope:"user"}).then(handleSuccessfulLogin,popError)},this.logout=function(){$log.debug("Logout"),console.log(authClient),authClient.$logout(),vm.currentUser=null,UserModel.user=null,NotifyService.success("user is logged out")}}TopNavCtrl.$inject=["$log","NotifyService","$firebaseSimpleLogin","Firebase","UserModel"],angular.module("app.controllers.navigation").controller("TopNavCtrl",TopNavCtrl)}(),function(){function OrdersCtrl($log,NotifyService,Firebase,$firebase){function resetForm(){vm.newOrder={createdBy:"",name:"",restaurant:"",content:[{}],createdDate:Date.now()}}var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/orders"),sync=$firebase(ref);vm.orders=sync.$asArray(),resetForm(),vm.availableUsers=["James Morgan","Andy Gray","Simon Souter","Alex Lashford"],vm.availableRestaurants=[{name:"Abduls Levenshulme",openingTimes:"...",foods:[{name:"Small Chicken Naan",price:380},{name:"Small Chicken Chapatti",price:300},{name:"Chicken Lamb Mix Naan",price:600},{name:"Chicken Lamb Mix Chapatti",price:600},{name:"Large Chicken Naan",price:600},{name:"Large Chicken Chapatti",price:600},{name:"Large Lamb Naan",price:600},{name:"Large Lamb Chapatti",price:600},{name:"Chicken Seekh Mix Naan",price:600},{name:"Small Seekh Naan",price:290},{name:"Small Seekh Chapatti",price:290},{name:"Large Seekh Naan",price:370},{name:"Large Seekh Chapatti",price:370},{name:"Small Chips",price:130},{name:"Large Chips",price:200},{name:"Chicken Donner",price:350}]}],this.createOrder=function(){vm.orders.$add(angular.copy(vm.newOrder)).then(function(){NotifyService.success("Successfully added order")},function(){NotifyService.danger("Unable to save order")}),resetForm()},this.removeOrder=function(order){vm.orders.$remove(order).then(function(){NotifyService.success("Successfully removed order")},function(){NotifyService.danger("Unable to remove order")})}}OrdersCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.orders").controller("OrdersCtrl",OrdersCtrl)}(),function(){function CreateRestaurantCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.resturants=sync.$asArray(),console.log(vm.resturants),vm.newRestaurant={name:"",createdDate:Date.now(),menus:[]},this.addRestaurant=function(){$log.debug("Adding new restaurants [%s]",vm.newRestaurant),vm.resturants.$add(angular.copy(vm.newRestaurant)),vm.newRestaurant={name:"",createdDate:Date.now(),menus:[]}}}CreateRestaurantCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.restaurant").controller("CreateRestaurantCtrl",CreateRestaurantCtrl)}(),function(){function ListRestaurantCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/restaurants"),sync=$firebase(ref);vm.restaurants=sync.$asArray()}ListRestaurantCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.restaurant").controller("ListRestaurantCtrl",ListRestaurantCtrl)}(),function(){function WizardCtrl($log,NotifyService,Firebase,$firebase){var vm=this,ref=new Firebase("https://bug-free-food.firebaseio.com/orders"),sync=$firebase(ref);vm.orders=sync.$asArray(),vm.availableUsers=["James Morgan","Andy Gray","Simon Souter","Alex Lashford"],vm.selectedOrder=void 0,vm.myOrder={foods:[]},this.addFoodItem=function(){vm.myOrder.foods.push({})},this.removeFoodItem=function($index){vm.myOrder.foods.splice($index,1)},this.getOrderTotals=function(){if(!vm.myOrder.foods||vm.myOrder.foods.length<=0)return 0;var total=0;return vm.myOrder.foods.forEach(function(item){item.food&&item.food.price&&(total+=item.food.price)}),(total/100).toFixed(2)}}WizardCtrl.$inject=["$log","NotifyService","Firebase","$firebase"],angular.module("app.controllers.wizard").controller("WizardCtrl",WizardCtrl)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9fbW9kdWxlLmpzIiwianMvZGlyZWN0aXZlcy9fbW9kdWxlLmpzIiwianMvZmlsdGVycy9fbW9kdWxlLmpzIiwianMvaW50ZXJjZXB0b3JzL19tb2R1bGUuanMiLCJqcy9tb2RlbHMvX21vZHVsZS5qcyIsImpzL25vdGlmeS9fbW9kdWxlLmpzIiwianMvc2VydmljZXMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL2hvbWUvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL21lbnVzL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9uYXZpZ2F0aW9uL19tb2R1bGUuanMiLCJqcy9jb250cm9sbGVycy9vcmRlcnMvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3Jlc3RhdXJhbnQvX21vZHVsZS5qcyIsImpzL2NvbnRyb2xsZXJzL3dpemFyZC9fbW9kdWxlLmpzIiwianMvY29uc3RhbnRzLmpzIiwianMvcm91dGVzLmpzIiwianMvY29udHJvbGxlcnMvQXBwQ3RybC5qcyIsImpzL2ludGVyY2VwdG9ycy9IdHRwTG9nZ2luZ0ludGVyY2VwdG9yLmpzIiwianMvbW9kZWxzL1VzZXJNb2RlbC5qcyIsImpzL25vdGlmeS9Ob3RpZnlTZXJ2aWNlLmpzIiwianMvc2VydmljZXMvRGF0ZVNlcnZpY2UuanMiLCJqcy9jb250cm9sbGVycy9ob21lL0hvbWVDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbWVudXMvQ3JlYXRlTWVudUN0cmwuanMiLCJqcy9jb250cm9sbGVycy9tZW51cy9MaXN0TWVudXNDdHJsLmpzIiwianMvY29udHJvbGxlcnMvbmF2aWdhdGlvbi9Ub3BOYXZDdHJsLmpzIiwianMvY29udHJvbGxlcnMvb3JkZXJzL09yZGVyc0N0cmwuanMiLCJqcy9jb250cm9sbGVycy9yZXN0YXVyYW50L0NyZWF0ZVJlc3RhdXJhbnRDdHJsLmpzIiwianMvY29udHJvbGxlcnMvcmVzdGF1cmFudC9MaXN0UmVzdGF1cmFudEN0cmwuanMiLCJqcy9jb250cm9sbGVycy93aXphcmQvV2l6YXJkQ3RybC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxjQUVBLFdBRUEsR0FBQSxXQUVBLFVBQ0EsV0FFQSxrQkFDQSxlQUNBLGNBQ0EsaUJBQ0EsYUFDQSxhQUNBLG1CQUNBLGFBR0EsU0FBQSxPQUFBLE1BQUEsYUNqQkEsV0FFQSxRQUFBLE9BQUEsbUJBQ0EsdUJBQ0Esd0JBQ0EseUJBQ0EsNkJBQ0EseUJBQ0Esa0NDUkEsV0FFQSxRQUFBLE9BQUEsd0JDRkEsV0FFQSxRQUFBLE9BQUEscUJDRkEsV0FFQSxRQUFBLE9BQUEsMEJDRkEsV0FDQSxRQUFBLE9BQUEsb0JDREEsV0FFQSxRQUFBLE9BQUEsY0FBQSxhQUVBLFFBQUEsT0FBQSxjQUFBLEtBQUEsU0FBQSxTQUFBLFFBQ0EsT0FBQSxRQUNBLFNBQUEsSUFDQSxZQUFBLHlEQ1BBLFdBQ0EsUUFBQSxPQUFBLHNCQ0RBLFdBRUEsUUFBQSxPQUFBLDhCQ0ZBLFdBRUEsUUFBQSxPQUFBLCtCQ0ZBLFdBRUEsUUFBQSxPQUFBLG9DQ0ZBLFdBRUEsUUFBQSxPQUFBLGdDQ0ZBLFdBRUEsUUFBQSxPQUFBLG9DQ0ZBLFdBRUEsUUFBQSxPQUFBLGdDQ0ZBLFdBS0EsUUFBQSxPQUFBLE9BQUEsU0FBQSxVQUFBLFlDTkEsV0FLQSxHQUFBLFNBQUEsaUJBQUEsb0JBQUEsU0FBQSxlQUFBLG1CQUVBLGVBQUEsS0FBQSxLQUNBLFlBQUEsNENBQ0EsV0FBQSxtQkFNQSxlQUFBLEtBQUEsZ0JBQ0EsWUFBQSwrQ0FDQSxXQUFBLHFCQU1BLGVBQUEsS0FBQSxlQUNBLFlBQUEsNkNBQ0EsV0FBQSx5QkFFQSxlQUFBLEtBQUEsaUJBQ0EsWUFBQSw4Q0FDQSxXQUFBLDBCQU1BLGVBQUEsS0FBQSxxQkFDQSxZQUFBLHVEQUNBLFdBQUEsOEJBRUEsZUFBQSxLQUFBLHVCQUNBLFlBQUEsbURBQ0EsV0FBQSxnQ0FHQSxlQUFBLEtBQUEscUJBQ0EsWUFBQSxrREFDQSxXQUFBLHFCQU1B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QSxNQUNBLEtBQUEsTUFBQSxLQUFBLEtBQUEsUUFDQSxPQUFBLEtBQUEsS0FBQSxVQUdBLE1BQUEsS0FBQSxRQUFBLHVFQUlBLFFBQ0EsT0FBQSwwQkFDQSxXQUFBLGFBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciByZXF1aXJlcyA9IFtcbiAgICAgICAgLy8gM3JkIFBhcnR5XG4gICAgICAgICduZ1JvdXRlJyxcbiAgICAgICAgJ2ZpcmViYXNlJyxcbiAgICAgICAgLy8gSW50ZXJuYWxzXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMnLFxuICAgICAgICAnYXBwLnNlcnZpY2VzJyxcbiAgICAgICAgJ2FwcC5maWx0ZXJzJyxcbiAgICAgICAgJ2FwcC5kaXJlY3RpdmVzJyxcbiAgICAgICAgJ2FwcC5tb2RlbHMnLFxuICAgICAgICAnYXBwLnJvdXRlcycsXG4gICAgICAgICdhcHAuaW50ZXJjZXB0b3JzJyxcbiAgICAgICAgJ2FwcC5ub3RpZnknXG4gICAgXTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnLCByZXF1aXJlcyk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycycsIFtcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5ob21lJyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5tZW51cycsXG4gICAgICAgICdhcHAuY29udHJvbGxlcnMub3JkZXJzJyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy5yZXN0YXVyYW50JyxcbiAgICAgICAgJ2FwcC5jb250cm9sbGVycy53aXphcmQnLFxuICAgICAgICAnYXBwLmNvbnRyb2xsZXJzLm5hdmlnYXRpb24nXG4gICAgXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVycycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmludGVyY2VwdG9ycycsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5tb2RlbHMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ub3RpZnknLCBbJ2NnTm90aWZ5J10pO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ub3RpZnknKS5ydW4oZnVuY3Rpb24gKG5vdGlmeSkge1xuICAgICAgICBub3RpZnkuY29uZmlnKHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3RlbXBsYXRlcy9hbmd1bGFyLW5vdGlmeS5odG1sJ1xuICAgICAgICB9KTtcbiAgICB9KTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycsIFtdKTtcbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5ob21lJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMubWVudXMnLCBbXSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5uYXZpZ2F0aW9uJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMub3JkZXJzJywgW10pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLndpemFyZCcsIFtdKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBCYXNpYyBhcHAgdmVyc2lvbiBjb25zdGFudFxuICAgICAqL1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgndmVyc2lvbicsICcwLjAuMScpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICB2YXIgUm91dGVzID0gZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS9pbmRleC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ3RybCBhcyBoYydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9yZGVycyBNYW5hZ2VtZW50XG4gICAgICAgICAqL1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvb3JkZXJzL2xpc3QnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvb3JkZXJzL29yZGVycy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdPcmRlcnNDdHJsIGFzIHZtJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWVudXMgTWFuYWdlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL21lbnVzL2xpc3QnLCB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93d3ctYnVpbGQvdmlld3MvcGFydGlhbHMvbWVudXMvbWVudXMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTGlzdE1lbnVzQ3RybCBhcyBsbWMnXG4gICAgICAgIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvbWVudXMvY3JlYXRlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL21lbnVzL2NyZWF0ZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDcmVhdGVNZW51Q3RybCBhcyBjbWMnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXN0YXVyYW50IE1hbmFnZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9yZXN0YXVyYW50cy9saXN0Jywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL3Jlc3RhdXJhbnQvcmVzdGF1cmFudC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMaXN0UmVzdGF1cmFudEN0cmwgYXMgbHJjJ1xuICAgICAgICB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3Jlc3RhdXJhbnRzL2NyZWF0ZScsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3d3dy1idWlsZC92aWV3cy9wYXJ0aWFscy9yZXN0YXVyYW50L2NyZWF0ZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDcmVhdGVSZXN0YXVyYW50Q3RybCBhcyBjcmMnXG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy93aXphcmQvbmV3LW9yZGVyJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd3d3LWJ1aWxkL3ZpZXdzL3BhcnRpYWxzL3dpemFyZC9uZXctb3JkZXIuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnV2l6YXJkQ3RybCBhcyB2bSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICAkcm91dGVQcm92aWRlci5vdGhlcndpc2Uoe1xuICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERpc2FibGUgaHRtbCA1IG1vZGUgZHVlIHRvIElFOSBjb21wYXRpYmlsaXR5IHJlcXVpcmVtZW50IVxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoZmFsc2UpO1xuXG4gICAgfTtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnJvdXRlcycsIFtdKVxuICAgICAgICAuY29uZmlnKFJvdXRlcyk7XG5cblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBBcHBDdHJsKCRsb2csICRyb290U2NvcGUsIE5vdGlmeVNlcnZpY2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbihcIiRyb3V0ZUNoYW5nZUVycm9yXCIsIGZ1bmN0aW9uIChldmVudCwgY3VycmVudCwgcHJldmlvdXMsIHJlamVjdGlvbikge1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnRmFpbGVkIHRvIGNoYW5nZSByb3V0ZSBbJyArIChyZWplY3Rpb24uZGF0YS5lcnJvciA/IHJlamVjdGlvbi5kYXRhLmVycm9yIDogcmVqZWN0aW9uLmRhdGEpICsgJ10nO1xuICAgICAgICAgICAgJGxvZy5lcnJvcihtZXNzYWdlKTtcbiAgICAgICAgICAgIE5vdGlmeVNlcnZpY2UuZGFuZ2VyKG1lc3NhZ2UpO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FwcEN0cmwnLCBBcHBDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmludGVyY2VwdG9ycycpLmZhY3RvcnkoJ2xvZ2dpbmdJbnRlcmNlcHRvcicsIGZ1bmN0aW9uICgkcSwgJGxvZykge1xuXG4gICAgICAgIGZ1bmN0aW9uIGlzUGFydGlhbCh1cmwpIHtcbiAgICAgICAgICAgIHJldHVybiB1cmwuaW5kZXhPZigncGFydGlhbHMnKSA9PT0gLTE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUGFydGlhbChjb25maWcudXJsKSkge1xuICAgICAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKCdIdHRwIFJlcXVlc3QgWycgKyBjb25maWcubWV0aG9kICsgJ11bJyArIGNvbmZpZy51cmwgKyAnXScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3JlcXVlc3RFcnJvcic6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdIdHRwIFJlcXVlc3QgRXJyb3IgWycgKyBjb25maWcubWV0aG9kICsgJ11bJyArIGNvbmZpZy51cmwgKyAnXScpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncmVzcG9uc2UnOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQYXJ0aWFsKHJlc3BvbnNlLmNvbmZpZy51cmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoJ0h0dHAgUmVzcG9uc2UgU3VjY2VzczogU3RhdHVzIFsnICsgcmVzcG9uc2Uuc3RhdHVzICsgJ10gdG8gWycgKyByZXNwb25zZS5jb25maWcubWV0aG9kICsgJ11bJyArIHJlc3BvbnNlLmNvbmZpZy51cmwgKyAnXScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncmVzcG9uc2VFcnJvcic6IGZ1bmN0aW9uIChyZWplY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdIdHRwIFJlc3BvbnNlIEVycm9yOiBTdGF0dXMgWycgKyByZWplY3Rpb24uc3RhdHVzICsgJ10gdG8gWycgKyByZWplY3Rpb24uY29uZmlnLm1ldGhvZCArICddWycgKyByZWplY3Rpb24uY29uZmlnLnVybCArICddIGRhdGEgWycgKyAocmVqZWN0aW9uLmRhdGEuZXJyb3IgPyByZWplY3Rpb24uZGF0YS5lcnJvciA6IHJlamVjdGlvbi5kYXRhKSArICddJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZWplY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5pbnRlcmNlcHRvcnMnKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHtcbiAgICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnbG9nZ2luZ0ludGVyY2VwdG9yJyk7XG4gICAgfV0pO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICB2YXIgVXNlck1vZGVsID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSB1c2VyXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHVzZXI6IG51bGxcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5tb2RlbHMnKS5mYWN0b3J5KCdVc2VyTW9kZWwnLCBVc2VyTW9kZWwpO1xufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICB2YXIgTm90aWZ5U2VydmljZSA9IGZ1bmN0aW9uIChub3RpZnkpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhIG5vdGlmaWNhdGlvbiB3aXRoIHN0eWxlIERBTkdFUlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSB0aGUgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRhbmdlciA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBub3RpZnkoe21lc3NhZ2U6IG1lc3NhZ2UsIGNsYXNzZXM6ICdhbGVydC1kYW5nZXInfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgYSBub3RpZmljYXRpb24gd2l0aCBzdHlsZSBXQVJOSU5HXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2FybmluZyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBub3RpZnkoe21lc3NhZ2U6IG1lc3NhZ2UsIGNsYXNzZXM6ICdhbGVydC13YXJuaW5nJ30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGEgbm90aWZpY2F0aW9uIHdpdGggc3R5bGUgU1VDQ0VTU1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSB0aGUgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN1Y2Nlc3MgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgbm90aWZ5KHttZXNzYWdlOiBtZXNzYWdlLCBjbGFzc2VzOiAnYWxlcnQtc3VjY2Vzcyd9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhIG5vdGlmaWNhdGlvbiB3aXRoIHN0eWxlIElORk9cbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbmZvID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5vdGlmeSh7bWVzc2FnZTogbWVzc2FnZSwgY2xhc3NlczogJ2FsZXJ0LWluZm8nfSk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLm5vdGlmeScpXG4gICAgICAgIC5zZXJ2aWNlKCdOb3RpZnlTZXJ2aWNlJywgTm90aWZ5U2VydmljZSk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgdmFyIERhdGVTZXJ2aWNlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgRGF0ZSBOT1dcbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybnMgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ub3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIERhdGUgTk9XIGluIHNlY29uZHNcbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybnMgbnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFRpbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ub3coKS5nZXRUaW1lKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnNlcnZpY2VzJylcbiAgICAgICAgLnNlcnZpY2UoJ0RhdGVTZXJ2aWNlJywgRGF0ZVNlcnZpY2UpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEhvbWVDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL1wiKTtcbiAgICAgICAgLy8gY3JlYXRlIGFuIEFuZ3VsYXJGaXJlIHJlZmVyZW5jZSB0byB0aGUgZGF0YVxuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuICAgICAgICAvLyBkb3dubG9hZCB0aGUgZGF0YSBpbnRvIGEgbG9jYWwgb2JqZWN0XG4gICAgICAgIHZtLmRhdGEgPSBzeW5jLiRhc09iamVjdCgpO1xuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMuaG9tZScpXG4gICAgICAgIC5jb250cm9sbGVyKCdIb21lQ3RybCcsIEhvbWVDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBDcmVhdGVNZW51Q3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCBGaXJlYmFzZSwgJGZpcmViYXNlKSB7XG5cbiAgICAgICAgLy8gVmlld01vZGVsXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgLy8gcmVzdGF1cmFudHNSZWZcbiAgICAgICAgdmFyIHJlc3RhdXJhbnRzUmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL3Jlc3RhdXJhbnRzXCIpO1xuICAgICAgICB2YXIgcmVzdGF1cmFudHNTeW5jID0gJGZpcmViYXNlKHJlc3RhdXJhbnRzUmVmKTtcblxuICAgICAgICB2bS5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzU3luYy4kYXNBcnJheSgpO1xuICAgICAgICBjb25zb2xlLmxvZyh2bS5yZXN0YXVyYW50cyk7XG5cbiAgICAgICAgLy8gbWVudVJlZlxuICAgICAgICB2YXIgbWVudVJlZiA9IG5ldyBGaXJlYmFzZShcImh0dHBzOi8vYnVnLWZyZWUtZm9vZC5maXJlYmFzZWlvLmNvbS9tZW51c1wiKTtcbiAgICAgICAgdmFyIG1lbnVTeW5jID0gJGZpcmViYXNlKG1lbnVSZWYpO1xuXG4gICAgICAgIHZtLm1lbnVzID0gbWVudVN5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ubWVudXMpO1xuXG4gICAgICAgIHZtLnNlbGVjdGVkUmVzdGF1cmFudCA9IHt9O1xuICAgICAgICB2bS5uZXdNZW51ID0ge1xuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsIHByaWNlOiAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGNyZWF0ZWREYXRlOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5jcmVhdGVNZW51ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FkZGluZyBuZXcgbWVudSBbJXNdJywgYW5ndWxhci50b0pzb24odm0ubmV3TWVudSkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codm0uc2VsZWN0ZWRSZXN0YXVyYW50KTtcblxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZFJlc3RhdXJhbnQubWVudXMpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFJlc3RhdXJhbnQubWVudXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVzdGF1cmFudC5tZW51cy5wdXNoKHZtLm5ld01lbnUpO1xuXG4gICAgICAgICAgICB2bS5yZXN0YXVyYW50cy4kc2F2ZSh2bS5zZWxlY3RlZFJlc3RhdXJhbnQpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codm0ucmVzdGF1cmFudHMpO1xuXG4gICAgICAgICAgICB2bS5uZXdNZW51ID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgICAgIGZvb2RzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLCBwcmljZTogMFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnJlbW92ZUZvb2QgPSBmdW5jdGlvbiAoZm9vZCwgaW5kZXgpIHtcbiAgICAgICAgICAgIHZtLm5ld01lbnUuZm9vZHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFkZEZvb2QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5uZXdNZW51LmZvb2RzLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6ICcnLCBwcmljZTogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbi8vICAgICAgICBTbWFsbCBDaGlja2VuIE5hYW5cdMKjMy44MFxuLy8gICAgICAgIFNtYWxsIENoaWNrZW4gQ2hhcGF0dGlcdMKjMy44MFxuLy8gICAgICAgIENoaWNrZW4gTGFtYiBNaXggTmFhblx0wqM2LjAwXG4vLyAgICAgICAgQ2hpY2tlbiBMYW1iIE1peCBDaGFwYXR0aVx0wqM2LjAwXG4vLyAgICAgICAgTGFyZ2UgQ2hpY2tlbiBOYWFuXHTCozYuMDBcbi8vICAgICAgICBMYXJnZSBDaGlja2VuIENoYXBhdHRpXHTCozYuMDBcbi8vICAgICAgICBMYXJnZSBMYW1iIE5hYW5cdMKjNi4wMFxuLy8gICAgICAgIExhcmdlIExhbWIgQ2hhcGF0dGlcdMKjNi4wMFxuLy8gICAgICAgIENoaWNrZW4gU2Vla2ggTWl4IE5hYW5cdMKjNi4wMFxuLy8gICAgICAgIENoaWNrZW4gU2Vla2ggTWl4IENoYXBhdHRpXHTCozYuMDBcbi8vICAgICAgICBTbWFsbCBTZWVraCBOYWFuXHTCozIuOTBcbi8vICAgICAgICBTbWFsbCBTZWVraCBDaGFwYXR0aVx0wqMyLjkwXG4vLyAgICAgICAgTGFyZ2UgU2Vla2ggTmFhblx0wqMzLjcwXG4vLyAgICAgICAgTGFyZ2UgU2Vla2ggQ2hhcGF0dGlcdMKjMy43MFxuLy8gICAgICAgIFNtYWxsIENoaXBzXHTCozEuMzBcbi8vICAgICAgICBMYXJnZSBDaGlwc1x0wqMyLjAwXG4vLyAgICAgICAgQ2hpY2tlbiBEb25uZXJcdMKjMy41MFxuXG5cbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5tZW51cycpXG4gICAgICAgIC5jb250cm9sbGVyKCdDcmVhdGVNZW51Q3RybCcsIENyZWF0ZU1lbnVDdHJsKTtcblxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICAvKipcbiAgICAgKiBAbmdJbmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBMaXN0TWVudXNDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL3Jlc3RhdXJhbnRzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLnJlc3RhdXJhbnRzID0gc3luYy4kYXNBcnJheSgpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHZtLnJlc3RhdXJhbnRzKTtcblxuICAgICAgICB0aGlzLnJlbW92ZU1lbnVBdEluZGV4ID0gZnVuY3Rpb24gKHJlc3R1cmFudCwgaW5kZXgpIHtcbiAgICAgICAgICAgIHJlc3R1cmFudC5tZW51cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdm0ucmVzdGF1cmFudHMuJHNhdmUocmVzdHVyYW50KTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5jb250cm9sbGVycy5tZW51cycpXG4gICAgICAgIC5jb250cm9sbGVyKCdMaXN0TWVudXNDdHJsJywgTGlzdE1lbnVzQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gVG9wTmF2Q3RybCgkbG9nLCBOb3RpZnlTZXJ2aWNlLCAkZmlyZWJhc2VTaW1wbGVMb2dpbiwgRmlyZWJhc2UsIFVzZXJNb2RlbCkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb21cIik7XG5cbiAgICAgICAgdm0uY3VycmVudFVzZXIgPSBVc2VyTW9kZWwudXNlcjtcblxuICAgICAgICB2YXIgYXV0aENsaWVudCA9ICRmaXJlYmFzZVNpbXBsZUxvZ2luKHJlZik7XG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhDbGllbnQpO1xuXG4gICAgICAgIGF1dGhDbGllbnQuJGdldEN1cnJlbnRVc2VyKCkudGhlbihoYW5kbGVTdWNjZXNzZnVsTG9naW4pO1xuXG4gICAgICAgIHRoaXMubG9naW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdMb2dpbiAtIGdpdGh1YicpO1xuICAgICAgICAgICAgYXV0aENsaWVudC4kbG9naW4oJ2dpdGh1YicsIHsgcmVtZW1iZXJNZTogdHJ1ZSwgc2NvcGU6ICd1c2VyJ30pXG4gICAgICAgICAgICAgICAgLnRoZW4oaGFuZGxlU3VjY2Vzc2Z1bExvZ2luLCBwb3BFcnJvcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdMb2dvdXQnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGF1dGhDbGllbnQpO1xuICAgICAgICAgICAgYXV0aENsaWVudC4kbG9nb3V0KCk7XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgICAgICBVc2VyTW9kZWwudXNlciA9IG51bGw7XG4gICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ3VzZXIgaXMgbG9nZ2VkIG91dCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVN1Y2Nlc3NmdWxMb2dpbih1c2VyKSB7XG4gICAgICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgICAgICAgICBVc2VyTW9kZWwudXNlciA9IHVzZXI7XG4gICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZyhcIlVzZXIgSUQ6IFwiICsgdXNlci51aWQgKyBcIiwgUHJvdmlkZXI6IFwiICsgdXNlci5wcm92aWRlcik7XG4gICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5zdWNjZXNzKFwiVXNlciBJRDogXCIgKyB1c2VyLnVpZCArIFwiLCBQcm92aWRlcjogXCIgKyB1c2VyLnByb3ZpZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHBvcEVycm9yKGVycm9yKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIE5vdGlmeVNlcnZpY2UuZGFuZ2VyKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm5hdmlnYXRpb24nKVxuICAgICAgICAuY29udHJvbGxlcignVG9wTmF2Q3RybCcsIFRvcE5hdkN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE9yZGVyc0N0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vb3JkZXJzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLm9yZGVycyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICByZXNldEZvcm0oKTtcblxuICAgICAgICAvLyBVc2Vyc1xuICAgICAgICB2bS5hdmFpbGFibGVVc2VycyA9IFsnSmFtZXMgTW9yZ2FuJywgJ0FuZHkgR3JheScsICdTaW1vbiBTb3V0ZXInLCAnQWxleCBMYXNoZm9yZCddO1xuXG4gICAgICAgIC8vIEF2YWlsYWJsZSBwYWdlIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgdm0uYXZhaWxhYmxlUmVzdGF1cmFudHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0FiZHVscyBMZXZlbnNodWxtZScsXG4gICAgICAgICAgICAgICAgb3BlbmluZ1RpbWVzOiAnLi4uJyxcbiAgICAgICAgICAgICAgICBmb29kczogW1xuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gTmFhbicsIHByaWNlOiAzODB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIENoaWNrZW4gQ2hhcGF0dGknLCBwcmljZTogMzAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IE5hYW4nLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIExhbWIgTWl4IENoYXBhdHRpJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgQ2hpY2tlbiBDaGFwYXR0aScsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgTmFhbicsIHByaWNlOiA2MDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIExhbWIgQ2hhcGF0dGknLCBwcmljZTogNjAwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdDaGlja2VuIFNlZWtoIE1peCBOYWFuJywgcHJpY2U6IDYwMH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgU2Vla2ggTmFhbicsIHByaWNlOiAyOTB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ1NtYWxsIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDI5MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnTGFyZ2UgU2Vla2ggTmFhbicsIHByaWNlOiAzNzB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0xhcmdlIFNlZWtoIENoYXBhdHRpJywgcHJpY2U6IDM3MH0sXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnU21hbGwgQ2hpcHMnLCBwcmljZTogMTMwfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICdMYXJnZSBDaGlwcycsIHByaWNlOiAyMDB9LFxuICAgICAgICAgICAgICAgICAgICB7bmFtZTogJ0NoaWNrZW4gRG9ubmVyJywgcHJpY2U6IDM1MH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdGhpcy5jcmVhdGVPcmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm9yZGVycy4kYWRkKGFuZ3VsYXIuY29weSh2bS5uZXdPcmRlcikpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSBhZGRlZCBvcmRlcicpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZ5U2VydmljZS5kYW5nZXIoJ1VuYWJsZSB0byBzYXZlIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNldEZvcm0oKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnJlbW92ZU9yZGVyID0gZnVuY3Rpb24gKG9yZGVyKSB7XG4gICAgICAgICAgICB2bS5vcmRlcnMuJHJlbW92ZShvcmRlcilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgb3JkZXInKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmeVNlcnZpY2UuZGFuZ2VyKCdVbmFibGUgdG8gcmVtb3ZlIG9yZGVyJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzZXRGb3JtKCkge1xuICAgICAgICAgICAgdm0ubmV3T3JkZXIgPSB7XG4gICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiAnJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICByZXN0YXVyYW50OiAnJyxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICAgICAgICAgIHt9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkRGF0ZTogRGF0ZS5ub3coKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLm9yZGVycycpXG4gICAgICAgIC5jb250cm9sbGVyKCdPcmRlcnNDdHJsJywgT3JkZXJzQ3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gQ3JlYXRlUmVzdGF1cmFudEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vcmVzdGF1cmFudHNcIik7XG4gICAgICAgIHZhciBzeW5jID0gJGZpcmViYXNlKHJlZik7XG5cbiAgICAgICAgdm0ucmVzdHVyYW50cyA9IHN5bmMuJGFzQXJyYXkoKTtcbiAgICAgICAgY29uc29sZS5sb2codm0ucmVzdHVyYW50cyk7XG5cbiAgICAgICAgdm0ubmV3UmVzdGF1cmFudCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KCksXG4gICAgICAgICAgICBtZW51czogW11cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFkZFJlc3RhdXJhbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdBZGRpbmcgbmV3IHJlc3RhdXJhbnRzIFslc10nLCB2bS5uZXdSZXN0YXVyYW50KTtcblxuICAgICAgICAgICAgdm0ucmVzdHVyYW50cy4kYWRkKGFuZ3VsYXIuY29weSh2bS5uZXdSZXN0YXVyYW50KSk7XG5cbiAgICAgICAgICAgIHZtLm5ld1Jlc3RhdXJhbnQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgY3JlYXRlZERhdGU6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgbWVudXM6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzLnJlc3RhdXJhbnQnKVxuICAgICAgICAuY29udHJvbGxlcignQ3JlYXRlUmVzdGF1cmFudEN0cmwnLCBDcmVhdGVSZXN0YXVyYW50Q3RybCk7XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gTGlzdFJlc3RhdXJhbnRDdHJsKCRsb2csIE5vdGlmeVNlcnZpY2UsIEZpcmViYXNlLCAkZmlyZWJhc2UpIHtcblxuICAgICAgICAvLyBWaWV3TW9kZWxcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKFwiaHR0cHM6Ly9idWctZnJlZS1mb29kLmZpcmViYXNlaW8uY29tL3Jlc3RhdXJhbnRzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLnJlc3RhdXJhbnRzID0gc3luYy4kYXNBcnJheSgpO1xuXG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMucmVzdGF1cmFudCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdMaXN0UmVzdGF1cmFudEN0cmwnLCBMaXN0UmVzdGF1cmFudEN0cmwpO1xuXG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIC8qKlxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFdpemFyZEN0cmwoJGxvZywgTm90aWZ5U2VydmljZSwgRmlyZWJhc2UsICRmaXJlYmFzZSkge1xuXG4gICAgICAgIC8vIFZpZXdNb2RlbFxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoXCJodHRwczovL2J1Zy1mcmVlLWZvb2QuZmlyZWJhc2Vpby5jb20vb3JkZXJzXCIpO1xuICAgICAgICB2YXIgc3luYyA9ICRmaXJlYmFzZShyZWYpO1xuXG4gICAgICAgIHZtLm9yZGVycyA9IHN5bmMuJGFzQXJyYXkoKTtcblxuICAgICAgICAvLyBFbXBsb3llZXNcbiAgICAgICAgdm0uYXZhaWxhYmxlVXNlcnMgPSBbJ0phbWVzIE1vcmdhbicsICdBbmR5IEdyYXknLCAnU2ltb24gU291dGVyJywgJ0FsZXggTGFzaGZvcmQnXTtcblxuICAgICAgICB2bS5zZWxlY3RlZE9yZGVyID0gdW5kZWZpbmVkO1xuXG4gICAgICAgIC8vIFRoZSBkYXRhIGZvcm1cbiAgICAgICAgdm0ubXlPcmRlciA9IHtcbiAgICAgICAgICAgIGZvb2RzOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYWRkRm9vZEl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5teU9yZGVyLmZvb2RzLnB1c2goe30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucmVtb3ZlRm9vZEl0ZW0gPSBmdW5jdGlvbiAoJGluZGV4KSB7XG4gICAgICAgICAgICB2bS5teU9yZGVyLmZvb2RzLnNwbGljZSgkaW5kZXgsIDEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ2V0T3JkZXJUb3RhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXZtLm15T3JkZXIuZm9vZHMgfHwgdm0ubXlPcmRlci5mb29kcy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRvdGFsID0gMDtcbiAgICAgICAgICAgIHZtLm15T3JkZXIuZm9vZHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmZvb2QgJiYgaXRlbS5mb29kLnByaWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IGl0ZW0uZm9vZC5wcmljZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAodG90YWwgLyAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuY29udHJvbGxlcnMud2l6YXJkJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1dpemFyZEN0cmwnLCBXaXphcmRDdHJsKTtcblxufSkoKTsiXSwic291cmNlUm9vdCI6ImFwcCJ9